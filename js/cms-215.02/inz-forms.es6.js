var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a;window.inz=window.inz||{};var inz=window.inz;inz.login={};inz.login.init=function(login_required){if(login_required){inz.forms.message.showMessage("<p>Please wait while the form is loaded</p>",null,"Form loading",true);$.ajax({dataType:"json",method:"POST",url:"/@@acc_login_session_check"}).done(function(data2,textStatus,jqXHR){inz.login.session=new inz.login.Session(data2);let form_user_action_event=new Event("form_user_logged_in",{bubbles:true});$("body")[0].dispatchEvent(form_user_action_event);$(".authorised_form_content").show()}).fail(function(jqXHR,textStatus,errorThrown){if(jqXHR.status===403||jqXHR.status===401){$(".non_authorised_form_content").show();inz.forms.message.hideMessage()}})}else{$(".authorised_form_content").show()}};inz.login.Session=(_a=class{constructor(data2){this.activity=0;this.formActivity=0;this.data=data2;this.submissionId=null;this.state=null;this.stateData=null;this.lastState=null;this.lastData=null;this.timeoutId=0;this.initStates();this.channel=new BroadcastChannel("flgs");let sess=this;$("#termination_form").on("click","#save_and_exit",()=>sess.processEvent(inz.login.Session.Events.Save));this.channel.addEventListener("message",event=>{let sevt=event.data;sess.processEvent(sevt)});this.transition(inz.login.Session.States.LoggedIn,data2)}initStates(){this.states={[inz.login.Session.States.LoggedIn]:new inz.login.StateLoggedIn(inz.login.Session.States.LoggedIn,this),[inz.login.Session.States.Drafts]:new inz.login.StateDrafts(inz.login.Session.States.Drafts,this),[inz.login.Session.States.Loaded]:new inz.login.StateLoaded(inz.login.Session.States.Loaded,this),[inz.login.Session.States.Saving]:new inz.login.StateSaving(inz.login.Session.States.Saving,this),[inz.login.Session.States.Saved]:new inz.login.StateSaved(inz.login.Session.States.Saved,this),[inz.login.Session.States.LoggingOut]:new inz.login.StateLoggingOut(inz.login.Session.States.LoggingOut,this),[inz.login.Session.States.Warning]:new inz.login.StateWarning(inz.login.Session.States.Warning,this),[inz.login.Session.States.Reload]:new inz.login.StateReload(inz.login.Session.States.Reload,this)}}currentStateId(){return this.state===null?null:this.state.id}stateEntered(stateId,data2){console.debug("Session: entered_state: "+stateId+" Data: "+String(data2));this.lastState=this.state;this.lastData=this.stateData;this.state=this.states[stateId];this.stateData=data2}stateExited(stateId){console.debug("Session: stateExited: "+stateId)}transition(stateId,data2){let newState=this.states[stateId];if(typeof newState==="undefined"){console.warn(`Unknown state: ${stateId} (${data2})`);return false}if(!newState.guard()){console.warn(`Cannot transition to state: ${stateId} (${data2}) currently in state ${this.state!==null?this.state.id:"None"}`);return false}newState.entry(data2);return true}transitionLast(){let newState=this.lastState;if(!newState.guard()){console.warn(`Cannot transition last to state: ${String(this.lastState.id)} (${String(this.lastData)}) currently in state ${String(this.state.id)}`);return false}newState.entry(this.lastData)}processEvent(event,data2){console.debug(`Session: event: ${event} data: ${data2}`);if(this.state!==null)this.state.run(event,data2);return false}sessionRemaining(){let currtime=new Date().getTime();let remaining=this.data.time_over*1e3-currtime;if(remaining>inz.login.Session.MAXIMUM_CHECK_TIME){remaining=inz.login.Session.MAXIMUM_CHECK_TIME}console.debug(`sessionRemaining: ${remaining}`);return remaining}sessionWarningTimeout(){let currtime=new Date().getTime();let remaining=this.data.time_over*1e3-currtime;if(remaining<inz.login.Session.WARNING_TIME){return 2e3}return remaining-inz.login.Session.WARNING_TIME}sessionDataUpdate(data2){this.data=data2;if(this.timeoutId!==0)this.timeoutStart(true);console.debug("Session Data Update")}timeoutUrl(){let form_identity=$("#form-identity").data().formIdentity;return"/@@acc_login_timeout?FormIdentity="+form_identity}timeoutStart(replace){if((typeof replace==="undefined"||!replace)&&this.timeoutId!==0)return;let sess=this;this.timeoutStop();let remaining=this.sessionWarningTimeout();console.debug("Session time out warning in: "+remaining);this.timeoutId=window.setTimeout(()=>{sess.processEvent(inz.login.Session.Events.Warning)},remaining)}timeoutStop(){if(this.timeoutId!==0){window.clearTimeout(this.timeoutId)}this.timeoutId=0}active(form2){this.activity=new Date().getTime();if(form2)this.formActivity=this.activity}formIsModified(){if(this.isSubmitted()){return false}else{return this.formActivity!==0}}beenActive(){return this.activity!==0}haveSaved(){this.formActivity=0}inDrafts(){return $(".modal_forms_message table.savedDrafts").is(":visible")||$("#noapps").is(":visible")}isSubmitted(){return $("#success_page").is(":visible")}lastStateWas(stateId){if(this.lastState==null)return false;return this.lastState.id===stateId}randomInt(min,max){return Math.floor(Math.random()*max)+min}warningTimeOut(){let sess=this;if(this.beenActive()){this.refresh(this.activity).done(function(data2){if(data2!==null)sess.data=data2;sess.activity=0;sess.timeoutStart(true)})}else{$.ajax({dataType:"json",method:"POST",url:"/@@acc_login_session_check"}).done(function(data2,textStatus,jqXHR){sess.data=data2;let warningTimeout=sess.sessionWarningTimeout();console.debug(`Warning timeout remaing: ${warningTimeout}`);if(warningTimeout<inz.login.Session.WARNING_TIME){sess.transition(inz.login.Session.States.Warning)}else{sess.timeoutStart(true)}}).fail(function(jqXHR,textStatus,errorThrown){console.debug(`Session check error: ${jqXHR.status} / ${textStatus} / ${errorThrown} `);if(jqXHR.status===403){sess.transition(inz.login.Session.States.Reload,0)}else if(jqXHR.status===401){if(sess.isSubmitted()){sess.transition(inz.login.Session.States.Reload)}else if(sess.state instanceof inz.login.StateLoaded&&sess.formIsModified()){sess.transition(inz.login.Session.States.Saving,inz.login.Session.States.Reload)}else{sess.transition(inz.login.Session.States.Reload)}}else{sess.timeoutStart(true)}})}}refresh(lastseen){let data2={};if(lastseen){data2["lastseen"]=lastseen}let deferred=$.Deferred();$.ajax({dataType:"text",method:"POST",url:"/@@realme-tokencheck",data:data2}).done(function(data3,textStatus,jqXHR){let bodyText=$.parseHTML(data3)[2].textContent;let response=JSON.parse(bodyText.trim());deferred.resolve(response)}).fail(function(jqXHR,textStatus,errorThrown){if(jqXHR.status===403){deferred.resolve(null);window.location=inz.login.session.timeoutUrl()}else{deferred.resolve(null)}});return deferred.promise()}},__publicField(_a,"States",Object.freeze({LoggedIn:"loggedin",Drafts:"drafts",Loaded:"loaded",Saving:"saving",Saved:"saved",LoggingOut:"loggingout",Warning:"warning",Reload:"reload"})),__publicField(_a,"Events",Object.freeze({Drafts:"drafts",Loaded:"loaded",New:"new",Active:"active",Save:"save",Cancel:"cancel",LogOut:"logout",Check:"check",TimeOut:"timeout",Warning:"warning",TabLogout:"tabout"})),__publicField(_a,"WARNING_TIME",5*6e4),__publicField(_a,"MAXIMUM_CHECK_TIME",24*6e4),_a);inz.login.State=class{constructor(id,session){this.session=session;this.id=id}guard(){return true}entry(data2){this.session.stateEntered(this.id,data2)}exit(){this.session.stateExited(this.id)}run(event,data2){switch(event){case inz.login.Session.Events.Warning:this.session.warningTimeOut();break;case inz.login.Session.Events.TabLogout:let state=this;window.setTimeout(()=>{if(state.session.formIsModified()){state.session.transition(inz.login.Session.States.Saving,inz.login.Session.States.Reload)}else{state.session.transition(inz.login.Session.States.Reload,state.session.randomInt(500,7500))}},this.session.randomInt(1e3,5e3));break;default:console.warn(`Session (${this.id}): Unsupported event: ${event}`);break}}};inz.login.StateLoggedIn=class extends inz.login.State{guard(){return this.session.currentStateId()===null}entry(data2){this.session.timeoutStart();super.entry(data2)}run(event,data2){console.debug(`Session (${this.id}) : event: ${event} data: ${data2}`);switch(event){case inz.login.Session.Events.Drafts:this.session.transition(inz.login.Session.States.Drafts);break;case inz.login.Session.Events.New:this.session.transition(inz.login.Session.States.Loaded,null);break;case inz.login.Session.Events.Warning:this.session.lastState=inz.login.session.states[inz.login.Session.States.Drafts];this.session.warningTimeOut();break;default:console.warn(`Session (${this.id}): Unsupported event: ${event}`);break}}};inz.login.StateDrafts=class extends inz.login.State{entry(data2){this.session.timeoutStart();super.entry(data2)}run(event,data2){console.debug(`Session (${this.id}) : event: ${event} data: ${data2}`);switch(event){case inz.login.Session.Events.New:this.session.transition(inz.login.Session.States.Loaded,null);break;case inz.login.Session.Events.Loaded:this.session.transition(inz.login.Session.States.Loaded,data2);break;case inz.login.Session.Events.Active:break;case inz.login.Session.Events.TabLogout:this.session.transition(inz.login.Session.States.Reload);break;case inz.login.Session.Events.LogOut:this.session.transition(inz.login.Session.States.LoggingOut);break;case inz.login.Session.Events.Warning:this.session.warningTimeOut();break;default:console.warn(`Session (${this.id}): Unsupported event: ${event} (${data2})`);break}}};inz.login.StateLoaded=class extends inz.login.State{entry(data2){this.session.timeoutStart();this.session.activity=0;this.session.formActivity=0;this.session.submissionId=data2;super.entry(data2)}run(event,data2){console.debug(`Session (${this.id}) : event: ${event} data: ${data2}`);switch(event){case inz.login.Session.Events.Active:this.session.active(true);break;case inz.login.Session.Events.Save:this.session.transition(inz.login.Session.States.Saving);break;case inz.login.Session.Events.Cancel:break;case inz.login.Session.Events.Warning:this.session.warningTimeOut();break;case inz.login.Session.Events.TabLogout:let state=this;window.setTimeout(()=>{if(state.session.formIsModified()){state.session.transition(inz.login.Session.States.Saving,inz.login.Session.States.Reload)}else{state.session.transition(inz.login.Session.States.Reload,state.session.randomInt(500,7500))}},this.session.randomInt(1e3,5e3));break;default:console.warn(`Session (${this.id}): Unsupported event: ${event} (${data2})`);break}}};inz.login.StateSaving=class extends inz.login.State{constructor(id,session){super(id,session);this.successStateId=inz.login.Session.States.Saved}entry(data2){this.session.timeoutStop();this.session.submissionId=data2;this.successStateId=typeof data2==="undefined"||data2===null?inz.login.Session.States.Saved:data2;super.entry(data2);this.doSave()}doSave(){let state=this;window.form.setLeaveWarning(false);inz.forms.message.showMessage("<p>Your information is being saved for later</p>","Saving progress","Draft saving",true);inz.forms.message.scrollToMessage();form.saveState().done(function(success){if(success){state.session.haveSaved();state.session.transition(state.successStateId)}else{state.session.transition(state.successStateId)}})}};inz.login.StateSaved=class extends inz.login.State{entry(data2){let state=this;this.session.timeoutStart();$("#pd_print, #pd_download").hide();inz.forms.message.hideMessage();inz.forms.message.showMessage('<p>We have saved your information. You can log out and complete the form later.</p><input name="session_close" class="btn btn__blockxs btn__primary center-block" type="submit" value="Log out" /><input name="view_drafts" class="btn btn__blockxs btn__secondary center-block" type="button" value="View Drafts" />',"Progress saved","Draft saved",false);inz.forms.message.scrollToMessage();$('input[name="session_close"]').click(function(event){event.preventDefault();event.stopPropagation();$(this).attr("disabled","disabled");$('input[name="view_drafts"]').attr("disabled","disabled");state.session.timeoutStop();inz.forms.message.hideMessage();inz.forms.message.showMessage("","Logging out","",true);inz.forms.message.scrollToMessage();state.session.transition(inz.login.Session.States.LoggingOut)});$('input[name="view_drafts"]').click(function(event){event.preventDefault();event.stopPropagation();$(this).attr("disabled","disabled");$('input[name="session_close"]').attr("disabled","disabled");window.location.reload()});super.entry(data2)}};inz.login.StateLoggingOut=class extends inz.login.State{entry(data2){super.entry(data2);window.form.setLeaveWarning(false);this.session.timeoutStop();this.doLogout()}doLogout(){let state=this;$.ajax({dataType:"json",method:"POST",url:"/@@realme-cancel-session",data:{ReturnUrl:this.session.timeoutUrl()}}).done(function(data2,textStatus,jqXHR){state.session.channel.postMessage(inz.login.Session.Events.TabLogout);window.location=data2.url}).fail(function(jqXHR,textStatus,errorThrown){window.location=data.url})}};inz.login.StateWarning=class extends inz.login.State{constructor(id,session){super(id,session);this.warningTimer=0}entry(data2){super.entry(data2);this.session.timeoutStop();let inDrafts=this.session.inDrafts();let isSubmitted=this.session.isSubmitted();if(inDrafts){inz.forms.message.showMessage('<p>You have been inactive and your session is about to expire. If you would like to continue working please click the "Continue Working" button below. Alternatively, click "Log Out" to log out.</p><input name="session_refresh" class="btn btn__blockxs btn__primary center-block" value="Continue Working" /> <a class="btn btn__blockxs btn__secondary center-block save_and_exit" type="button">Log Out</input>',"Session expiring","Login session inactivity",true)}else if(isSubmitted){inz.forms.message.showMessage('<p>You have been inactive and your session is about to expire. If you would like to continue working please click the "View Drafts" button below, otherwise, click "Log out".</p><input name="session_close" class="btn btn__blockxs btn__primary center-block" type="submit" value="Log out" /><input name="view_drafts" class="btn btn__blockxs btn__secondary center-block" type="button" value="View Drafts" />',"Session expiring","Login session inactivity",true)}else{inz.forms.message.showMessage('<p>You have been inactive and your session is about to expire. If you time out, your work may be lost. If you would like to continue working please click the "Continue Working" button below. Alternatively, click "Save and Complete Later" to save your data and log out.</p><input name="session_refresh" class="btn btn__blockxs btn__primary center-block" value="Continue Working" /><a class="btn btn__blockxs btn__secondary center-block save_and_exit">Save and Complete Later</input>',"Session expiring","Login session inactivity",true)}inz.forms.message.scrollToMessage();let state=this;$('input[name="session_refresh"]').click(function(e){$(this).attr("disabled","disabled");$(".modal_forms_message a.save_and_exit").attr("disabled","disabled");state.cancelTimeout();state.session.refresh().done(function(data3){if(inDrafts){window.location.reload()}else{if(data3!==null){state.session.data=data3;let remaining2=state.session.sessionRemaining(data3);console.debug(`Refresh, session remaining: ${remaining2}`)}inz.forms.message.hideMessage();state.session.transitionLast()}})});$(".modal_forms_message a.save_and_exit").click(function(e){$(this).attr("disabled","disabled");$('input[name="session_refresh"]').attr("disabled","disabled");state.cancelTimeout();if(inDrafts){state.session.processEvent(inz.login.Session.Events.LogOut)}else{state.session.processEvent(inz.login.Session.Events.Save)}});$('input[name="session_close"]').click(function(event){event.preventDefault();event.stopPropagation();$(this).attr("disabled","disabled");$('input[name="view_drafts"]').attr("disabled","disabled");state.session.timeoutStop();inz.forms.message.hideMessage();inz.forms.message.showMessage("","Logging out","",true);inz.forms.message.scrollToMessage();state.session.transition(inz.login.Session.States.LoggingOut)});$('input[name="view_drafts"]').click(function(event){event.preventDefault();event.stopPropagation();$(this).attr("disabled","disabled");$('input[name="session_close"]').attr("disabled","disabled");window.location.reload()});let remaining=this.session.sessionRemaining();let warningTimeout=inz.login.Session.WARNING_TIME-1e4;console.debug(`Login: Session remaing: ${remaining} Warning Timeout: ${warningTimeout}`);this.warningTimer=window.setTimeout(()=>{state.warningTimeout()},warningTimeout)}exit(){this.cancelTimeout();super.exit()}run(event,data2){console.debug(`Session (${this.id}) : event: ${event} data: ${data2}`);switch(event){case inz.login.Session.Events.Active:this.session.active();break;case inz.login.Session.Events.Drafts:this.session.transition(inz.login.Session.States.Drafts);break;case inz.login.Session.Events.Save:this.session.transition(inz.login.Session.States.Saving,inz.login.Session.States.LoggingOut);break;case inz.login.Session.Events.LogOut:this.session.transition(inz.login.Session.States.LoggingOut);break;case inz.login.Session.Events.TimeOut:break;case inz.login.Session.Events.TabLogout:if(this.shouldSave()){this.session.transition(inz.login.Session.States.Saving,inz.login.Session.States.Reload)}else{this.session.transition(inz.login.Session.States.Reload)}break;default:console.warn(`Session (${this.id}): Unsupported event: ${event} (${data2})`);break}}doLogout(){let state=this;$.ajax({dataType:"json",method:"POST",url:"/@@realme-cancel-session",data:{ReturnUrl:this.session.timeoutUrl()}}).done(function(data2,textStatus,jqXHR){state.session.timeoutStop();window.location=data2.url}).fail(function(jqXHR,textStatus,errorThrown){state.session.timeoutStop();window.location=data.url})}shouldSave(){console.debug(`Should save: Last: ${this.session.lastState===null?"None":this.session.lastState.id} InDrafts: ${this.session.inDrafts()} Form Modified: ${this.session.formIsModified()}`);if(this.session.inDrafts()||this.session.lastStateWas(inz.login.Session.States.Saved)||this.session.lastStateWas(inz.login.Session.States.Drafts))return false;return this.session.formIsModified()}warningTimeout(){console.warn("Warning Timeout");if(this.shouldSave()){this.session.transition(inz.login.Session.States.Saving,inz.login.Session.States.LoggingOut)}else{this.session.transition(inz.login.Session.States.LoggingOut)}}cancelTimeout(){if(this.warningTimer!==0){window.clearTimeout(this.warningTimer);this.warningTimer=0}}};inz.login.StateReload=class extends inz.login.State{constructor(id,session){super(id,session);this.reloadDelay=this.session.randomInt(500,5e3)}entry(data2){super.entry(data2);this.session.timeoutStop();window.form.setLeaveWarning(false);inz.forms.message.showMessage("<p>Your session has ended.","Session expired","",true);let reloadDelay=this.reloadDelay;if(typeof data2!=="undefined"&&data2!==null){let delay=Number(data2);if(Number.isSafeInteger(delay)&&delay>0){reloadDelay=delay}}if(reloadDelay>0){window.setTimeout(()=>{window.location.reload()},reloadDelay)}else{window.location.reload()}}run(event,data2){}};


window.inz=window.inz||{};var inz=window.inz;inz.forms={};if(!String.prototype.endsWith){String.prototype.endsWith=function(search,this_len){if(this_len===void 0||this_len>this.length){this_len=this.length}return this.substring(this_len-search.length,this_len)===search}}if(console.lg===void 0&&typeof document.body.dataset.sfjl==="undefined"){console.lg=[];console.defaultLog=console.log.bind(console);console.log=function(){console.lg.push(Date.now()+',log,"'+Array.from(arguments)+'"');console.defaultLog.apply(console,arguments)};console.defaultError=console.error.bind(console);console.error=function(){console.lg.push(Date.now()+',error,"'+Array.from(arguments)+'"');console.defaultError.apply(console,arguments)};console.defaultWarn=console.warn.bind(console);console.warn=function(){console.lg.push(Date.now()+',warn,"'+Array.from(arguments)+'"');console.defaultWarn.apply(console,arguments)};console.defaultDebug=console.debug.bind(console);console.debug=function(){console.lg.push(Date.now()+',debug,"'+Array.from(arguments)+'"');console.defaultDebug.apply(console,arguments)}}inz.forms.init=function(){inz.modularForms.errorScrollOffset=30;inz.forms.fields.InternationalPayment.setupFieldType(window.Parsley);inz.forms.fields.BankCode.setupFieldType(window.Parsley);inz.forms.fields.InternationalPhoneNumberField.setupFieldType(window.Parsley);inz.forms.fields.Number.setupFieldType(window.Parsley);window.Parsley.addValidator("irdNumber",{validateString:function(value,requirement){return inz.forms.validators.isValidIRDNumber(value)},messages:{en:"This value should be a valid IRD Number"}});window.Parsley.addValidator("nzBankAccountNumber",{validateString:function(value,requirement){return inz.forms.validators.isValidNZBankAccountNumber(value)},messages:{en:"This value should be a valid New Zealand Bank Account Number"}});window.Parsley.addValidator("multilineMaxLength",{requirementType:"integer",validateString:function(value,maxLength){let len=value.replace(/\r(?!\n)|\n(?!\r)/g,"\r\n").length;return len<=maxLength},messages:{en:"This value is too long."}});window.Parsley.addValidator("maxFileSizeMb",{validateString:function(_value,maxSize,parsleyInstance){if(!window.FormData)return true;var files=parsleyInstance.$element[0].files;if(files.length===0)return true;for(var i=0;i<files.length;i++){if(files[i].size>maxSize*1024*1024)return false}return true},requirementType:"integer",messages:{en:"This file should not be larger than %s Mb"}});window.Parsley.addValidator("fileExt",{validateString:function(_value,nothing,parsleyInstance){if(!window.FormData)return true;var files=parsleyInstance.$element[0].files;if(files.length===0)return true;var exts=parsleyInstance.$element[0].getAttribute("accept").split(",");for(var i=0;i<files.length;i++){var name=files[i].name.toLowerCase();var valid=false;for(var j=0;j<exts.length;j++){if(name.endsWith(exts[j])){valid=true;break}}if(valid===false)return false}return true}});window.Parsley.addValidator("maxNumberFiles",{validateString:function(_value,maxNumber,parsleyInstance){if(!window.FormData)return true;var files=parsleyInstance.$element[0].files;if(files.length===0)return true;if(files.length>maxNumber)return false;if(files.length<maxNumber){var previous=parsleyInstance.$element.siblings(".retain_file_marker").length;if(files.length+previous>maxNumber){return false}else{return true}}return true},requirementType:"integer",messages:{en:"You are not allowed to upload more than %s files"}});window.Parsley.addValidator("dmyValidation",{validate:function(_value,requirement,instance){var field=instance.$element.parents(".form_field").data("field");if(field!==void 0)return field.validate();return true},messages:{en:"This value should be a valid date"}});window.Parsley.addValidator("fieldValidate",{validateString:function(_value,requirement,instance){let field=instance.$element.parents(".form_field").data("field");if(field!==void 0&&field.validate!==void 0){return field.validate()}return true},messages:{en:"This field is required"}});inz.forms.validators.initNZBankAccountNumberWidget()};inz.forms.escapeHTML=function(unsafe){return unsafe.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")};inz.forms.unescapeHTML=function(unsafe){return unsafe.replaceAll("&amp;","&").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&quot;",'"').replaceAll("&#039;","'")};inz.forms.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];inz.forms.adjustHeight=function(){var open=$(document).find(".accordion_content_container.active, .question_evidence.active");if(open){inz.forms.setHeight(open,false)}};inz.forms.setHeight=function(targets,animate){var i,newHeight;isSwitch=false;$(targets).css({"display":"","height":"auto"});for(i=0;i<targets.length;i=i+1){newHeight=targets[i].clientHeight;if(animate){$(targets[i]).height(0)}$(targets[i]).height(newHeight);var accordParent=$(targets[i]);if(accordParent.find(".rcd_wrap").length>0||accordParent.find(".process_downloads").length>0){setTimeout(function(){accordParent.height("auto")},333);if(!accordParent.hasClass("mobile_accord")){accordParent.find(".question_evidencetrigger, .question_evidence").removeClass("active")}}}};inz.forms.getFieldObject=function(id){return $("#"+id).data("field")};inz.forms.groups=inz.forms.groups||{};inz.forms.group_re=/g_([a-zA-Z0-9]{7,})\[(\d+)\]\.([a-zA-Z0-9]{7,})/;inz.forms.Form=class{initCfg(cfg){this.cfg=cfg;this.init($(cfg.c),cfg.i,cfg.t,cfg.h,cfg.a,cfg.s?"True":"False",cfg.l?"True":"False")}init($ctx,id,type,pid,action,canSubmit,requireLogin){this.id=id;this.type=type;this.pid=pid;this.action=action;this.uid=this.action===null||this.action===void 0?null:this.action.substring(this.action.lastIndexOf("/")+1);this.$form=$ctx.find("#"+this.id).first();this.fields={};this.groups=[];this.topFields=[];this.leaveWarning=false;this.settingValues=false;this.restoringState=false;this.enableLogging=true;this.captchaField=null;this.submitCaptchaId=null;this.submitCaptchaSiteKey=null;this.submitDisableTimer=null;this.modals={};this.requireLogin=requireLogin==="True";this.includeValuesOnSubmit=this.cfg===void 0||this.cfg.v===void 0||this.cfg.v===false?false:true;this.enableLeaveWarning=true;this.canSubmit=true;if(canSubmit==="False"){this.canSubmit=false;this.enableLeaveWarning=false;this.enableLogging=false}this.fieldMap=null;this.resvFieldIds=[];this.resvConditionFields=[];this.$form.data("form",this);this.$form.addClass("obj_form");this.parsleySetup();this.$form.find("div.form_field").each(function(){if($(this).attr("id"))$(this).attr("data-og-name",$(this).attr("id").substr(2))});this.$form.submit(this,this.submitEvent);this.$form.find(".reset_button").off("click");this.$form.find(".xreset_button").off("click");this.$form.find(".reset_button").click(this,this.resetEvent);this.$form.find(".xreset_button").click(this,this.resetEvent);$("#complete_later_button").click(this,this.saveEvent);$("body").on("form_user_logged_in",this,this.loggedInEvent);$("body").on("click","div.form_actions button.form_remove_upload",this,this.handleFileRemoveEvent);let target=$(".term_form").find(".accordion_trigger, .question_evidencetrigger, .process_accordian_trigger");this.isInAccordian=target.length>0;let form2=this;let preFormActionsButton=$(".pre_form_actions button");if(preFormActionsButton.length){$(document).keydown(function(e){if(e.keyCode===89&&e.altKey&&e.ctrlKey&&e.shiftKey){if($(".pre_form_validation").length)inz.preFormValidation.showValidationFields();else $(preFormActionsButton).trigger("click")}})}if(this.requireLogin){this.$form.find(".reset_btn").text("Cancel")}if(this.isInAccordian){$(target).on("click",function(){setTimeout(function(){form2.adjustHeight()},200)});DO.Subscribe(["app:dl_afterShow"],function(e,$2,element){setTimeout(function(){form2.adjustHeight()},200)});this.disableFieldAdjust=false;this.$form.parsley().on("form:validate",function(){form2.disableFieldAdjust=true});this.$form.parsley().on("form:validated",function(){form2.disableFieldAdjust=false;setTimeout(function(){form2.adjustHeight()},200)});this.$form.parsley().on("field:validated",function(){if(form2.disableFieldAdjust)return;setTimeout(function(){form2.adjustHeight()},200)})}this.$form.parsley().on("form:validate",function(){if(form2.uLog)form2.addLogEntry("Form","V");for(let id2 in form2.fields){if(form2.fields[id2].isDisabled()){form2.fields[id2].disableValidation();form2.fields[id2].isHidden=true}else{if(form2.fields[id2].state!==inz.forms.fields.Field.STATE_READ_ONLY)form2.fields[id2].enableValidation();form2.fields[id2].isHidden=false}}});this.$form.parsley().on("form:error",function(){if(form2.uLog)form2.addLogEntry("Form","E",form2.$form.find(".err-msg.filled").length);$("#err_banner").toggleClass("hidden",true);form2.$form.find(".banner_el").toggleClass("hidden",true);form2.$form.find(".banner_err").removeClass("hidden").addClass("open");let firstErrPos=form2.$form.find(".err-msg.filled").first().closest(".form_field").offset().top-inz.modularForms.errorScrollOffset;$("html, body").animate({"scrollTop":firstErrPos},666);if(form2.captchaField!=null)form2.captchaField.reset();if(form2.submitCaptchaSiteKey!==null){grecaptcha.reset(form2.submitCaptchaId)}});window.addEventListener("beforeunload",function(e){if(form2.enableLeaveWarning===true&&form2.leaveWarning){e.preventDefault();e.returnValue=""}if(form2.uLog&&sessionStorage.getItem("f_"+form2.pid)!==null)sessionStorage.setItem("f_"+form2.pid+"_ul",JSON.stringify(form2.uLog))});let submitCaptcha=this.$form.find(".sub-recaptcha");if(submitCaptcha.length){this.submitCaptchaSiteKey=submitCaptcha.attr("data-sitekey")}}parsleySetup(){this.$form.parsley().destroy();this.$form.parsley({inputs:Parsley.options.inputs+",[data-parsley-dmy-validation],div.ae_supporting_documents",excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden], .disable_val, [disabled]",classHandler:function(el){return el.$element.closest(".form_field")},errorsContainer:this.errorContainer,errorsWrapper:'<span class="err-msg" role="alert"></span>',errorTemplate:"<span></span>",focus:"none"})}setLeaveWarning(enable){this.enableLeaveWarning=enable}setMap(map){this.fieldMap=map;for(let grp of Object.keys(this.fieldMap)){for(let field of Object.keys(this.fieldMap[grp])){this.resvFieldIds.push(this.fieldMap[grp][field])}}}scrollToForm(){let pos=$(".term_form").offset().top;$("html, body").animate({"scrollTop":pos-50},500)}setupLogging(){this.errLogEl=document.createElement("input");this.errLogEl.setAttribute("type","hidden");this.errLogEl.setAttribute("name","__el");this.errLogEl.setAttribute("value","");this.$form[0].appendChild(this.errLogEl);this.errLog=[];let form2=this;window.addEventListener("error",function(event){let ts=Date.now();let msg=ts+","+event.filename+","+event.lineno+","+event.colno+',"'+event.message+'"';form2.errLog.push(msg)});this.uLogEl=document.createElement("input");this.uLogEl.setAttribute("type","hidden");this.uLogEl.setAttribute("name","__ul");this.uLogEl.setAttribute("value","");this.$form[0].appendChild(this.uLogEl);this.uLog=[];this.uLogStart=Date.now();let log=sessionStorage.getItem("f_"+form2.pid+"_ul");if(log)this.uLog=JSON.parse(log);this.$form.find("input[type=text], textarea, input[type=email], input[type=file]").focusin(function(event){let field=form2.findFieldByEl($(this));if(field===void 0)return;form2.addLogEntry(field.name,"F")});this.$form.find("input[type=radio], input[type=checkbox]").on("change",function(event){if(event.isTrigger!==void 0)return;let field=form2.findFieldByEl($(this));if(field===void 0)return;form2.addLogEntry(field.name,"C",field.getValue())});this.$form.find("select").on("select2:select",function(event){let field=form2.findFieldByEl($(this));if(field===void 0)return;form2.addLogEntry(field.name,"C",field.getValue())});this.addLogEntry("Form","B",Date.now())}addLogEntry(name,type,msg,ts){if(ts===void 0)ts=Date.now()-this.uLogStart;if(msg===void 0)msg="";this.uLog.push(ts+","+name+","+type+',"'+msg+'"');let form_user_action_event=new Event("form_user_action",{bubbles:true});$("body")[0].dispatchEvent(form_user_action_event)}commitLogs(){if(this.errLog){this.errLogEl.setAttribute("value",this.errLog.join("|"))}if(this.uLog){this.addLogEntry("Form","S");this.uLogEl.setAttribute("value",this.uLog.join("|"))}}findFieldByEl($el){let field=$el.data("field");if(field===void 0)field=$el.parents(".obj_form_field").first().data("field");return field}restoreState(values){if(values!==void 0&&values!==null){values=JSON.parse(values);this.setValues(values)}for(let id in this.fields){this.fields[id].initialError()}}restoreLk(lk){if(lk!==void 0&&lk!==null){let lk_val=JSON.parse(lk);$("#__apn").val(lk_val.k);if(lk_val.c!==void 0)$("#__cln").val(lk_val.c);if(lk_val.d!==void 0)$("#__dob").val(lk_val.d)}}load(config){for(let i=0;i<config.length;i++){if(config[i]["type"]in inz.forms.fields===false){console.log("Unknown field type: "+config[i]["type"]+" for field: "+config[i]);continue}if(this.submitCaptchaSiteKey!==null&&config[i]["type"]==="CaptchaField")continue;let field=Object.create(inz.forms.fields[config[i]["type"]].prototype);field.init(this,this.$form,config[i]);this.fields[config[i]["id"]]=field;if(field.parent===null)this.topFields.push(field);if(config[i]["type"]==="FieldGroup")this.groups.push(field);if(config[i]["type"]==="CaptchaField")this.captchaField=field}for(let id in this.fields){if(!this.fields[id].inGroupTmpl&&this.fields[id].config.conditions.length!==0)this.fields[id].addConditions(this.fields[id].config.conditions)}for(let id in this.fields){this.fields[id].setup(true)}for(let i=0;i<this.groups.length;i++)this.groups[i].setupGroup();this.$form.parsley()._refreshFields();if(this.requireLogin===false){let values=sessionStorage.getItem("f_"+form.pid);this.restoreState(values);let lk=sessionStorage.getItem("f_"+form.pid+"_lk");this.restoreLk(lk)}if(this.action)this.$form.attr("action",this.action);this.$form.find(':input[type="submit"]').prop("disabled",false);this.$form.find("a.xreset_button").prop("disabled",false);$(".form_pre_load_hide").show();if(this.enableLogging)this.setupLogging();this.leaveWarning=false;let form_loaded_event=new Event("form_loaded",{bubbles:true});$("body")[0].dispatchEvent(form_loaded_event)}getModal(modal_name){if(!(modal_name in this.modals)){this.modals[modal_name]=Object.create(inz.forms.modals[modal_name].prototype);this.modals[modal_name].init(this)}return this.modals[modal_name]}setupCaptcha(){if(typeof grecaptcha==="undefined"||typeof grecaptcha.render==="undefined"){return}for(let id in this.fields){if(this.fields[id]instanceof inz.forms.fields.CaptchaField)this.fields[id].setupCaptcha()}if(this.submitCaptchaSiteKey!==null){let subCaptcha=this.$form.find(".sub-recaptcha");this.submitCaptchaId=grecaptcha.render(subCaptcha.get(0),{"sitekey":this.submitCaptchaSiteKey,"callback":this.submitCaptchaCallback,"expired-callback":this.submitCaptchaExpired})}if(this.isInAccordian)this.adjustHeight()}submitCaptchaCallback(token){if(window.form&&window.form.uLog)window.form.addLogEntry("Captcha","C","Completed");window.form.submit()}submitCaptchaExpired(){if(window.form&&window.form.uLog)window.form.addLogEntry("Captcha","C","Expired")}getValues(formData){let data={};for(let id in this.fields){let value=this.fields[id].getValue();data[id]=[value,this.fields[id].isHidden,this.fields[id].state];if(formData!==void 0&&value!==void 0){if(this.fields[id].useGetOnSubmit()||this.fields[id].state===inz.forms.fields.Field.STATE_READ_ONLY){if($.type(value)==="array"){if(value.length!==0){for(let i=0;i<value.length;i++){if(i===0)formData.set(this.fields[id].getName(),value[i]);else formData.append(this.fields[id].getName(),value[i])}}else{formData.set(this.fields[id].getName(),value)}}else{formData.set(this.fields[id].getName(),value)}}}}return data}setValues(data,processConditions){this.settingValues=true;for(let i=0;i<this.groups.length;i++){let value=data[this.groups[i].id];if(value!==void 0){if(value.length>=2){if(value[1]===true){this.groups[i].hide(true)}else{this.groups[i].show(true);this.groups[i].setValue(value[0])}if(value.length===3){this.groups[i].setState(value[2])}}}}for(let id in this.fields){if(this.fields[id]instanceof inz.forms.fields.FieldGroup)continue;let value=data[id];if(value!==void 0){if(value.length>=2){if(value[1]===true){this.fields[id].hide(true)}else{this.fields[id].show(true);this.fields[id].setValue(value[0])}if(value.length===3){this.fields[id].setState(value[2])}}}}this.settingValues=false;this.$form.parsley()._refreshFields();if(processConditions!==void 0&&processConditions===true){for(let id in this.fields){if(this.fields[id]instanceof inz.forms.fields.FieldGroup)continue;let value=data[id];if(value!==void 0){this.fields[id].processConditions(void 0,void 0,true)}}}}resetForm(){for(let id in this.fields){this.fields[id].reset()}this.leaveWarning=false;sessionStorage.removeItem("f_"+form.pid);sessionStorage.removeItem("f_"+form.pid+"_ul");sessionStorage.removeItem("f_"+form.pid+"_lk");inz.forms.message.hideMessage();this.adjustHeight()}addField(field){this.fields[field.id]=field}removeField(field){delete this.fields[field.id]}getField(id){if(!(id in this.fields)){let fieldgroup_offset=id.search(/__\d/);if(fieldgroup_offset>0){let testid=id.substring(0,fieldgroup_offset);if(!(testid in this.fields)){console.log("Unknown field: "+id);return null}else{id=testid}}else{for(let x in this.fields){if(id===this.fields[x].name){return this.fields[x]}}console.log("Unknown field: "+id);return null}}return this.fields[id]}errorContainer(el){let field=el.$element.parents(".obj_form_container").data("field");if(field!==void 0)return field.getErrorContainer(el);let e=el.$element.parents(".field-col");if(e.length===0)return el.$element.parents(".form_field");return e}changeEvent(event){let field=event.data;field.form.leaveWarning=true;if(inz.login.session!==void 0&&!field.form.settingValues)inz.login.session.processEvent(inz.login.Session.Events.Active);if(field.dependants.length===0)return;if(field.form.restoringState)field.form.processDependants(field,true,true);else field.form.processDependants(field)}processDependants(field,no_default,no_reset){if(field.dependants.length===0)return;let value=field.getValue(true);let did_show=false;for(let i=0;i<field.dependants.length;i++){if(!field.form.settingValues){if(field.dependants[i].processConditions(field,value,no_default,no_reset)){did_show=true}field.dependants[i].depChanged(field,value)}}if(did_show){field.form.$form.parsley()._refreshFields();console.debug("RFF")}}loggedInEvent(event){let form2=event.data;event.preventDefault();event.stopPropagation();let dfd=$.Deferred();form2.loadDraftSubmissions().done(function(data){if("sess"in data){inz.login.session.sessionDataUpdate(data.sess)}form2.$form.append('<a style="display:none;" href="#" id="save_and_exit" class="btn btn__primary">Save and Exit</a>');let has_subs=data.submissions;if(typeof has_subs!=="undefined"){has_subs=has_subs.length}if(has_subs){let onEditDraft2=function(event2){event2.preventDefault();event2.stopPropagation();let draft_id=$(this).closest("tr").data("draftId");if($("#__si").length){$("#__si").val(draft_id)}else{form2.$form.append($("<input>",{type:"hidden",id:"__si",name:"__si",value:draft_id}))}form2.loadState().done(function(success){inz.forms.message.hideMessage();form2.adjustHeight();inz.login.session.active(false);$(".login_confirmation").show();$("#save_and_exit_initial").click(function(event3){event3.preventDefault();event3.stopPropagation();$("#save_and_exit").click()});$(".pre_form_actions .btn__primary").click();form2.leaveWarning=false;inz.login.session.processEvent(inz.login.Session.Events.Loaded,draft_id)})},applyOverlayToRow2=function(tableRow,content,colspan){let tr=$(tableRow);tr.closest("table").find("tr.overlaid").each(function(){removeOverlayFromRow2(this)});const minHeight=tr.innerHeight();const headerCells=tr.closest("table").find("tr:first-of-type th").get();const columnWidths=headerCells.map(e=>e.getBoundingClientRect().width);for(let n=0;n<columnWidths.length;n++){headerCells[n].style.width=columnWidths[n]+"px"}tr.data("originalContent",tr.children().detach());tr.append($("<td>",{colspan}).append($("<div>",{style:`min-height: ${minHeight}px`,"class":"form_modal_overlay",html:content})));tr.addClass("overlaid")},applyPromptActionsOverlayToRow2=function(tableRow,promptContent,actionButtons,colspan){let content=$("<div>");content.append($("<div>",{"class":"form_modal_prompt",html:$(promptContent)}));content.append($("<div>",{"class":"form_modal_actions",html:$(actionButtons)}));applyOverlayToRow2(tableRow,content.children(),colspan)},applyExistingDraftFormOverlay2=function(tableRow,promptContent,actionButtons){applyPromptActionsOverlayToRow2(tableRow,promptContent,actionButtons,3)},removeOverlayFromRow2=function(tableRow){let tr=$(tableRow);tr.closest("table").find("tr:first-of-type th").css("width","");tr.empty();tr.append(tr.data("originalContent"));tr.removeClass("overlaid")},onDeleteDraft2=function(event2){inz.login.session.active(false);let tr=$(this).closest("tr");let statusContent=$("<div>");statusContent.append($("<h4>",{"class":"draft_title",text:tr.data("draft")["label"]?tr.data("draft")["label"]:UNNAMED_DRAFT_LABEL}));statusContent.append($("<p>",{text:"Are you sure you want to delete this draft?"}));applyExistingDraftFormOverlay2(tr,statusContent.children(),$("<div>").append($("<button>",{"class":"btn btn__primary btn__inline_right confirm_delete",type:"button",text:"Delete",click:onDeleteDraftConfirmation2})).append($("<button>",{"class":"btn btn__secondary btn__inline_right",type:"button",text:"Cancel",click:function(){removeOverlayFromRow2(tr)}})).children())},onDeleteDraftConfirmation2=function(event2){event2.preventDefault();event2.stopPropagation();inz.login.session.active(false);let tr=$(this).closest("tr");let draftId=tr.data("draftId");let formData=new FormData;formData.append("submission_id",draftId);$.ajax({type:"POST",url:"/@@acc_sf_remove/"+form2.uid,cache:false,data:formData,processData:false,contentType:false}).done(function(data2,textStatus,xhr){tr.remove()}).fail(function(xhr,textStatus,errorThrown){console.error(`Error deleting draft ${draftId}: status: ${xhr.status} / textStatus: ${textStatus} / errorThrown: ${errorThrown}`);let p=tr.find(".form_modal_prompt p");p.text("Unable to delete this draft. Please try again later.");p.addClass("form_modal_error");tr.find(".form_modal_actions button.confirm_delete").attr("disabled",true)})},onRenameDraft2=function(event2){let tr=$(this).closest("tr");inz.login.session.active(false);function renameOnEnter(e){if(e.keyCode===13){e.preventDefault();e.stopPropagation();tr.find("button.confirm_rename").click()}}let input=$("<input>",{type:"text","keydown":renameOnEnter,"maxlength":40}).attr("placeholder","Enter new draft name");let statusContent=$("<div>");statusContent.append($("<h4>",{"class":"draft_title",text:tr.data("draft")["label"]?tr.data("draft")["label"]:UNNAMED_DRAFT_LABEL}));statusContent.append(input);applyExistingDraftFormOverlay2(tr,statusContent.children(),$("<div>").append($("<button>",{"class":"btn btn__primary btn__inline_right confirm_rename",type:"button",text:"Rename",click:onRenameDraftConfirmation2})).append($("<button>",{"class":"btn btn__secondary btn__inline_right",type:"button",text:"Cancel",click:function(){removeOverlayFromRow2(tr)}})).children());input.focus()},onRenameDraftConfirmation2=function(event2){event2.preventDefault();event2.stopPropagation();inz.login.session.active(false);let tr=$(this).closest("tr");let draftId=tr.data("draftId");let newLabel=tr.find(".form_modal_prompt input").val().trim();let formData=new FormData;formData.append("submission_id",draftId);formData.append("label",newLabel);$.ajax({type:"POST",url:"/@@acc_sf_rename/"+form2.uid,cache:false,data:formData,processData:false,contentType:false}).done(function(data2,textStatus,xhr){removeOverlayFromRow2(tr);tr.find("td.label button").text(newLabel?newLabel:UNNAMED_DRAFT_LABEL);tr.data("draft").label=newLabel}).fail(function(xhr,textStatus,errorThrown){console.error(`Error renaming draft ${draftId}: status: ${xhr.status} / textStatus: ${textStatus} / errorThrown: ${errorThrown}`);let formModalPrompt=tr.find(".form_modal_prompt");formModalPrompt.find("p").remove();formModalPrompt.append($("<p>",{"class":"form_modal_error",text:"Unable to rename this draft. Please try again later."}));tr.find(".form_modal_actions button.confirm_rename, .form_modal_prompt input").attr("disabled",true)})};var onEditDraft=onEditDraft2,applyOverlayToRow=applyOverlayToRow2,applyPromptActionsOverlayToRow=applyPromptActionsOverlayToRow2,applyExistingDraftFormOverlay=applyExistingDraftFormOverlay2,removeOverlayFromRow=removeOverlayFromRow2,onDeleteDraft=onDeleteDraft2,onDeleteDraftConfirmation=onDeleteDraftConfirmation2,onRenameDraft=onRenameDraft2,onRenameDraftConfirmation=onRenameDraftConfirmation2;const UNNAMED_DRAFT_LABEL="Unnamed Draft";let message=$("<div></div>");message.append("<p>Select 'Open' to view or edit a draft. If you want to start a new draft, select 'Create New'.</p>");let submissionTable=$('<table class="savedDrafts"><thead><tr><th>Name</th><th class="created">Created</th><th>Options</th></tr></thead><tbody></tbody></table>');let tbody=submissionTable.find("tbody");for(const draft of data.submissions){const createdDate=new Date(draft.created*1e3);const createdDateHtml=`${createdDate.getDate()} ${inz.forms.months[createdDate.getMonth()]} ${createdDate.getFullYear()} <span>${createdDate.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:true})}</span>`;let tr=$("<tr>",{"data-draft-id":draft.submission_id});tr.data("draft",draft);tr.append($("<td>",{"class":"label"}).append($("<button>",{type:"button","class":"btn btn__tertiary edit_draft",text:draft.label?draft.label:UNNAMED_DRAFT_LABEL,click:onEditDraft2}).append($("<p>",{"class":"inline_created",html:createdDateHtml}))));tr.append($("<td>",{"class":"created",html:createdDateHtml}));tr.append($("<td>",{"class":"actions"}).append($("<div>").append($("<button>",{type:"button","class":"btn btn__primary edit_draft",text:"Open",click:onEditDraft2})).append($("<button>",{type:"button","class":"btn btn__secondary",text:"Rename",click:onRenameDraft2})).append($("<button>",{type:"button","class":"btn btn__secondary",text:"Delete",click:onDeleteDraft2}))));tbody.append(tr)}submissionTable.append(tbody);message.append(submissionTable);message.append('<input name="create_new_submission" class="btn btn__blockxs btn__primary center-block" type="submit" value="Create New" />');message.append('<input name="submission_log_out" class="btn btn__blockxs btn__secondary center-block" type="submit" value="Log Out" />');inz.forms.message.showMessage(message,"Existing drafts",null,false);$('.modal_forms_message input[name="create_new_submission"]').on("click",function(event2){event2.preventDefault();event2.stopPropagation();$(this).attr("disabled","disabled");$('.modal_forms_message input[name="submission_log_out"]').attr("disabled","disabled");form2.$form.find("#save_and_exit").before('<fieldset class="form_field"><input class="input" style="display:none;" maxlength="40" type="text" id="__submission_label" name="__submission_label" placeholder="Enter a name to save this daft" /></fieldset>');$("#save_and_exit_initial").click(function(event3){event3.preventDefault();event3.stopPropagation();$("div.actions").hide();form2.setAllowSubmit(false);$("#__submission_label").show();$("#save_and_exit").show();form2.adjustHeight()});form2.resetForm();$(".login_confirmation").show();inz.login.session.processEvent(inz.login.Session.Events.New);form2.scrollToForm()});$('.modal_forms_message input[name="submission_log_out"]').on("click",function(event2){event2.preventDefault();event2.stopPropagation();$(this).attr("disabled","disabled");$('.modal_forms_message input[name="create_new_submission"]').attr("disabled","disabled");inz.forms.message.hideMessage();inz.forms.message.showMessage("","Logging out","",true);inz.login.session.processEvent(inz.login.Session.Events.LogOut)});inz.login.session.processEvent(inz.login.Session.Events.Drafts)}else{inz.forms.message.hideMessage();form2.adjustHeight();form2.resetForm();$(".login_confirmation").show();form2.$form.find("#save_and_exit").before('<fieldset class="form_field"><input class="input" style="display:none;" maxlength="40" type="text" id="__submission_label" name="__submission_label" placeholder="Enter a name to save this draft" /></fieldset>');$("#save_and_exit_initial").click(function(event2){event2.preventDefault();event2.stopPropagation();$("div.actions").hide();form2.setAllowSubmit(false);$("#__submission_label").show();$("#save_and_exit").show();form2.adjustHeight()});inz.login.session.processEvent(inz.login.Session.Events.New);form2.scrollToForm()}})}loadDraftSubmissions(){let dfd=$.Deferred();$.ajax({type:"POST",url:"/@@acc_sf_list/"+this.uid,cache:false,processData:false,contentType:false}).done(function(data,textStatus,xhr){return dfd.resolve(data)}).fail(function(xhr,textStatus,errorThrown){console.log("LDS - Result: "+xhr.status+" / "+textStatus+" / "+errorThrown);return dfd.resolve({"submissions":[]})});return dfd.promise()}saveEvent(event){event.preventDefault();event.stopPropagation();let form_user_save_event=new Event("form_user_save",{bubbles:true});$("body")[0].dispatchEvent(form_user_save_event);$("#complete_later_button").attr("disabled","disabled");inz.forms.message.showMessage("<p>Your data is being saved for later</p>","Saving Progress","Data Saving",true);form.saveState().done(function(){inz.forms.message.hideMessage();$("#complete_later_button").removeAttr("disabled");form.adjustHeight()});return false}saveState(){let dfd=$.Deferred();let form2=this;let values=form2.getValues();for(let id in this.fields){if(this.fields[id]instanceof inz.forms.fields.Upload){values[id][0]="[]"}}let formData=new FormData;sessionStorage.setItem("f_"+this.pid,JSON.stringify(values));sessionStorage.setItem("f_"+this.pid+"_ul",JSON.stringify(this.uLog));if($("#__apn").length){var lk={"k":$("#__apn").val()};if($("#__cln").length){lk.c=$("#__cln").val()}if($("#__dob").length){lk.d=$("#__dob").val()}sessionStorage.setItem("f_"+this.pid+"_lk",JSON.stringify(lk))}let userfiles=form2.$form.find(':input[type="file"]');userfiles.each(function(i){if(this.files.length){for(let i2=0;i2<this.files.length;i2++){formData.append($(this).attr("name"),this.files[i2])}}else{if(!$(this).is(":hidden")){formData.append($(this).attr("name"),null)}}});let transientfiles=form2.$form.find("input.uploadField");transientfiles.each(function(i){formData.append($(this).attr("name"),$(this).val())});formData.append("__session_values",JSON.stringify(values));if(lk!==void 0&&lk!==null){formData.append("__session_lk",JSON.stringify(lk))}formData.append("__session_incomplete",1);if($("#__si").length){formData.append("submission_id",$("#__si").val())}formData.append("__ul",JSON.stringify(this.uLog));$('input[name="__retain_files:list"]').each(function(i){formData.append("__retain_files:list",$(this).val())});if($("#__submission_label").length){formData.append("__submission_label",$("#__submission_label").val())}$.ajax({type:"POST",url:"/@@acc_sf_save/"+this.uid,data:formData,cache:false,processData:false,contentType:false}).done(function(data,textStatus,xhr){console.log("SS: "+xhr.status+" "+data.result);if(data.result==="success"){if($("#__si").length){$("#__si").val(data.submission_id)}else{form2.$form.append('<input type="hidden" id="__si" name="__si" value="'+data.submission_id+'" />')}$("div.form_actions.uploaded_file").remove();for(let i=0;i<data.submission_data.files.length;i++){form2.setupUploadedFileUi(data.submission_data.files[i])}form2.leaveWarning=false}else if(data.result==="failed"){form2.showErrors(data.errors);if(form2.captchaField!=null)form2.captchaField.reset();if(form2.submitCaptchaSiteKey!==null){grecaptcha.reset(form2.submitCaptchaId)}form2.adjustHeight();return dfd.resolve(false)}return dfd.resolve(true)}).fail(function(xhr,textStatus,errorThrown){console.log("SS - Result: "+xhr.status+" / "+textStatus+" / "+errorThrown);$("#err_banner").toggleClass("hidden",false);$("body").scrollTo("#err_banner");return dfd.resolve(false)});return dfd.promise()}loadState(){let formData=new FormData;if($("#__si").length){formData.append("submission_id",$("#__si").val())}let dfd=$.Deferred();let _this=this;$.ajax({type:"POST",url:"/@@acc_sf_load/"+this.uid,data:formData,cache:false,processData:false,contentType:false}).done(function(data,textStatus,xhr){if(data.submission_id){if($("#__si").length){$("#__si").val(data.submission_id)}else{this.$form.append('<input type="hidden" id="__si" name="__si" value="'+data.submission_id+'" />')}}if(data.__session_values){_this.restoreState(data.__session_values)}if(data.__session_lk){_this.restoreLk(data.__session_lk)}if(data.files){let field=null;for(let fileinfo of data.files){if(fileinfo.fieldhash!==field){if(fileinfo.fieldhash.startsWith("g_")){field=null;let match=fileinfo.fieldhash.match(inz.forms.group_re);if(match!==null){let nam=`${match[3]}__${match[2]}`;field=_this.getField(nam)}}else{field=_this.getField(fileinfo.fieldhash)}}if(field!==void 0&&field!==null&&field.addSavedFile!==void 0){field.addSavedFile(fileinfo)}else{_this.setupUploadedFileUi(fileinfo)}}}return dfd.resolve(true)}).fail(function(xhr,textStatus,errorThrown){console.log("LS - Result: "+xhr.status+" / "+textStatus+" / "+errorThrown);return dfd.resolve(false)});return dfd.promise()}setupUploadedFileUi(fileinfo){let f_input=$('input[name="'+fileinfo.fieldhash+'"]');if(f_input.length){f_input.after('<input type="hidden" class="retain_file_marker" id="file_'+fileinfo.unique_id+'" name="__retain_files:list" value="'+fileinfo.unique_id+'" />');f_input.after('<div class="form_actions uploaded_file"><p>Existing saved file: '+fileinfo.filename+" (size "+fileinfo.size+')<br /><button type="button" data-file-fingerprint="'+fileinfo.unique_id+'" class="form_remove_item form_remove_upload" style="display: block;">Remove file</button></p><hr /></div>');f_input.val(null);this.checkFileInputAvailability(f_input)}}handleFileRemoveEvent(event){let form2=event.data;event.preventDefault();event.stopPropagation();let button=$(this);let file_id=button.data().fileFingerprint;let related_input=$("input#file_"+file_id).siblings("input[type=file]");button.parent("p").parent("div.uploaded_file").remove();form2.removeSavedFile(file_id);form2.checkFileInputAvailability(related_input)}removeSavedFile(file_id){$("input#file_"+file_id).remove()}checkFileInputAvailability(input_element){if($(input_element).data().parsleyMaxNumberFiles){if($(input_element).siblings(".retain_file_marker").length>=$(input_element).data().parsleyMaxNumberFiles){$(input_element).hide()}else{$(input_element).show()}}else{if($(input_element).siblings(".retain_file_marker").length){$(input_element).hide()}else{$(input_element).show()}}}focusOut(event){}submitEvent(event){let form2=event.data;event.preventDefault();event.stopPropagation();if(form2.canSubmit===false)return false;form2.setAllowSubmit(false,"Submitting");if(form2.submitCaptchaSiteKey!==null){form2.submitDisableTimer=setTimeout(function(){form2.setAllowSubmit(true);form2.submitDisableTimer=null},7e4);grecaptcha.execute(form2.submitCaptchaId);return false}form2.submit();return false}setAllowSubmit(allow_submit,label){allow_submit=!allow_submit;if(label!==void 0){form.$form.find(':input[type="submit"]').prop("disabled",allow_submit).val(label)}else{form.$form.find(':input[type="submit"]').prop("disabled",allow_submit).val("Submit form")}form.$form.find("a.reset_btn").toggleClass("disabled",allow_submit);form.$form.find("#save_and_exit_initial").toggleClass("disabled",allow_submit)}submit(){let disabled=[];let form2=this;if(form2.submitDisableTimer!==null){clearTimeout(form2.submitDisableTimer);form2.submitDisableTimer=null}for(let id in this.fields){if(this.fields[id].isDisabled()){disabled.push(this.fields[id].name)}}this.$form.find("#__disabled").val(disabled.join("|"));this.commitLogs();this.leaveWarning=false;let formData=new FormData(this.$form[0]);let values=this.getValues(formData);sessionStorage.setItem("f_"+this.pid,JSON.stringify(values));sessionStorage.setItem("f_"+this.pid+"_ul",JSON.stringify(this.uLog));if($("#__apn").length){var lk={"k":$("#__apn").val()};if($("#__cln").length){lk.c=$("#__cln").val()}if($("#__dob").length){lk.d=$("#__dob").val()}sessionStorage.setItem("f_"+this.pid+"_lk",JSON.stringify(lk))}this.setAllowSubmit(false,"Submitting");$("#err_banner").toggleClass("hidden",true);form2.$form.find(".banner_el").toggleClass("hidden",true);form2.$form.find(".banner_err").toggleClass("hidden",true);if($("#__si").length){formData.append("submission_id",$("#__si").val())}if(this.includeValuesOnSubmit)formData.append("__v",JSON.stringify(values));if(lk!==void 0&&lk!==null){formData.append("__lk",JSON.stringify(lk))}$.ajax({type:"POST",url:this.action,data:formData,cache:false,processData:false,contentType:false}).done(function(data,textStatus,xhr){form2.setAllowSubmit(true);console.log("S - Result: "+xhr.status+" "+data.result);if(data.result==="success"){sessionStorage.removeItem("f_"+form2.pid);sessionStorage.removeItem("f_"+form2.pid+"_ul");sessionStorage.removeItem("f_"+form2.pid+"_lk");if(data.url!==void 0){window.location=data.url;return}if(data.header!==void 0&&data.header!==null){$("#success_page").find("h2.banner_title").html(data.header)}$("#success_page").find("div.banner_text").html(data.msg);if(data.style!==void 0){if(data.style==="alert"){$("#success-banner").removeClass("banner__message");$("#success-banner").addClass("banner__alert");$("#success-banner").find("span.banner_icon").attr("class","banner_icon banner_icon__alert")}else{$("#success-banner").removeClass("banner__alert");$("#success-banner").addClass("banner__message");$("#success-banner").find("span.banner_icon").attr("class","banner_icon banner_icon__comms")}}$("#submit_page").hide();$("#success_page").show();$("body").scrollTo("#success_page");$(".form_pre_load_hide").hide()}else if(data.result==="failed"){form2.showErrors(data.errors,data.el);if(form2.captchaField!=null)form2.captchaField.reset();if(form2.submitCaptchaSiteKey!==null){grecaptcha.reset(form2.submitCaptchaId)}form2.adjustHeight()}}).fail(function(xhr,textStatus,errorThrown){console.log("S - Result: "+xhr.status+" / "+textStatus+" / "+errorThrown);let rep_data={"s":xhr.status,"ts":textStatus,"err":errorThrown,"rs":xhr.readyState,"hdr":xhr.getAllResponseHeaders()};let rs=false;if(xhr.status===403){let match=xhr.responseText.match(/Support ID (\d+)/);if(match!==null&&match.length===2){rep_data["rs_id"]=match[1];rs=true}}form2.sfer(rep_data);if(rs){$("#err_banner").find(".s_error").hide();$("#err_banner").find(".r_error").show()}else{$("#err_banner").find(".s_error").show();$("#err_banner").find(".r_error").hide()}$("#err_banner").toggleClass("hidden",false);$("body").scrollTo("#err_banner");form2.setAllowSubmit(true);if(form2.captchaField!=null)form2.captchaField.reset();if(form2.submitCaptchaSiteKey!==null){grecaptcha.reset(form2.submitCaptchaId)}form2.adjustHeight()})}sfer(repData){if(repData===void 0||repData==null)repData={};repData["_action"]=this.action;repData["_id"]=window.location.href.substring(window.location.href.lastIndexOf("/")+1);repData["_pid"]=this.pid;repData["_clog"]=console.lg;repData["_ulog"]=this.uLog;repData["_elog"]=this.errLog;repData["_type"]=this.type;repData["_url"]=window.location.href;$.ajax({type:"POST",url:"/@@acc_sf_er",data:repData,cache:false,processData:true}).done(function(data,textStatus,xhr){console.log("sfer result: "+xhr.status+" "+data.result);if(data.result==="success"){}else if(data.result==="failed"){}}).fail(function(xhr,textStatus,errorThrown){console.log("sfer Result: "+xhr.status+" / "+textStatus+" / "+errorThrown)})}showErrors(errs,el){if(el!==void 0){if(el===1){let banner=this.$form.find(".banner_el");banner.removeClass("hidden").addClass("open");firstErrPos=this.$form.find(".banner_el").first().offset().top-inz.modularForms.errorScrollOffset;$("html, body").animate({"scrollTop":firstErrPos},600);return}}for(let i=0;i<errs.length;i++){let field=this.getField(errs[i].id);field.config["error"]=errs[i]["error"];field.initialError()}let firstErrPos;this.$form.find(".banner_err").removeClass("hidden").addClass("open");if(this.$form.find(".err-msg.filled").length>0){firstErrPos=this.$form.find(".err-msg.filled").first().closest(".form_field").offset().top-inz.modularForms.errorScrollOffset}else{firstErrPos=this.$form.find(".banner_err").first().offset().top-inz.modularForms.errorScrollOffset}$("html, body").animate({"scrollTop":firstErrPos},600)}resetEvent(event){sessionStorage.removeItem("f_"+form.pid);sessionStorage.removeItem("f_"+form.pid+"_ul");sessionStorage.removeItem("f_"+form.pid+"_lk")}adjustHeight(){let open=$(document).find(".accordion_content_container.active, .question_evidence.active");if(open)this.setHeight(open,false)}setHeight(targets,animate){let i,newHeight;$(targets).css({"display":"","height":"auto"});for(i=0;i<targets.length;i=i+1){newHeight=targets[i].clientHeight;if(animate){$(targets[i]).height(0)}$(targets[i]).height(newHeight);let accordParent=$(targets[i]);if(accordParent.find(".rcd_wrap").length>0||accordParent.find(".process_downloads").length>0){setTimeout(function(){accordParent.height("auto")},333);if(!accordParent.hasClass("mobile_accord")){accordParent.find(".question_evidencetrigger, .question_evidence").removeClass("active")}}}}};inz.forms.message=inz.forms.message||{};inz.forms.message.showMessage=function(body,title,subtitle,showSpinner,highlightBackground){let form_message=$(".modal_forms_message");if(form_message.length<1){return}let message_body=$(form_message).find(".modal_forms_message_body");$(message_body).empty();if(title){$(form_message).find(".modal_forms_message_title").html(title)}if(subtitle){$(message_body).append($("<h2>",{html:subtitle}))}if(body){$(message_body).append($(body))}if(showSpinner===void 0||Boolean(showSpinner)){$(form_message).find(".modal_forms_message_spinner").show()}else{$(form_message).find(".modal_forms_message_spinner").hide()}form_message.toggleClass("highlightBackground",highlightBackground===void 0||Boolean(highlightBackground));$(form_message).show();$(".form_pre_load_hide").hide()};inz.forms.message.scrollToMessage=function(){let pos=$(".modal_forms_message").offset().top;$("html, body").animate({"scrollTop":pos-50},500)};inz.forms.message.hideMessage=function(){$(".modal_forms_message").hide();$(".form_pre_load_hide").show()};


inz.forms=inz.forms||{};inz.forms.panel=inz.forms.panel||{};(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent2(event,params){params=params||{bubbles:false,cancelable:false,detail:null};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}window.CustomEvent=CustomEvent2})();$(window).ready(function(){for(let idx in window.inz.lhf){let form=window.inz.lhf[idx];form.form=inz.forms.panel.createForm($("body"),form.id,form.type,form.pid,inz.lhf_context?inz.lhf_context:inz.forms.panel.contexts.LOGIN_HEADER,form.el_prefix);form.form.load(form.config);form.form.nextPanel()}const loginBtn=document.getElementsByClassName("nav_trigger__login");if(loginBtn.length>0){loginBtn[0].addEventListener("click",()=>{setTimeout(function(){for(let idx in window.inz.lhf){let form=window.inz.lhf[idx];form.form.reset()}},333)})}const mobileLoginBtn=document.getElementsByClassName("nav_mobile_trigger__login");if(mobileLoginBtn.length>0){mobileLoginBtn[0].addEventListener("click",()=>{setTimeout(function(){for(let idx in window.inz.lhf){let form=window.inz.lhf[idx];form.form.reset()}},333)})}inz.forms.panel.setup_cta_forms();inz.forms.panel.setup_details_cta_forms()});inz.forms.panel.setup_cta_forms=function(){for(let idx in window.inz.ctf){let form=window.inz.ctf[idx];form.form=inz.forms.panel.createForm($("body"),form.id,form.type,form.pid,inz.forms.panel.contexts.PAGE_CTA);form.form.load(form.config);form.form.nextPanel()}const btns=document.getElementsByClassName("btn_popout");if(btns.length>0){for(let idx in btns){let btn=btns[idx];if(btn.tagName==="BUTTON"&&btn.id.startsWith("submit_eoi_btn")){btn.addEventListener("click",()=>{setTimeout(function(){for(let idx2 in window.inz.ctf){let form=window.inz.ctf[idx2];form.form.reset()}},333)})}}}};inz.forms.panel.setup_details_cta_forms=function(){if(window.inz.details.ls===void 0||window.inz.details.ls.config===void 0)return;let form=window.inz.details.ls.config;form.form=inz.forms.panel.createForm($("body"),form.id,form.type,form.pid,inz.forms.panel.contexts.PAGE_DETAILS);form.form.load(form.config);form.form.nextPanel();$("#details_login_lightbox").on("inz_lightbox:hidden",function(event,lightbox){window.inz.details.ls.config.form.reset()})};inz.forms.panel.getLoginForm=function(formId){for(let idx in window.inz.lhf){if(window.inz.lhf[idx].id===formId){return window.inz.lhf[idx].form}}};inz.forms.panel.htmlDecode=function(input){let e=document.createElement("textarea");e.innerHTML=input;return e.childNodes.length===0?"":e.childNodes[0].nodeValue};inz.forms.panel.contexts={LOGIN_HEADER:"login_header",LOGIN_LIGHTBOX:"login_lightbox",PAGE_CTA:"page_cta",PAGE_DETAILS:"page_details"};inz.forms.panel.createForm=function($ctx,id,type,pid,panelContext,elPrefix){return new inz.forms.panel.Form($ctx,id,type,pid,panelContext,elPrefix)};inz.forms.panel.createElement=function(tagName,props,attributes){let el=document.createElement(tagName);if(props!==void 0){for(const[k,v]of Object.entries(props)){el[k]=v}}if(attributes!==void 0){for(const[k,v]of Object.entries(attributes)){el.setAttribute(k,v)}}return el};inz.forms.panel.events={PANEL_SHOWN:"forms:panel:shown",PANEL_HIDDEN:"forms:panel:hidden"};inz.forms.panel.Form=class{constructor($ctx,id,type,pid,panelContext,elPrefix){this.id=id;this.type=type;this.pid=pid;if(elPrefix===void 0)this.elPrefix="";else this.elPrefix=elPrefix;this.panelContext=panelContext;this.$form=$ctx.find("#"+this.id).first();this.fields={};this.panels=[];this.curPanel=void 0;this.containerEl=document.getElementById(id);this.containerEl.classList.add("panel-form-container")}load(config){for(let i2=0;i2<config.length;i2++){if(!(config[i2]["type"]in inz.forms.panel.fields)){console.log("Unknown field type: "+config[i2]["type"]+" for field: "+config[i2]);continue}let field=new inz.forms.panel.fields[config[i2]["type"]](this,this.$form,this.panelContext,config[i2]);this.fields[config[i2]["id"]]=field;if(config[i2]["type"]==="FieldPanel"||config[i2]["type"]==="FieldOnlineService")this.panels.push(field)}for(let fieldId in this.fields){if(this.fields[fieldId].config.conditions.length!==0)this.fields[fieldId].addConditions(this.fields[fieldId].config.conditions)}for(let fieldId in this.fields){this.fields[fieldId].setup(true)}}fireEvent(src,name,data,bubbles=true){let event=new CustomEvent(name,{bubbles,detail:data});src.dispatchEvent(event)}nextPanel(panelId){if(panelId===void 0){if(this.curPanel!==void 0&&this.curPanel.rendered()){this.curPanel.hide();this.fireEvent(this.curPanel.container,inz.forms.panel.events.PANEL_HIDDEN,this.curPanel)}this.curPanel=this.panels[0]}else{if(this.curPanel!==void 0&&this.curPanel.rendered()){this.curPanel.hide();this.fireEvent(this.curPanel.container,inz.forms.panel.events.PANEL_HIDDEN,this.curPanel)}this.curPanel=this.getField(panelId)}if(!this.curPanel.rendered()){let content=this.curPanel.render();this.containerEl.appendChild(content);this.curPanel.attached();this.fireEvent(this.curPanel.container,inz.forms.panel.events.PANEL_SHOWN,this.curPanel)}else{this.curPanel.show();this.fireEvent(this.curPanel.container,inz.forms.panel.events.PANEL_SHOWN,this.curPanel)}}reset(){this.nextPanel(this.panels[0].id)}getValues(){var data={};for(var id in this.fields){var value=this.fields[id].getValue();data[id]=[value,this.fields[id].isHidden]}return data}setValues(data){for(var i2=0;i2<this.groups.length;i2++){var value=data[this.groups[i2].id];if(value!==void 0){if(value.length===2){if(value[1]===true){this.groups[i2].hide(true)}else{this.groups[i2].show(true);this.groups[i2].setValue(value[0])}}}}for(var id in this.fields){if(this.fields[id]instanceof inz.forms.fields.FieldGroup)continue;var value=data[id];if(value!==void 0){if(value.length===2){if(value[1]===true){this.fields[id].hide(true)}else{this.fields[id].show(true);this.fields[id].setValue(value[0])}}}}}addField(field){this.fields[field.id]=field}removeField(field){delete this.fields[field.id]}getField(id){if(id in this.fields===false){console.log("Unknown field: "+id);return null}return this.fields[id]}changeEvent(event){let field=event.data;if(field.dependants.length===0)return;let value=field.getValue();for(let i2=0;i2<field.dependants.length;i2++){field.dependants[i2].processConditions(field,value)}}focusOut(event){}};inz.forms.panel.Condition=class{constructor(form,field,config){this.form=form;this.field=field;this.testType=config.test;this.testValue=config.tvalue;this.op=config.op;this.dependField=form.getField(config.depends);if(this.dependField!==null)this.dependField.addDependant(this.field)}isValid(){return this.dependField!==null}remove(){this.dependField.removeDependant(this.field)}update(field,dependant){this.field=field;this.dependField=dependant;this.dependField.addDependant(this.field)}test(value){if(value===void 0)value=this.dependField.getValue();var isArray=$.isArray(value);switch(this.testType){case"VALUE":if(isArray&&value.length!==0||!isArray&&value)return true;break;case"NO_VALUE":if(isArray&&value.length===0||!isArray&&!value)return true;break;case"MATCHES_VALUE":if(isArray&&$.inArray(this.testValue,value)!==-1||!isArray&&value===this.testValue)return true;break;case"NOT_MATCHES_VALUE":if(isArray&&$.inArray(this.testValue,value)===-1||!isArray&&value!==this.testValue)return true;break;case"HAS_VALUE_AND_NOT_MATCHES_VALUE":if(isArray&&value.length===0||!isArray&&!value)return false;if(isArray&&$.inArray(this.testValue,value)===-1||!isArray&&value!==this.testValue)return true;break}return false}};inz.forms.panel.fields={};inz.forms.panel.fields.Field=class{constructor(form,$ctx,panelContext,config){this.form=form;this.container=void 0;this.el=void 0;this.panelContext=panelContext;this.config=config;this.name=config.name;this.id=config.id;this.display=config.display;this.isHidden=this.display=="SHOW";this.children=[];this.parent=null;this.conditions=[];this.dependants=[];if("parent"in config){let parent=this.form.getField(config.parent);if(parent===null)console.log("Form Error: Parent: "+config.parent+" not in fields registry");else{this.parent=parent;this.parent.addChild(this)}}}rendered(){return this.container!==void 0}renderContainer(){this.container=document.createElement("div");this.container.className="obj_form_container";this.container.id=`c_${this.form.elPrefix}_${this.id}`;return this.container}renderField(){this.el=document.createElement("div");this.el.className="obj_form_field";this.el.id=`f_${this.form.elPrefix}_${this.id}`;this.el.setAttribute("data-fid",this.id);return this.el}render(context){let container=this.renderContainer();let field=this.renderField();let def=document.createElement("h1");def.textContent=this.name;field.appendChild(def);container.appendChild(field);return this.container}attached(){}addConditions(conditions2){for(let i2=0;i2<conditions2.length;i2++){let cond=new inz.forms.panel.Condition(this.form,this,conditions2[i2]);if(cond.isValid())this.conditions.push(cond)}}addCondition(condition){let cond=new inz.forms.panel.Condition(this.form,this,conditions[i]);if(cond.isValid())this.conditions.push(cond)}addChild(child){this.children.push(child)}addDependant(dependant){if(dependant in this.dependants)return;this.dependants.push(dependant)}removeDependant(dependant){let i2=this.dependants.indexOf(dependant);if(i2>-1)this.dependants.splice(i2,1)}addChildren(children){$.merge(this.children,children)}setup(initial){}defaultDisplay(){}getName(){return this.el.name}setName(name){this.name=name;this.el.name=name}getId(){return this.el.id}setId(id){this.id=id;this.el.id=`f_${this.form.elPrefix}_${this.id}`;this.container.id=`c_${this.form.elPrefix}_${this.id}`}hasValue(){return true}getElement(){return this.el}getValue(){return this.el.value}setValue(value){this.el.value=value;$(this.el).val(value).change()}reset(){$(this.el).val("").change()}show(initial){this.isHidden=false;this.reset();this.container.style.display=""}hide(initial){this.isHidden=true;this.reset();this.container.style.display="none"}processConditions(src,value){for(let i2=0;i2<this.conditions.length;i2++){const cond=this.conditions[i2];if(src===void 0||cond.dependField===src){if(cond.test(value)){switch(cond.op){case"SHOW":if(this.isHidden){this.show()}break;case"HIDE":if(!this.isHidden){this.hide()}break;case"NEXT":this.form.nextPanel(this.id);break}return}}}this.defaultDisplay()}};inz.forms.panel.fields.FieldPanel=class extends inz.forms.panel.fields.Field{constructor(form,$ctx,panelContext,config){super(form,$ctx,panelContext,config)}reset(){for(let child of this.children){child.reset()}}setup(initial){this.defaultDisplay()}hasValue(){return false}renderLoginHeader(){let doc=document.createElement("div");doc.className="obj_form_container";doc.id=`c_${this.form.elPrefix}_${this.id}`;switch(this.panelContext){case inz.forms.panel.contexts.LOGIN_LIGHTBOX:case inz.forms.panel.contexts.PAGE_DETAILS:{doc.innerHTML=`
                    <h1>${this.config.content.title}</h1>
                    ${this.config.content.intro?inz.forms.panel.htmlDecode(this.config.content.intro):""}                
                    <div class="header_login_content panel_content"></div>`;break}case inz.forms.panel.contexts.PAGE_CTA:{doc.innerHTML=`
                    <div class="row">
                        <div class="col-pgmd-6">
                            <h4 class="popout_title">${this.config.content.title}</h4>
                        </div>
                        <div class="col-pgmd-13 popout__login_content">
                            ${this.config.content.intro?inz.forms.panel.htmlDecode(this.config.content.intro):""}
                            <div class="header_login_content panel_content">                    
                            </div>                                                            
                        </div>
                    </div>`;break}default:{doc.innerHTML=`
                    <div class="row">
                        <div class="col-md-2">
                            <h4 class="header_login_title">${this.config.content.title}</h4>
                        </div>
                        <div class="col-md-5">
                            <div class="header_login_text">${this.config.content.intro?inz.forms.panel.htmlDecode(this.config.content.intro):""}</div>                
                        </div>
                        <div class="col-md-5">
                            <div class="header_login_content panel_content">                    
                            </div>                
                        </div>
                    </div>`}}return doc}render(){this.container=this.renderLoginHeader();let dst=this.container.getElementsByClassName("panel_content")[0];let field=this.renderField();for(let i2=0;i2<this.children.length;i2++){field.appendChild(this.children[i2].render())}dst.appendChild(field);return this.container}attached(){for(let i2=0;i2<this.children.length;i2++){this.children[i2].attached()}}};inz.forms.panel.fields.FieldOnlineService=class extends inz.forms.panel.fields.Field{constructor(form,$ctx,panelContext,config){super(form,$ctx,panelContext,config)}reset(){}setup(initial){this.defaultDisplay()}hasValue(){return false}render(){this.container=document.createElement("div");let content=this.config.content;switch(this.panelContext){case inz.forms.panel.contexts.LOGIN_LIGHTBOX:case inz.forms.panel.contexts.PAGE_DETAILS:{this.container.innerHTML=`
                <h1>${content.title}</h1>
                ${inz.forms.panel.htmlDecode(content.text)}
                <div>
                    <a class="btn btn__login${content.type==="Online"?" online_services_login":""}${content.type==="RealMe"?" realme_2023_login":""}" target="_blank" href="${content.login_url}">${content.type==="RealMe"?"Log in":content.login_cta}</a>
                </div>
                ${content.type==="RealMe"?`<a href="https://realme.govt.nz" class="realme_glossary_tip" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="${inz.lhf_realme_original_title}"><span class="tooltip-sronly">Glossary for </span>What is RealMe?</a>`:""}
                ${content.link1_text?`<a class="field_forgotten_password" href="${content.link1_url}">${content.link1_text}</a>`:""}
                ${content.link2_text?`<a class="field_forgotten_password" href="${content.link2_url}">${content.link2_text}</a>`:""}
               `;break}case inz.forms.panel.contexts.PAGE_CTA:{let text="";if(content.text){text=`${inz.forms.panel.htmlDecode(content.text)}`}let loginContent="";if(content.type==="RealMe"){loginContent+='<div class="btn btn__realme">RealMe</div>';const realme=window.inz.glossary.realme;if(realme!==void 0)loginContent+=`<p><a href="${realme.url}" data-toggle="tooltip" data-original-title="${realme.definition}" data-toggle-switch="toggle" class="tooltip_content header__realme_info tooltip_lightbg">${realme.label}</a></p>`}else{if(content.link1_text&&content.link1_url)loginContent+=`<a class="login_panel_link field_forgotten_password" href="${content.link1_url}">${content.link1_text}</a>`;if(content.link2_text&&content.link2_url)loginContent+=`<a class="login_panel_link field_forgotten_password" href="${content.link2_url}">${content.link2_text}</a>`}this.container.innerHTML=`
                <div class="obj_form_container" id="c_${this.form.elPrefix}_${this.id}">
                    <div class="row">
                        <div class="col-pgmd-6">
                            <h4 class="popout_title">${content.title}</h4>
                        </div>
                        <div class="col-pgmd-13 popout__login_content">
                            ${text}
                            <div class="panel_content">
                                <a target="_blank" class="btn btn__login${content.type==="Online"?" btn_primary sitelogin":""}" href="${content.login_url}">${content.login_cta}</a>
                                ${loginContent}
                            </div>
                        </div>
                    </div>
                </div>`;break}default:{let text="";if(content.text){text=`<div class="header_login_text">${inz.forms.panel.htmlDecode(content.text)}</div>`}let loginContent="";if(content.type==="RealMe"){loginContent+='<div class="btn btn__realme">RealMe</div>';const realme=window.inz.glossary.realme;if(realme!==void 0)loginContent+=`<a href="${realme.url}" data-toggle="tooltip" data-original-title="${realme.definition}" data-toggle-switch="toggle" class="tooltip_content header__realme_info tooltip_lightbg">${realme.label}</a>`}else{if(content.link1_text&&content.link1_url)loginContent+=`<a class="login_panel_link field_forgotten_password" href="${content.link1_url}">${content.link1_text}</a>`;if(content.link2_text&&content.link2_url)loginContent+=`<a class="login_panel_link field_forgotten_password" href="${content.link2_url}">${content.link2_text}</a>`}this.container.innerHTML=`
                <div class="obj_form_container${content.type==="Online"?" header_login__site":""}" id="c_${this.form.elPrefix}_${this.id}">
                    <div class="row">
                        <div class="col-md-2">
                            <h4 class="header_login_title">${content.title}</h4>
                        </div>
                        <div class="col-md-5">
                            ${text}
                        </div>
                        <div class="col-md-5">
                            <div class="header_login_content">
                                <a target="_blank" class="btn btn__login${content.type==="Online"?" btn_primary sitelogin":""}" href="${content.login_url}">${content.login_cta}</a>
                                ${loginContent}                                
                            </div>
                        </div>
                    </div>
                </div>`}}return this.container}attached(){inz.forms.panel.tooltips.setup($(this.container))}};inz.forms.panel.fields.RadioButtonsField=class extends inz.forms.panel.fields.Field{constructor(form,$ctx,panelContext,config){super(form,$ctx,panelContext,config);this.name=`${this.form.elPrefix}_${this.name}`}getValue(){return this.container.querySelector("input:checked").value}setValue(value){}reset(){let radios=this.container.getElementsByTagName("input");for(let e of Array.from(radios)){e.checked=false}}setup(initial){}setName(name){this.name=name;this.$el.find("input").each(function(idx){$(this).attr("name",name)})}setId(id){inz.forms.panel.fields.Field.prototype.setId.call(this,id);var rb=this;this.$el.find("input").each(function(idx){var $e=$(this);var oldId=$e.attr("id");var newId="opt_"+id+String(idx);$e.attr("id","opt_"+id+String(idx));$e.attr("data-parsley-multiple",id);rb.$el.find("label[for='"+oldId+"']").attr("for",newId)})}addOption(dst,optId,name,label,value){const props={id:optId,className:"input",name,type:"radio",value};const input=inz.forms.panel.createElement("input",props,{"data-fid":this.id});dst.appendChild(input);let labelEl=inz.forms.panel.createElement("label",{htmlFor:optId,textContent:label});dst.appendChild(labelEl);return input}render(){let container=this.renderContainer();let field=this.renderField();field.classList.add("input__radio");let radios=document.createElement("div");switch(this.panelContext){case inz.forms.panel.contexts.LOGIN_LIGHTBOX:case inz.forms.panel.contexts.PAGE_DETAILS:{radios.className=`login_lightbox_radio_buttons${this.config.content.options.length>3?" fixed_width":""}`;let f=this;for(const opt of this.config.content.options){let o=document.createElement("div");let input=this.addOption(o,this.form.elPrefix+"_"+opt.i,this.name,opt.n,opt.v);input.addEventListener("change",()=>{setTimeout(function(){f.form.changeEvent({data:f})})},50);radios.appendChild(o)}break}default:{radios.className="radio_field_container";let f=this;for(const opt of this.config.content.options){let o=document.createElement("div");o.className="col-md-6";let input=this.addOption(o,this.form.elPrefix+"_"+opt.i,this.name,opt.n,opt.v);input.addEventListener("change",()=>{setTimeout(function(){f.form.changeEvent({data:f})})},50);radios.appendChild(o)}}}field.appendChild(radios);container.appendChild(field);return this.container}};inz.forms.panel.fields.SelectionField=class extends inz.forms.panel.fields.Field{constructor(form,$ctx,panelContext,config){super(form,$ctx,panelContext,config);this.reId=new RegExp("f_([a-zA-Z0-9]{7,})__(\\d+)")}reset(){let def="";if("default"in this.config)def=this.config["default"];this.el.value=def}setup(initial){}optionRender(optId,name,label,value){return`<option value="${value}">${label}</option>`}addOption(dst,label,value){let opt=document.createElement("option");opt.value=value;opt.text=label;dst.appendChild(opt);return opt}renderField(){const props={id:`f_${this.form.elPrefix}_${this.id}`,className:"Xjs-select2 Xjs-select2-theme_darkgrey Xjs-select2-nosearch Xdropdown_body__login"};const attrs={title:this.config.content.title,autocomplete:"off","data-maxSelection":"1"};this.el=inz.forms.panel.createElement("select",props,attrs);let def=document.createElement("option");def.value="";def.text="";this.el.appendChild(def);return this.el}render(){let container=this.renderContainer();let c=document.createElement("div");c.className="Xdropdown__login";let field=this.renderField();let f=this;$(this.el).change(this,this.form.changeEvent);for(const opt of this.config.content.options){this.addOption(field,opt.n,opt.v[0])}c.appendChild(field);container.appendChild(c);$(this.el).select2({dropdownParent:c,minimumResultsForSearch:10,placeholder:this.config.content.title,theme:"darkgrey"});return this.container}attached(){}};inz.forms.panel.tooltips=inz.forms.panel.tooltips||{};inz.forms.panel.tooltips.setup=function(scope){inz.forms.panel.tooltips.setupTooltips(scope.find('[data-toggle="tooltip"]'),scope);inz.forms.panel.tooltips.attachEvents(scope)};inz.forms.panel.tooltips.setupTooltips=function(selector,scope){var isMobile=$("html.touch").length>0&&(DO.CurrentBreakpoint()==="base"||DO.CurrentBreakpoint()==="small"||DO.CurrentBreakpoint()==="medium"||DO.CurrentBreakpoint()==="large"),container=scope.closest(".dock").length==0||isMobile?"body":".dock_body";selector.each(function(){var title='<h4 class="tooltip_title">'+($(this).attr("tooltip_title")?$(this).attr("tooltip_title"):$(this).text())+"</h4>",template='<div class="tooltip tooltip__small" role="tooltip"><div class="tooltip_wrap"><div class="btn btn__tooltip"><span class="sr-only">Close</span></div><div class="tooltip-arrow"></div>'+title+'<div class="tooltip-inner"></div></div></div>';$(this).addClass("tooltip_content").attr("role","button").attr("href","#").removeAttr("target").prepend('<span class="tooltip-sronly">Glossary for </span>');if($(this).closest(".stripe__darkblue").length>0){template='<div class="tooltip tooltip__small tooltip__dark" role="tooltip"><div class="tooltip_wrap"><div class="btn btn__tooltip"><span class="sr-only">Close</span></div><div class="tooltip-arrow"></div>'+title+'<div class="tooltip-inner"></div></div></div>'}$(this).tooltip({container,animation:true,html:true,trigger:"click manual",template,viewport:"body"})})};inz.forms.panel.tooltips.attachEvents=function(scope){scope.find('[data-toggle="tooltip"]').on("click",function(e){e.preventDefault()});scope.find('[data-toggle="tooltip"]').on("inserted.bs.tooltip",function(a,b,c){$("html").addClass("tooltip_isopen");if(scope.closest(".data-tool").length>0)return;var top=$(document).scrollTop();$("body").css("top",-top+"px")});scope.find('[data-toggle="tooltip"]').on("hide.bs.tooltip",function(){$("html").removeClass("tooltip_isopen");if(scope.closest(".data-tool").length>0)return;var top=$("body").position().top;$("body").css("top",-top+"px")})};


inz.forms=inz.forms||{};inz.forms.calc=inz.forms.calc||{};inz.forms.calc.MedianWage=class extends inz.forms.Form{init($ctx,id,type,pid){super.init($ctx,id,type,pid,"","False");this.rVar=/\{(.*?)\}/g;this.enableLeaveWarning=false;this.enableLogging=false;this.calc_fields={"QRemType":null,"Hourly":{},"Salary":{}};this.MedianWage=0;this.MinWage=0;this.haveCalculated=false}load(field_config,calc_config){super.load(field_config);this.MedianWage=calc_config.MeW;this.MinWage=calc_config.MnW;this.outputHeading=calc_config.OutH;this.outputBody=inz.forms.unescapeHTML(calc_config.OutB);this.errorHeading=calc_config.EH;this.errorBody=inz.forms.unescapeHTML(calc_config.EB);this.calc_fields.QRemType=this.getField(calc_config.QRT);for(const k in calc_config.H){this.calc_fields.Hourly[k]=this.getField(calc_config.H[k])}for(const k in calc_config.S){this.calc_fields.Salary[k]=this.getField(calc_config.S[k])}this.$form.find("input[type=submit]").click(this,function(event){event.preventDefault();event.stopPropagation();event.data.calculate(true)});let _calc=this;this.calc_fields.QRemType.$el.on("change",function(event){_calc.display_reset();_calc.haveCalculated=false})}get_value_lower(field){let v=field.getValue(true);return!v?void 0:v.toLowerCase()}get_value_number(field){let v;if(field instanceof inz.forms.fields.Number)v=field.getNumberValue();else v=field.getValue(true);return!v?void 0:Number(v)}focusOut(event){let form=$(this).parents("form").data("form");if(form.haveCalculated){form.calculate(false)}}calculate(calc_from_submit){if(!this.$form.parsley().validate()){console.log("Not valid");return}this.haveCalculated=true;let log=[];let reg={};reg.MedianWage=this.MedianWage;let calc_type=this.get_value_lower(this.calc_fields.QRemType);if(!calc_type){console.log("Not Type!");return}let calc_result;if(calc_type.startsWith("s")){calc_result=this.calc_salary(log,reg)}else{calc_result=this.calc_hourly(log,reg)}if(calc_result){log.push("MWC-BR-10");log.push("MWC-BR-11");let MedComp1,MedComp2;if(reg.VRemRate<reg.MedianWage){reg.MedComp1="BELOW";reg.MedComp2="below"}else if(reg.VRemRate>reg.MedianWage){reg.MedComp1="ABOVE";reg.MedComp2="above"}else{reg.MedComp1="EQUAL";reg.MedComp2="equal to"}this.display_output(log,reg)}else{this.display_error(log,reg)}if(this.$form.find(".calc_debug").length!==0){let debug_output="<label>Values:</label>\n<ul>";for(const v in reg){if(v.startsWith("Q")&&(reg[v]===void 0||typeof reg[v]=="string"&&reg[v]==="NaN"||typeof reg[v]=="number"&&isNaN(reg[v]))){debug_output+=`	<li>${v} = ${reg[v]} <span style="color: red;"><b>(Missing Field Value?)</b></span></li>
`}else{debug_output+=`	<li>${v} = ${reg[v]}</li>
`}}debug_output+="</ul><label>Applied Rules:</label>\n<ul>";for(const rule in log){debug_output+=`	<li>${log[rule]}</li>
`}debug_output+="</ul>";this.$form.find("#calc_debug_log").html(debug_output);this.$form.find(".calc_debug").show()}}calc_salary(log,reg){let f=this.calc_fields.Salary;reg.QEmpAgreHours=this.get_value_lower(f.QEmpAgreHours);reg.QPayPeriod=this.get_value_lower(f.QPayPeriod);reg.QEmpAgreBen=this.get_value_lower(f.QEmpAgreBen);reg.QSalMin=this.get_value_number(f.QSalMin);if(reg.QEmpAgreHours===void 0||reg.QPayPeriod===void 0||reg.QEmpAgreBen===void 0||reg.QSalMin===void 0){return false}switch(reg.QPayPeriod){case"weekly":reg.VPayPeriodsPerYear=52;reg.VPayPeriodsDays=7;break;case"fortnightly":reg.VPayPeriodsPerYear=26;reg.VPayPeriodsDays=14;break;case"monthly":reg.VPayPeriodsPerYear=12;reg.VPayPeriodsDays=31;break}reg.VBenRate=0;if(reg.QEmpAgreHours.startsWith("hours s")){log.push("MWC-BR-03");reg.QHoursMax=this.get_value_number(f.QHoursMax);if(reg.QHoursMax===void 0)return false;reg.VBaseRate=reg.QSalMin/reg.VPayPeriodsPerYear/reg.QHoursMax;if(reg.QEmpAgreBen.startsWith("y")){log.push("MWC-BR-07");reg.QBenPayPeriodValue=this.get_value_number(f.QBenPayPeriodValue);if(reg.QBenPayPeriodValue===void 0)return false;reg.VBenRate=reg.QBenPayPeriodValue/reg.QHoursMax}}else if(reg.QEmpAgreHours.startsWith("rev")){log.push("MWC-BR-04");reg.QDaysOn=this.get_value_number(f.QDaysOn);reg.QDaysOff=this.get_value_number(f.QDaysOff);reg.QHoursPShift=this.get_value_number(f.QHoursPShift);if(reg.QDaysOn===void 0||reg.QDaysOff===void 0||reg.QHoursPShift===void 0)return false;reg.VShiftPattern=reg.QDaysOn+reg.QDaysOff;reg.VRotations=Math.floor(reg.VPayPeriodsDays/reg.VShiftPattern);reg.VRemainder=reg.VPayPeriodsDays-reg.VRotations*reg.VShiftPattern;reg.VAddOn=reg.VRemainder>=reg.QDaysOn?reg.QDaysOn:reg.VRemainder;reg.VHoursPerDay=reg.QHoursPShift/reg.QDaysOn;if(reg.QDaysOn>=reg.VPayPeriodsDays){reg.VMaxPayPeriodDays=reg.VPayPeriodsDays}else{reg.VMaxPayPeriodDays=reg.VShiftPattern>=reg.VPayPeriodsDays?reg.QDaysOn:reg.VRotations*reg.QDaysOn+reg.VAddOn}reg.VBaseRate=reg.QSalMin/reg.VPayPeriodsPerYear/reg.VHoursPerDay/reg.VMaxPayPeriodDays;if(reg.QEmpAgreBen.startsWith("y")){log.push("MWC-BR-08");reg.QBenPayPeriodValue=this.get_value_number(f.QBenPayPeriodValue);if(reg.QBenPayPeriodValue===void 0)return false;reg.VBenRate=reg.QBenPayPeriodValue/(reg.VHoursPerDay*reg.VMaxPayPeriodDays)}}else{return false}reg.VRemRate=(reg.VBaseRate+reg.VBenRate).toFixed(2);return true}calc_hourly(log,reg){let f=this.calc_fields.Hourly;reg.QVariableRate=this.get_value_lower(f.QVariableRate);reg.QEmpAgreBen=this.get_value_lower(f.QEmpAgreBen);reg.QHourlyWage=this.get_value_number(f.QHourlyWage);if(reg.QVariableRate===void 0||reg.QEmpAgreBen===void 0||reg.QHourlyWage===void 0)return false;if(reg.QVariableRate.startsWith("n")){log.push("MWC-BR-01");reg.VBaseRate=reg.QHourlyWage}else{log.push("MWC-BR-02");reg.QHourMinWage=this.get_value_number(f.QHourMinWage);reg.QMaxWage=this.get_value_number(f.QMaxWage);reg.QHourMaxWage=this.get_value_number(f.QHourMaxWage);if(reg.QHourMinWage===void 0||reg.QMaxWage===void 0||reg.QHourMaxWage===void 0)return false;reg.VBaseRate=(reg.QHourlyWage*reg.QHourMinWage+reg.QMaxWage*reg.QHourMaxWage)/(reg.QHourMinWage+reg.QHourMaxWage)}reg.VBenRate=0;if(reg.QEmpAgreBen.startsWith("y")){reg.QBenHourly=this.get_value_lower(f.QWageBenHourly);if(reg.QBenHourly===void 0)return false;if(reg.QBenHourly.startsWith("y")){log.push("MWC-BR-05");reg.VBenRate=this.get_value_number(f.QWageBenHourlyRate);if(reg.VBenRate===void 0)return false}else{log.push("MWC-BR-06");reg.QBenPayPeriodValue=this.get_value_number(f.QBenPayPeriodValue);reg.QBenPayPeriodHours=this.get_value_number(f.QBenPayPeriodHours);if(reg.QBenPayPeriodValue===void 0||reg.QBenPayPeriodHours===void 0)return false;reg.VBenRate=reg.QBenPayPeriodValue/reg.QBenPayPeriodHours}}reg.VRemRate=(reg.VBaseRate+reg.VBenRate).toFixed(2);return true}replace_vars(src,reg){let dst=src.replace(this.rVar,(match,$1)=>{let v=reg[$1];return v!==void 0?v:""});return dst}display_output(log,reg){let $output=this.$form.find("#output-banner");$output.toggleClass("form_banner_success",true);$output.toggleClass("banner__alert ",false);$output.find(".banner_icon").toggleClass("banner_icon__comms",true);$output.find(".banner_icon").toggleClass("banner_icon__alert",false);let heading=this.replace_vars(this.outputHeading,reg);$output.find(".banner_title").text(heading);let body=this.replace_vars(this.outputBody,reg);$output.find(".banner_text").html(body);$output.show()}display_error(log,reg){let $output=this.$form.find("#output-banner");$output.toggleClass("form_banner_success",false);$output.toggleClass("banner__alert ",true);$output.find(".banner_icon").toggleClass("banner_icon__comms",false);$output.find(".banner_icon").toggleClass("banner_icon__alert",true);let heading=this.replace_vars(this.errorHeading,reg);$output.find(".banner_title").text(heading);let body=this.replace_vars(this.errorBody,reg);$output.find(".banner_text").html(body);$output.show()}display_reset(){let $output=this.$form.find("#output-banner");$output.hide();this.$form.find(".calc_debug").hide()}round(num,decimalPlaces=0){var p=Math.pow(10,decimalPlaces);var n=num*p*(1+Number.EPSILON);return Math.round(n)/p}};


inz.forms=inz.forms||{};inz.forms.SMCAppForm=class extends inz.forms.Form{restoreState(values){if(values!==void 0&&values!==null){values=JSON.parse(values);this.setValues(values,false);if(values["__initial"]!==void 0&&values["__initial"]===true){this.restoringState=true;for(let id in this.fields){if(this.fields[id]instanceof inz.forms.fields.FieldGroup)continue;let value=values[id];if(value!==void 0){this.processDependants(this.fields[id],true,true)}}for(let id in this.fields){if(this.fields[id]instanceof inz.forms.fields.Fieldset){if(this.fields[id].display===inz.forms.fields.Field.STATE_READ_ONLY){this.fields[id].defaultDisplay()}}}this.restoringState=false}if(this.cfg.r!==void 0){this.eoiGroup=this.fields[this.cfg.r["K0"]];this.appGroup=this.fields[this.cfg.r["KD0"]];this.appGroup.hideActions();this.appGroup.disableActions();this.eoiTypeName=this.fields[this.cfg.r["K2"]].getName();this.syncDependants();let curCount=this.appGroup.getCount();let depCount=0;for(let i=0;i<this.eoiGroup.getCount();i++){this.fields[this.eoiTypeName+"__"+i].$el.on("change",function(){_this.syncDependants()})}let _this=this;this.eoiGroup.$container.find(".form_add_item").on("click",function(){let lastIdx=_this.eoiGroup.getCount()-1;_this.eoiGroup.form.fields[_this.eoiTypeName+"__"+lastIdx].$el.on("change",function(){_this.syncDependants()})});this.eoiGroup.$container.find(".form_remove_item").on("click",function(){_this.syncDependants()})}if(inz.login.session!==void 0)inz.login.session.processEvent(inz.login.Session.Events.Active)}for(let id in this.fields){this.fields[id].initialError()}}syncDependants(){let curCount=this.appGroup.getCount();let depCount=this.eoiGroup.getCount();if(curCount<depCount){for(let i=curCount;i!==depCount;i++){this.appGroup.addGroup();console.debug("Added group")}}else if(curCount>depCount){for(let i=curCount;i!==depCount;i--){this.appGroup.removeGroup(true);console.debug("Removed group")}}}loggedInEvent(event){let form=event.data;event.preventDefault();event.stopPropagation();let dfd=$.Deferred();form.loadDraftSubmissions().done(function(data){if("sess"in data){inz.login.session.sessionDataUpdate(data.sess)}form.$form.append('<a style="display:none;" href="#" id="save_and_exit" class="btn btn__primary">Save and Exit</a>');let has_subs=data.submissions;if(typeof has_subs!=="undefined"){has_subs=has_subs.length}if(has_subs){let onEditDraft2=function(event2){event2.preventDefault();event2.stopPropagation();let draft_id=$(this).closest("tr").data("draftId");if($("#__si").length){$("#__si").val(draft_id)}else{form.$form.append($("<input>",{type:"hidden",id:"__si",name:"__si",value:draft_id}))}form.loadState().done(function(success){inz.forms.message.hideMessage();form.adjustHeight();inz.login.session.active(false);$(".login_confirmation").show();$("#save_and_exit_initial").click(function(event3){event3.preventDefault();event3.stopPropagation();$("#save_and_exit").click()});$(".pre_form_actions .btn__primary").click();form.leaveWarning=false;inz.login.session.processEvent(inz.login.Session.Events.Loaded,draft_id)})},applyOverlayToRow2=function(tableRow,content,colspan){let tr=$(tableRow);tr.closest("table").find("tr.overlaid").each(function(){removeOverlayFromRow2(this)});const minHeight=tr.innerHeight();const headerCells=tr.closest("table").find("tr:first-of-type th").get();const columnWidths=headerCells.map(e=>e.getBoundingClientRect().width);for(let n=0;n<columnWidths.length;n++){headerCells[n].style.width=columnWidths[n]+"px"}tr.data("originalContent",tr.children().detach());tr.append($("<td>",{colspan}).append($("<div>",{style:`min-height: ${minHeight}px`,"class":"form_modal_overlay",html:content})));tr.addClass("overlaid")},applyPromptActionsOverlayToRow2=function(tableRow,promptContent,actionButtons,colspan){let content=$("<div>");content.append($("<div>",{"class":"form_modal_prompt",html:$(promptContent)}));content.append($("<div>",{"class":"form_modal_actions",html:$(actionButtons)}));applyOverlayToRow2(tableRow,content.children(),colspan)},applyExistingDraftFormOverlay2=function(tableRow,promptContent,actionButtons){applyPromptActionsOverlayToRow2(tableRow,promptContent,actionButtons,3)},removeOverlayFromRow2=function(tableRow){let tr=$(tableRow);tr.closest("table").find("tr:first-of-type th").css("width","");tr.empty();tr.append(tr.data("originalContent"));tr.removeClass("overlaid")};var onEditDraft=onEditDraft2,applyOverlayToRow=applyOverlayToRow2,applyPromptActionsOverlayToRow=applyPromptActionsOverlayToRow2,applyExistingDraftFormOverlay=applyExistingDraftFormOverlay2,removeOverlayFromRow=removeOverlayFromRow2;const UNNAMED_DRAFT_LABEL="Unnamed Draft";let message=$("<div></div>");message.append("<p>Select 'Open' to view or edit an application.</p>");let submissionTable=$('<table class="savedDrafts"><thead><tr><th>Name</th><th class="created">Created</th><th>Options</th></tr></thead><tbody></tbody></table>');let tbody=submissionTable.find("tbody");for(const draft of data.submissions){const createdDate=new Date(draft.created*1e3);const createdDateHtml=`${createdDate.getDate()} ${inz.forms.months[createdDate.getMonth()]} ${createdDate.getFullYear()} <span>${createdDate.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:true})}</span>`;let tr=$("<tr>",{"data-draft-id":draft.submission_id});tr.data("draft",draft);tr.append($("<td>",{"class":"label"}).append($("<button>",{type:"button","class":"btn btn__tertiary edit_draft",text:draft.label?draft.label:UNNAMED_DRAFT_LABEL,click:onEditDraft2}).append($("<p>",{"class":"inline_created",html:createdDateHtml}))));tr.append($("<td>",{"class":"created",html:createdDateHtml}));tr.append($("<td>",{"class":"actions"}).append($("<div>").append($("<button>",{type:"button","class":"btn btn__primary edit_draft",text:"Open",click:onEditDraft2}))));tbody.append(tr)}submissionTable.append(tbody);message.append(submissionTable);message.append('<input name="submission_log_out" class="btn btn__blockxs btn__secondary center-block" type="submit" value="Log Out" />');inz.forms.message.showMessage(message,"Existing applications",null,false);$('.modal_forms_message input[name="submission_log_out"]').on("click",function(event2){event2.preventDefault();event2.stopPropagation();$(this).attr("disabled","disabled");$('.modal_forms_message input[name="create_new_submission"]').attr("disabled","disabled");inz.forms.message.hideMessage();inz.forms.message.showMessage("","Logging out","",true);inz.login.session.processEvent(inz.login.Session.Events.LogOut)});inz.login.session.processEvent(inz.login.Session.Events.Drafts)}else{$(".modal_forms_message").hide();$("#noapps").show();inz.login.session.processEvent(inz.login.Session.Events.Drafts)}})}};


inz.forms.Condition=class{init(form,field,config,registerDepend){this.form=form;this.field=field;this.testType=config.test;this.testValue=config.tvalue;this.op=config.op;this.stopProcessing=config.st;this.dependField=form.getField(config.depends);if(this.dependField===null)return false;if(registerDepend===void 0||registerDepend===true){this.dependField.addDependant(this.field)}return true}remove(){this.dependField.removeDependant(this.field)}update(field,dependant){this.field=field;this.dependField=dependant;this.dependField.addDependant(this.field)}shouldStopProcessing(){return this.stopProcessing}shouldTest(src){if(src===void 0)return true;else return this.dependField===src}getValuesFromGroup(src){if(src.group===null){return null}let ret=[];for(let i=0;i<src.group.getCount();i++){let id=src.group.createGroupId(src.config.id,i);let field=this.form.fields[id];if(field!==void 0)ret.push(field.getValue(true))}return ret}test(value){if(value===void 0)value=this.dependField.getValue(true);let isArray=$.isArray(value);switch(this.testType){case"VALUE":if(isArray&&value.length!==0||!isArray&&value)return true;break;case"NO_VALUE":if(isArray&&value.length===0||!isArray&&!value)return true;break;case"MATCHES_VALUE":if(isArray&&$.inArray(this.testValue,value)!==-1||!isArray&&value===this.testValue)return true;break;case"NOT_MATCHES_VALUE":if(isArray&&$.inArray(this.testValue,value)===-1||!isArray&&value!==this.testValue)return true;break;case"HAS_VALUE_AND_NOT_MATCHES_VALUE":if(isArray&&value.length===0||!isArray&&!value)return false;if(isArray&&$.inArray(this.testValue,value)===-1||!isArray&&value!==this.testValue)return true;break;case"GROUP_MATCHES_VALUE":{let values=this.getValuesFromGroup(this.dependField);return $.inArray(this.testValue,values)!==-1}case"OLDER_THAN":case"YOUNGER_THAN":case"LESS_THAN":case"GREATER_THAN":let date=Date.parse(value);if(isNaN(date)){break}date=new Date(date);let testAge=Number(this.testValue);if(this.testType==="LESS_THAN"){return this.lessThan(new Date,date,testAge)}else if(this.testType==="GREATER_THAN"){return!this.lessThan(new Date,date,testAge)}else{let age=this.calcAge(new Date,date);if(this.testType==="OLDER_THAN"&&testAge<age||this.testType==="YOUNGER_THAN"&&testAge>age){return true}}break}return false}calcAge(today,date){let age=today.getFullYear()-date.getFullYear();let months=today.getMonth()-date.getMonth();if(months<0||months===0&&today.getDate()<date.getDate()){age--}return age}lessThan(today,date,test){let age=today.getFullYear()-date.getFullYear();let months=today.getMonth()-date.getMonth();if(months<0||months===0&&today.getDate()<date.getDate()){age--}if(age<test){return true}if(months===0&&today.getDate()===date.getDate()){if(test===age){return true}else{return false}}return false}};


var __defProp=Object.defineProperty;var __getOwnPropSymbols=Object.getOwnPropertySymbols;var __hasOwnProp=Object.prototype.hasOwnProperty;var __propIsEnum=Object.prototype.propertyIsEnumerable;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __spreadValues=(a,b)=>{for(var prop in b||(b={}))if(__hasOwnProp.call(b,prop))__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b)){if(__propIsEnum.call(b,prop))__defNormalProp(a,prop,b[prop])}return a};var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a;inz.forms.fields=inz.forms.fields||{};inz.forms.fields.Field=(_a=class{init(form,$ctx,config){this.form=form;this.config=config;this.name=config.name;this.id=config.id;this.display=config.display;this.state=null;this.validation=true;this.isHidden=this.display!==inz.forms.fields.Field.STATE_HIDDEN;this.$el=$ctx.find("#f_"+this.id).first();this.$container=$ctx.find("#c_"+this.id).first();this.$el.data("field",this);this.$el.addClass("obj_form_field");this.$container.data("field",this);this.$container.addClass("obj_form_container");if(this.$container.parents(".form_group_tmpl").length!==0)this.inGroupTmpl=true;else this.inGroupTmpl=false;this.children=[];this.parent=null;this.group=null;this.conditions=[];this.processAll=config.processAll!==void 0?config.processAll:false;this.dependants=[];if("group"in config)this.group=this.form.getField(config["group"]);if("parent"in config&&this.group===null){let parent=this.form.getField(config.parent);if(parent===null)console.log("Form Error: Parent: "+config.parent+" not in fields registry");else{this.parent=parent;this.parent.addChild(this)}}if("edit_link"in config){let edit_label;switch(config.type){case"FieldGroup":edit_label="Edit Field Group";break;case"Fieldset":edit_label="Edit Field Set";break;default:edit_label="Edit"}let edit_btn=`<a class="form-edit-link inz_edit_button inz_edit_button_dark icon-edit" target="_blank" href="${config.edit_link}">${edit_label}</a>`;if(config.type==="FieldGroup"){this.$container.find(".form_actions").prepend($(edit_btn))}else{this.$container.prepend($(edit_btn))}}}addConditions(conditions){for(let i=0;i<conditions.length;i++){let cond;if(inz.forms.resv.isResCondition(conditions[i])){cond=Object.create(inz.forms.resv.Condition.prototype);this.form.resvConditionFields.push(this)}else{cond=Object.create(inz.forms.Condition.prototype)}if(cond.init(this.form,this,conditions[i]))this.conditions.push(cond)}}addCondition(condition){let cond;if(inz.forms.resv.isResCondition(condition)){cond=Object.create(inz.forms.resv.Condition.prototype);this.form.resvConditionFields.push(this)}else{cond=Object.create(inz.forms.Condition.prototype)}if(cond.init(this.form,this,condition))this.conditions.push(cond)}addChild(child){this.children.push(child)}addDependant(dependant){if(this.dependants!==void 0&&this.dependants.indexOf(dependant)!==-1)return;this.dependants.push(dependant)}removeDependant(dependant){let i=this.dependants.indexOf(dependant);if(i>-1)this.dependants.splice(i,1)}depChanged(field,value){}addChildren(children){$.merge(this.children,children)}setup(initial){this.$el.change(this,this.form.changeEvent);this.$el.on("focusout",this.form.focusOut);this.defaultDisplay()}initialError(){if("error"in this.config){let msg=this.config["error"];if(msg===null)msg="There is an error with this field";let field=this.$el.parsley();window.ParsleyUI.addError(field,"custom-error-message",msg)}}defaultDisplay(no_reset){if(this.display===inz.forms.fields.Field.STATE_NORMAL||this.display===inz.forms.fields.Field.STATE_READ_ONLY){if(this.isHidden){this.show(void 0,no_reset);return true}this.setState(this.display,false)}else if(this.display===inz.forms.fields.Field.STATE_HIDDEN){if(!this.isHidden){this.hide(void 0,no_reset);return false}this.setState(this.display,false)}}createCopy($ctx,id,name2){let copy=Object.create(this);copy.init(this.form,$ctx,this.config);copy.setId(id);copy.setName(name2);if(this.form instanceof inz.forms.SMCAppForm&&this.dependants!==null&&this.dependants.length!==0){copy.dependants=this.dependants.slice()}else{copy.dependants=[]}copy.isHidden=this.isHidden;return copy}inGroup(){return this.group!==null}getName(){return this.$el.attr("name")}setName(name2){this.name=name2;this.$el.attr("name",name2)}getId(){return this.$el.attr("id")}setId(id){this.id=id;this.$el.attr("id","f_"+id);this.$container.attr("id","c_"+id)}hasValue(){return true}useGetOnSubmit(){return false}getElement(){return this.$el}getName(){return this.name}getValue(){return this.$el.val()}setValue(value){this.$el.val(value).change()}reset(){this.$el.val("").change()}setRequired(req){if(req){let $label=this.$container.find("label").first();if($label.find("span.req").length===0){$label.append('<span class="req">*</span>')}this.$el.attr("required","required")}else{this.$container.find("label span.req").remove();this.$el.removeAttr("required")}}stateChange(state){if(state===inz.forms.fields.Field.STATE_READ_ONLY){this.$el.attr("readonly","readonly");this.$container.attr("data-st","ro");this.disableValidation();this.clearValidation()}else if(state===inz.forms.fields.Field.STATE_NORMAL){this.$el.removeAttr("readonly");this.$container.attr("data-st","rw");this.enableValidation()}}enableValidation(){this.$el.removeClass("disable_val");this.$el.removeAttr("disabled","disabled");this.validation=true}disableValidation(){this.$el.addClass("disable_val");this.$el.attr("disabled","disabled");this.validation=false}isDisabled(){let hidden=this.$el.is(":hidden");if(this.state===inz.forms.fields.Field.STATE_READ_ONLY&&hidden===false){return false}return this.$el.hasClass("disable_val")||hidden}clearValidation(){this.$container.find(".err-msg").remove();this.$container.find(".field__error").remove();this.$container.removeClass("parsley-error");this.$container.find(".has-error").removeClass("has-error")}getErrorContainer(el){let e=this.$container.find(".error-container");if(e.length===0)return this.$container.find(".field-col");else return e}show(initial,no_reset){this.isHidden=false;if(no_reset===void 0||no_reset===false)this.reset();this.enableValidation();if(initial!==true){for(let i=0;i<this.children.length;i++){if(!this.form.settingValues)this.children[i].processConditions()}}this.$container.show(initial);if(this.form.isInAccordian)this.form.adjustHeight()}hide(initial,no_reset){this.isHidden=true;this.$container.hide();if(no_reset===void 0||no_reset===false)this.reset();if(initial!==true){for(let i=0;i<this.children.length;i++){this.children[i].hide()}}this.disableValidation();if(this.form.isInAccordian)this.form.adjustHeight()}setState(state,initial){if(state!==null){this.state=state;this.stateChange(state)}if(initial!==true){for(let i=0;i<this.children.length;i++){this.children[i].setState(state,initial)}}if(this.form.isInAccordian)this.form.adjustHeight()}processConditions(src,value,no_default,no_reset){let resultShow=null;let resultState=null;if(this.processAll)value=void 0;for(let i=0;i<this.conditions.length;i++){let cond=this.conditions[i];if(this.processAll||cond.shouldTest(src)){if(cond.test(value)){if(cond.op==="SHOW"){resultShow=true;resultState=inz.forms.fields.Field.STATE_NORMAL}else if(cond.op==="SHOW_RO"){resultShow=true;resultState=inz.forms.fields.Field.STATE_READ_ONLY}else if(cond.op==="HIDE"){resultShow=false;resultState=null}if(!this.processAll||cond.shouldStopProcessing())return this.actionConditions(resultShow,resultState)}}}return this.actionConditions(resultShow,resultState,no_default,no_reset)}actionConditions(resultShow,resultState,no_default,no_reset){let didShow=false;if(resultShow!==null){if(this.isHidden&&resultShow===true){this.show(false,no_reset);didShow=true}else if(!this.isHidden&&resultShow===false){this.hide(false,no_reset);didShow=false}}if(resultState!==null&&resultState!==this.state){this.setState(resultState,false)}if(didShow===false){for(let i=0;i<this.children.length;i++){if(!this.form.settingValues)this.children[i].processConditions(void 0,void 0,false,true)}}if(resultShow!==null||resultState!==null){return didShow}if(no_default===void 0||no_default===false)return this.defaultDisplay(no_reset)}},__publicField(_a,"STATE_HIDDEN",0),__publicField(_a,"STATE_NORMAL",1),__publicField(_a,"STATE_READ_ONLY",2),__publicField(_a,"STATE_MAP",{"HIDE":0,"SHOW":1,"SHOW_RO":2}),_a);inz.forms.fields.CheckBoxField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.CheckBoxField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.CheckBoxField.prototype.constructor=inz.forms.fields.CheckBoxField;inz.forms.fields.CheckBoxField.prototype.getValue=function(){return this.$el.is(":checked")?this.$el.val():null};inz.forms.fields.CheckBoxField.prototype.setValue=function(value){if(value===null||value===void 0)this.$el.removeAttr("checked");else this.$el.find('input[type=checkbox][value="'+inz.forms.escapeHTML(value)+'"]').prop("checked",true);this.$el.find("input[type='checkbox']").first().change()};inz.forms.fields.CheckBoxField.prototype.reset=function(){$('input[name="'+this.name+'"]:checked').removeAttr("checked");this.$el.find("input[type='checkbox']").first().change()};inz.forms.fields.CheckBoxField.prototype.setup=function(initial){this.$el.find("input[type='checkbox']").change(this,this.form.changeEvent);this.defaultDisplay()};inz.forms.fields.CheckBoxesField=function(){inz.forms.fields.Field.prototype.call(this)};inz.forms.fields.CheckBoxesField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.CheckBoxesField.prototype.constructor=inz.forms.fields.CheckBoxesField;inz.forms.fields.CheckBoxesField.prototype.useGetOnSubmit=function(){return true};inz.forms.fields.CheckBoxesField.prototype.getValue=function(real){if(real===void 0)real=false;let vals=[];let s=this.$container.find("input:checked");for(let i=0;i<s.length;i++){if(real)vals.push($(s[i]).val());else vals.push(s[i].getAttribute("data-ouid"))}return vals};inz.forms.fields.CheckBoxesField.prototype.setValue=function(values){this.$container.find("input:checked").removeAttr("checked");if(values===null||values===void 0){this.$container.find("input:checked").removeAttr("checked")}else{for(let i=0;i<values.length;i++){if(values[i].startsWith("__oid_")){this.$container.find("input[data-ouid='"+values[i]+"']").prop("checked",true)}else{this.$container.find('input[type=checkbox][value="'+inz.forms.escapeHTML(values[i])+'"]').prop("checked",true)}}}this.$el.find("input[type='checkbox']").first().change()};inz.forms.fields.CheckBoxesField.prototype.reset=function(){this.$container.find("input:checked").removeAttr("checked");this.$el.find("input[type='checkbox']").first().change()};inz.forms.fields.CheckBoxesField.prototype.setup=function(initial){this.$el.find("input[type='checkbox']").change(this,this.form.changeEvent);this.$el.find("input[type='checkbox']").on("focusout",this.form.focusOut);this.defaultDisplay()};inz.forms.fields.CheckBoxesField.prototype.setName=function(name2){this.name=name2;this.$el.find("input").each(function(idx){$(this).attr("name",name2)})};inz.forms.fields.CheckBoxesField.prototype.setId=function(id){inz.forms.fields.Field.prototype.setId.call(this,id);var rb=this;this.$el.find("input").each(function(idx){var $e=$(this);var oldId=$e.attr("id");var newId="opt_"+id+String(idx);$e.attr("id","opt_"+id+String(idx));$e.attr("data-parsley-multiple",id);rb.$el.find("label[for='"+oldId+"']").attr("for",newId)})};inz.forms.fields.CheckBoxesField.prototype.enableValidation=function(){this.$el.removeClass("disable_val");this.$el.find("input").removeClass("disable_val");this.$el.find("input").removeAttr("disabled","disabled")};inz.forms.fields.CheckBoxesField.prototype.disableValidation=function(){this.$el.addClass("disable_val");this.$el.find("input").addClass("disable_val");this.$el.find("input").attr("disabled","disabled")};inz.forms.fields.TextAreaField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.TextAreaField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.TextAreaField.prototype.constructor=inz.forms.fields.TextAreaField;inz.forms.fields.TextAreaField.prototype.setup=function(initial){this.$el.keyup(this,this.form.changeEvent);this.$el.on("focusout",this.form.focusOut);this.defaultDisplay()};inz.forms.fields.DatePickerField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.DatePickerField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.DatePickerField.prototype.constructor=inz.forms.fields.DatePickerField;inz.forms.fields.DatePickerField.prototype.setup=function(initial){this.setupPickers();this.$el.change(this,this.form.changeEvent);this.$el.on("focusout",this.form.focusOut);this.defaultDisplay()};inz.forms.fields.DatePickerField.prototype.setupPickers=function(){this.$container.find(".calendarWrap").each(function(){var cWrap=$(this);var cLink=cWrap.find(".datePicker");var cInput=cWrap.find(".input");var cid=cWrap.attr("id");$A.setCalendar(cWrap.attr("id"),cLink[0],cInput[0],false,function(ev,dc,targ){var dateVal=dc.range.current.mDay+" "+dc.range[dc.range.current.month].name+" "+dc.range.current.year;$(targ).val(dateVal);var field=$(targ).closest(".form_field");field.removeClass("parsley-error").addClass("parsley-success");$(targ).parent().find(".err-msg").remove();$(targ).parsley().validate();dc.close();$(targ).trigger("change")},{ajax:function(dc,save){if(!$(cLink[0]).data("dependant")){dc.open();return}var dependentInput=$("#"+$(cLink[0]).data("dependant"));if(dependentInput.length==0){dc.open();return}var dependantDateString=dependentInput.val();if(dependantDateString==""){dc.open();return}var dependentDate=new Date(Date.parse(dependantDateString));var dependentCurrent={day:dependentDate.getDate(),month:dependentDate.getMonth(),year:dependentDate.getFullYear(),weekDay:dependentDate.getDay()};dc.range[dc.range.current.month].disabled[dc.range.current.year]=[];if(dependentCurrent.year>dc.range.current.year||dependentCurrent.year===dc.range.current.year&&dependentCurrent.month>dc.range.current.month){dc.range[dc.range.current.month].disabled[dc.range.current.year]=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]}if(dependentCurrent.year===dc.range.current.year&&dependentCurrent.month===dc.range.current.month){for(var day=1;day<=dependentCurrent.day;day++){dc.range[dc.range.current.month].disabled[dc.range.current.year].push(day)}}dc.open()},autoPosition:0,offsetTop:0,offsetLeft:0,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:[{s:"Su",l:"Sunday"},{s:"Mo",l:"Monday"},{s:"Tu",l:"Tuesday"},{s:"We",l:"Wednesday"},{s:"Th",l:"Thursday"},{s:"Fr",l:"Friday"},{s:"Sa",l:"Saturday"}]});$(cInput).click(function(){$(cLink).trigger("click")})})};inz.forms.fields.DateRangeField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.DateRangeField.prototype=Object.create(inz.forms.fields.DatePickerField.prototype);inz.forms.fields.DateRangeField.prototype.constructor=inz.forms.fields.DateRangeField;inz.forms.fields.DateRangeField.prototype.setup=function(initial){this.setupPickers();this.defaultDisplay();this.$from=this.$el.find("input#f_"+this.id+"_from");this.$to=this.$el.find("input#f_"+this.id+"_to")};inz.forms.fields.DateRangeField.prototype.getValue=function(){var value=this.$from.val()+" to "+this.$to.val();return value};inz.forms.fields.DateRangeField.prototype.setValue=function(value){if(values===void 0){this.reset();return}var values=value.split(" to ");if(values.length!=2)return;this.$from.val(values[0]).change();this.$to.val(values[1]).change()};inz.forms.fields.DateRangeField.prototype.initialError=function(){if("error"in this.config){window.ParsleyUI.addError(this.$from.parsley(),"custom-error-message",this.config["error_from"]);window.ParsleyUI.addError(this.$to.parsley(),"custom-error-message",this.config["error_to"])}};inz.forms.fields.DateRangeField.prototype.setName=function(name2){this.name=name2;this.$el.find("input").each(function(idx){var oldName=$(this).attr("name");if(oldName.endsWith("_from"))$(this).attr("name",name2+"_from");else if(oldName.endsWith("_to"))$(this).attr("name",name2+"_to");else $(this).attr("name",name2)})};inz.forms.fields.DateRangeField.prototype.setId=function(id){inz.forms.fields.Field.prototype.setId.call(this,id);var dr=this;this.$el.find(".calendarWrap").each(function(){var oldId=$(this).attr("id");if(oldId.endsWith("_from"))$(this).attr("id","c_"+id+"_from");else if(oldId.endsWith("_to"))$(this).attr("id","f_"+id+"_to")});this.$el.find("input").each(function(idx){var oldId=$(this).attr("id");var newId;if(oldId.endsWith("_from"))newId="f_"+id+"_from";else if(oldId.endsWith("_to"))newId="f_"+id+"_to";$(this).attr("id",newId);var a=dr.$el.find("a[data-name='"+oldId+"']").first();a.attr("aria-describedby",newId);a.attr("data-name",newId);if(oldId.endsWith("_to"))a.attr("data-dependant","f_"+id+"_from")});this.$from=this.$el.find("input#f_"+this.id+"_from");this.$to=this.$el.find("input#f_"+this.id+"_to")};inz.forms.fields.DateRangeField.prototype.enableValidation=function(){this.$el.removeClass("disable_val");this.$el.find("input").removeClass("disable_val");this.$el.find("input").removeAttr("disabled","disabled")};inz.forms.fields.DateRangeField.prototype.disableValidation=function(){this.$el.addClass("disable_val");this.$el.find("input").addClass("disable_val");this.$el.find("input").attr("disabled","disabled")};inz.forms.fields.DateRangeField.prototype.getErrorContainer=function(el){if(el.$element.attr("id").endsWith("_from"))return this.$el.find(".err_container_from");if(el.$element.attr("id").endsWith("_to"))return this.$el.find(".err_container_to")};inz.forms.fields.PAFField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.PAFField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.PAFField.prototype.constructor=inz.forms.fields.PAFField;inz.forms.fields.PAFField.prototype.init=function(form,$ctx,config){inz.forms.fields.Field.prototype.init.call(this,form,$ctx,config);this.reId=new RegExp("f_([a-zA-Z0-9]{7,})__(\\d+)")};inz.forms.fields.PAFField.prototype.reset=function(){this.$el.val("").trigger("change")};inz.forms.fields.PAFField.prototype.createCopy=function($ctx,id,name2){var copy=inz.forms.fields.Field.prototype.createCopy.call(this,$ctx,id,name2);copy.$container.find("span.select2").remove();return copy};inz.forms.fields.PAFField.prototype.setup=function(initial){var pafFieldSelects=this.$container.find("select.paf_field");pafFieldSelects.select2();pafFieldSelects.on("select2:select",function(e){$(this).parents(".paf_field").data("field").onSelect(e)});this.defaultDisplay()};inz.forms.fields.PAFField.prototype.onSelect=function(e){var updates=e.params.data["updates"];for(var fieldId in updates){if(updates.hasOwnProperty(fieldId)){this.findElementById(fieldId,e.target).val(updates[fieldId]).trigger("change")}}};inz.forms.fields.PAFField.prototype.findElementById=function(rawId,context){if(this.reId.test(context.id)){var idx=context.id.match(this.reId)[2];return $("#"+rawId+"__"+String(idx))}return $("#"+rawId)};inz.forms.fields.FileField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.FileField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.FileField.prototype.constructor=inz.forms.fields.FileField;inz.forms.fields.FileField.prototype.init=function(form,$ctx,config){inz.forms.fields.Field.prototype.init.call(this,form,$ctx,config)};inz.forms.fields.FileField.prototype.setValue=function(value){this.$el.val("")};inz.forms.fields.TextMessageField=function(){inz.forms.fields.Field.call(this);this.interlock=0};inz.forms.fields.TextMessageField.interlock=0;inz.forms.fields.TextMessageField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.TextMessageField.prototype.constructor=inz.forms.fields.TextMessageField;inz.forms.fields.TextMessageField.prototype.getValue=function(){if(this.isHidden){return null}else{return this.$el.find("input[type='hidden']").val()}};inz.forms.fields.TextMessageField.prototype.setValue=function(value){this.$el.find("input[type='hidden']").val(value).change()};inz.forms.fields.TextMessageField.prototype.setContent=function(title,note){let $note,$title=null;if(this.config["style"]==="NOTE"){$note=this.$container.find("div.exp_text");$title=this.$container.find("div.exp_title")}else if(this.config["style"]==="TEXT"){$note=this.$container.find("div.rt_content");$title=null}else if(this.config["style"]==="ALERT"||this.config["style"]==="MESSAGE"){$note=this.$container.find("div.banner_textcopy");$title=this.$container.find(".banner_title")}if(Boolean(title)&&$title!==null){$title.html(title)}$note.html(note)};inz.forms.fields.TextMessageField.prototype.reset=function(){this.$el.find("input[type='hidden']").change()};inz.forms.fields.TextMessageField.prototype.setup=function(initial){this.$el.change(this,this.form.changeEvent);this.defaultDisplay()};inz.forms.fields.TextMessageField.prototype.show=function(initial){inz.forms.fields.Field.prototype.show.call(this,initial);if(initial!==true){if(this.$el.data("terminate")==="True"){inz.forms.fields.TextMessageField.interlock+=1;this.interlock+=1;this.form.$form.find(".actions").hide();this.form.$form.find(".actions input").attr("disabled","disabled")}}};inz.forms.fields.TextMessageField.prototype.hide=function(initial){inz.forms.fields.Field.prototype.hide.call(this,initial);if(initial!==true){if(this.$el.data("terminate")==="True"){if(inz.forms.fields.TextMessageField.interlock>0){inz.forms.fields.TextMessageField.interlock-=this.interlock;if(inz.forms.fields.TextMessageField.interlock<0){inz.forms.fields.TextMessageField.interlock=0}}this.interlock=0;if(inz.forms.fields.TextMessageField.interlock==0){this.form.$form.find(".actions").show();this.form.$form.find(".actions input").removeAttr("disabled","disabled")}}}};inz.forms.fields.TextMessageField.prototype.isDisabled=function(){if(this.$el.data("terminate")==="True"){return this.$el.hasClass("disable_val")||this.$container.is(":hidden")}else{return true}};inz.forms.fields.CaptchaField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.CaptchaField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.CaptchaField.prototype.constructor=inz.forms.fields.CaptchaField;inz.forms.fields.CaptchaField.prototype.init=function(form,$ctx,config){inz.forms.fields.Field.prototype.init.call(this,form,$ctx,config);this.widgetId=null;this.$cc=this.$container.find("input[name=completed_captcha]");inz.forms.captchaField=this};inz.forms.fields.CaptchaField.prototype.setup=function(initial){this.setupCaptcha()};inz.forms.fields.CaptchaField.prototype.setupCaptcha=function(){if(typeof grecaptcha!=="undefined"&&typeof grecaptcha.render!=="undefined"&&this.widgetId===null){this.widgetId=grecaptcha.render(this.$container.find(".g-recaptcha").get(0),{"sitekey":this.config["site_key"],"callback":inz.forms.captchaCallback,"expired-callback":inz.forms.captchaExpired})}};inz.forms.fields.CaptchaField.prototype.show=function(initial){};inz.forms.fields.CaptchaField.prototype.hide=function(initial){};inz.forms.fields.CaptchaField.prototype.isDisabled=function(){return false};inz.forms.fields.CaptchaField.prototype.getValue=function(){return null};inz.forms.fields.CaptchaField.prototype.setValue=function(value){};inz.forms.fields.CaptchaField.prototype.reset=function(){this.$cc.val("").change();if(this.widgetId!==null)grecaptcha.reset(this.widgetId)};inz.forms.captchaCallback=function(){inz.forms.captchaField.$cc.val("Captcha completed");inz.forms.captchaField.$container.find(".captcha_wrap .err-msg").remove();if(window.form&&window.form.uLog)window.form.addLogEntry("Captcha","C","Completed")};inz.forms.captchaExpired=function(){inz.forms.captchaField.$cc.val("");if(window.form&&window.form.uLog)window.form.addLogEntry("Captcha","C","Expired")};inz.forms.fields.TestModeField=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.TestModeField.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.TestModeField.prototype.constructor=inz.forms.fields.TestModeField;inz.forms.fields.TestModeField.prototype.getValue=function(){if(this.isHidden){return null}else{return this.$el.find("input[type='hidden']").val()}};inz.forms.fields.TestModeField.prototype.setValue=function(value){this.$el.find("input[type='hidden']").val(value).change()};inz.forms.fields.TestModeField.prototype.reset=function(){this.$el.find("input[type='hidden']").change()};inz.forms.fields.Fieldset=function(){inz.forms.fields.Field.call(this)};inz.forms.fields.Fieldset.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.Fieldset.prototype.constructor=inz.forms.fields.Fieldset;inz.forms.fields.Fieldset.prototype.init=function(form,$ctx,config){inz.forms.fields.Field.prototype.init.call(this,form,$ctx,config)};inz.forms.fields.Fieldset.prototype.reset=function(){this.form.changeEvent({data:this})};inz.forms.fields.Fieldset.prototype.setup=function(initial){this.defaultDisplay()};inz.forms.fields.Fieldset.prototype.hasValue=function(){return false};inz.forms.fields.FieldGroup=function(){};inz.forms.fields.FieldGroup.prototype=Object.create(inz.forms.fields.Field.prototype);inz.forms.fields.FieldGroup.prototype.constructor=inz.forms.fields.FieldGroup;inz.forms.fields.FieldGroup.prototype.init=function(form,$ctx,config){inz.forms.fields.Field.prototype.init.call(this,form,$ctx,config);this.$container.addClass("obj_form_container");this.$template=this.$container.find(".form_group_tmpl").first();this.templateFields=[];this.prefix=config.prefix;this.minGroups=config.minGroups;this.maxGroups=config.maxGroups;this.disabledActions=false;this.groupTitleIndex=this.$container.find(".grp_title span.grp_idx").length!==0;this.groupIntroIndex=this.$container.find(".grp_intro span.grp_idx").length!==0;this.$groups=this.$container.find(".form_groups").first();this.reName=new RegExp("g_"+name+"\\[\\d+\\]\\.(.*)");this.reId=new RegExp("f_([a-zA-Z0-9]{7,})__\\d+");if(this.groupTitle===""&&this.groupIntro==="")this.$template.find(".group_sep").remove();let field=this;this.$container.find(".form_add_item").on("click",function(){field.addGroup()});this.$container.find(".form_remove_item").on("click",function(){field.removeGroup()})};inz.forms.fields.FieldGroup.prototype.setup=function(initial){this.templateFields=this.children;this.children=[];this.defaultDisplay()};inz.forms.fields.FieldGroup.prototype.disableActions=function(){this.disabledActions=true};inz.forms.fields.FieldGroup.prototype.hideActions=function(){this.$container.find(".form_add_item").hide();this.$container.find(".form_remove_item").hide()};inz.forms.fields.FieldGroup.prototype.showActions=function(){this.$container.find(".form_add_item").show();this.$container.find(".form_remove_item").show()};inz.forms.fields.FieldGroup.prototype.setupGroup=function(){for(let i=0;i<this.templateFields.length;i++)this.templateFields[i].disableValidation();if(this.minGroups>0){for(let i=0;i<this.minGroups;i++)this.addGroup()}this.processConditions();this.normaliseChildren();this.updateActions()};inz.forms.fields.FieldGroup.prototype.normaliseChildren=function(){if(this.isHidden){for(let i=0;i<this.children.length;i++){this.children[i].hide()}}};inz.forms.fields.FieldGroup.prototype.getValue=function(){let count=this.$container.find(".form_group").length;return{"count":count}};inz.forms.fields.FieldGroup.prototype.setValue=function(value){if(!("count"in value))return;let curCount=this.$container.find(".form_group").length;let target=value.count;if(curCount===target)return;if(curCount<target){for(let i=curCount;i!==target;i++)this.addGroup()}else if(curCount>target){for(let i=curCount;i!==target;i--)this.removeGroup(true)}};inz.forms.fields.FieldGroup.prototype.getCount=function(value){return this.$container.find(".form_group").length};inz.forms.fields.FieldGroup.prototype.stateChange=function(state){inz.forms.fields.Field.prototype.stateChange.call(this,state);if(state===inz.forms.fields.Field.STATE_READ_ONLY){this.$container.find(".form_actions .form_remove_item").prop("disabled",true);this.$container.find(".form_actions .form_add_item").prop("disabled",true)}else if(state===inz.forms.fields.Field.STATE_NORMAL){this.$container.find(".form_actions .form_remove_item").prop("disabled",false);this.$container.find(".form_actions .form_add_item").prop("disabled",false)}};inz.forms.fields.FieldGroup.prototype.createFullGroupName=function(name2,idx){let paddedIdx=String(idx);if(this.reName.test(name2))return"g_"+this.id+"["+paddedIdx+"]."+name2.match(this.reName)[1];else return"g_"+this.id+"["+paddedIdx+"]."+name2};inz.forms.fields.FieldGroup.prototype.createFullId=function(id,idx){if(this.reId.test(id))return id.match(this.reId)[1]+"__"+String(idx);else if(id.startsWith("f_"))return id.substring(2)+"__"+String(idx);else return id+"__"+String(idx)};inz.forms.fields.FieldGroup.prototype.createGroupId=function(id,idx){return id+"__"+String(idx)};inz.forms.fields.FieldGroup.prototype.getGroupNamePrefix=function(idx){if(this.group)this.group.getGroupNamePrefix(idx);return"g_"+this.id+"["+idx+"]."};inz.forms.fields.FieldGroup.prototype.createCopy=function($ctx,id,name2){let copy=inz.forms.fields.Field.prototype.createCopy.call(this,$ctx,id,name2);return copy};inz.forms.fields.FieldGroup.prototype.hasValue=function(){return false};inz.forms.fields.FieldGroup.prototype.updateActions=function(idx){if(this.disabledActions)return;if(idx===void 0)idx=this.$container.find(".form_group").length-1;let cnt=0;if(idx===this.minGroups-1)this.$container.find(".form_actions .form_remove_item").hide();else{this.$container.find(".form_actions .form_remove_item").show();cnt+=1}if(idx===this.maxGroups-1)this.$container.find(".form_actions .form_add_item").hide();else{this.$container.find(".form_actions .form_add_item").show();cnt+=1}if(cnt===1)this.$container.find(".form_actions").addClass("single_action").remove("multi_action");else this.$container.find(".form_actions").removeClass("single_action").addClass("multi_action")};inz.forms.fields.FieldGroup.prototype.setGroupTitle=function($group,idx){if(this.groupTitleIndex)$group.find(".grp_title span.grp_idx").html(String(idx+1));if(this.groupIntroIndex)$group.find(".grp_intro span.grp_idx").html(String(idx+1))};inz.forms.fields.FieldGroup.prototype.addGroup=function(){let fg=this;let groups=this.$groups.find(".form_group");let newGroup=this.$template.clone();newGroup.removeClass("form_group_tmpl");newGroup.addClass("form_group");let idx=groups.length;this.setGroupTitle(newGroup,idx);newGroup.find(".obj_form_container").each(function(){let field=fg.$template.find("#"+$(this).attr("id")).data("field");let newId=fg.createGroupId(field.id,idx);let newName=fg.getGroupNamePrefix(idx)+field.name;let newField=field.createCopy(newGroup,newId,newName);fg.form.addField(newField);$(this).data("field",newField);newField.enableValidation();newField.isHidden=newField.display!=inz.forms.fields.Field.STATE_HIDDEN});newGroup.find(".obj_form_container").each(function(){let field=$(this).data("field");if("parent"in field.config){let parent;if(field.config.parent===fg.id){parent=fg}else{let parentId=fg.createGroupId(field.config.parent,idx);parent=fg.form.getField(parentId)}field.parent=parent;parent.addChild(field)}if(field.config.conditions.length!==0){for(let i=0;i<field.config.conditions.length;i++){let config=field.config.conditions[i];let orgDependsId=config.depends;config.depends=fg.createGroupId(config.depends,idx);field.addCondition(config);config.depends=orgDependsId}}if(field.dependants.length!==0){for(let i=0;i<field.dependants.length;i++){let src=field.dependants[i];for(let j=0;j<src.config.conditions.length;j++){if(src.config.conditions[j].depends!==null&&field.id.startsWith(src.config.conditions[j].depends)){let cconfig=__spreadValues({},src.config.conditions[j]);cconfig.depends=field.id;let cond=Object.create(inz.forms.Condition.prototype);cond.init(src.form,src,cconfig,false);src.conditions.push(cond);break}}}}});newGroup.find(".obj_form_container").each(function(){let field=$(this).data("field");field.setup();field.processConditions()});newGroup.data("idx",idx);newGroup.appendTo(this.$groups);$(document).trigger("app:inittooltips",{target:newGroup});this.updateActions(idx);this.form.$form.parsley()._refreshFields();if(this.form.isInAccordian)this.form.adjustHeight()};inz.forms.fields.FieldGroup.prototype.removeGroup=function(noScroll){let fg=this;let $rec=this.$container.find(".form_group").last();$rec.find(".obj_form_container").each(function(){let field=$(this).data("field");fg.form.removeField(field);for(let i=0;i<field.conditions.length;i++){field.conditions[i].remove()}if(field.dependants.length!==0){for(let i=0;i<field.dependants.length;i++){let src=field.dependants[i];for(let j=0;j<src.conditions.length;j++){if(src.conditions[j].dependField===field){src.conditions.splice(j,1);break}}}}});$rec.remove();this.updateActions();if(this.form.isInAccordian)this.form.adjustHeight();if(noScroll!==void 0&&noScroll)return;let firstErrPos;let groups=this.$container.find(".form_group");if(groups.length===0)firstErrPos=this.$container.offset().top-inz.modularForms.errorScrollOffset;else firstErrPos=this.$container.find(".form_group").last().offset().top-inz.modularForms.errorScrollOffset;$("html, body").animate({"scrollTop":firstErrPos},666)};inz.forms.validators=inz.forms.validators||{};inz.forms.validators.isValidIRDNumber=function(str){str=String(str).replace(/-/g,"");if(!/^\d+$/.test(str)){return false}var num=parseInt(str,10);str=String(num);if(num<1e7||num>15e7){return false}var checkDigit=str.substring(str.length-1);var baseNumber=str.substring(0,str.length-1).padStart(8,"0");var weightFactors=[3,2,7,6,5,4,3,2];var values=weightFactors.map(function(num2,index){return num2*baseNumber.charAt(index)});var acc=values.reduce(function(acc2,val){return acc2+val},0);var calculatedCheckDigit=acc%11===0?0:11-acc%11;if(calculatedCheckDigit>9){var secondaryWeightFactors=[7,4,3,2,5,2,7,6];values=secondaryWeightFactors.map(function(num2,index){return num2*baseNumber.charAt(index)});acc=values.reduce(function(acc2,val){return acc2+val},0);calculatedCheckDigit=acc%11===0?0:11-acc%11;if(calculatedCheckDigit>9){return false}}return calculatedCheckDigit===+checkDigit};inz.forms.validators.initNZBankAccountNumberWidget=function(){var fields=$("input[data-parsley-nz-bank-account-number][data-auto-hyphen]");fields.mask("00-0000-0000000-009")};inz.forms.validators.isValidNZBankAccountNumber=function(str){var r=RegExp(/^(\d{1,2})-(\d{1,4})-(\d{1,8})-(\d{2,3})$/).exec(str);if(!r){return false}var bank=r[1].padStart(2,"0");var branch=r[2].padStart(4,"0");var accountBase=r[3].padStart(8,"0");var accountSuffix=r[4].padStart(4,"0");var bankData=inz.forms.validators.NZ_BANK_ACCOUNT_NUMBER_BANK_DATA[bank];if(!bankData){return false}var validBranch=false;for(var n=0;n<bankData.branches.length;n++){if(branch>=bankData.branches[n].from&&branch<=bankData.branches[n].to){validBranch=true;break}}if(!validBranch){return false}var algorithm=null;if(bankData.algorithm===void 0){algorithm=accountBase<99e4?inz.forms.validators.NZ_BANK_ACCOUNT_NUMBER_ALGORITHMS.A:inz.forms.validators.NZ_BANK_ACCOUNT_NUMBER_ALGORITHMS.B}else{algorithm=inz.forms.validators.NZ_BANK_ACCOUNT_NUMBER_ALGORITHMS[bankData.algorithm]}if(!algorithm){console.error('Could not look up alogrithm for "'+str+'"');return false}var paddedAccountNumber=bank+branch+accountBase+accountSuffix;var products=algorithm.weights.map(function(weight,index){switch(bankData.algorithm){case"E":case"G":var val=weight*paddedAccountNumber.charAt(index);val=Math.floor(val/10)+val%10;val=Math.floor(val/10)+val%10;return val;default:return weight*paddedAccountNumber.charAt(index)}});var acc=products.reduce(function(acc2,val){return acc2+val},0);return acc%algorithm.modulo===0};inz.forms.validators.NZ_BANK_ACCOUNT_NUMBER_BANK_DATA={"01":{"branches":[{"from":1,"to":999},{"from":1100,"to":1199},{"from":1800,"to":1899}]},"02":{"branches":[{"from":1,"to":999},{"from":1200,"to":1299}]},"03":{"branches":[{"from":1,"to":999},{"from":1300,"to":1399},{"from":1500,"to":1599},{"from":1700,"to":1799},{"from":1900,"to":1999},{"from":7350,"to":7399}]},"04":{"branches":[{"from":2020,"to":2024}]},"05":{"algorithm":"X","branches":[{"from":8884,"to":8889}]},"06":{"branches":[{"from":1,"to":999},{"from":1400,"to":1499}]},"08":{"algorithm":"D","branches":[{"from":6500,"to":6599}]},"09":{"algorithm":"E","branches":[{"from":0,"to":0}]},"10":{"branches":[{"from":5165,"to":5169}]},"11":{"branches":[{"from":5e3,"to":6499},{"from":6600,"to":8999}]},"12":{"branches":[{"from":3e3,"to":3299},{"from":3400,"to":3499},{"from":3600,"to":3699}]},"13":{"branches":[{"from":4900,"to":4999}]},"14":{"branches":[{"from":4700,"to":4799}]},"15":{"branches":[{"from":3900,"to":3999}]},"16":{"branches":[{"from":4400,"to":4499}]},"17":{"branches":[{"from":3300,"to":3399}]},"18":{"branches":[{"from":3500,"to":3599}]},"19":{"branches":[{"from":4600,"to":4649}]},"20":{"branches":[{"from":4100,"to":4199}]},"21":{"branches":[{"from":4800,"to":4899}]},"22":{"branches":[{"from":4e3,"to":4049}]},"23":{"branches":[{"from":3700,"to":3799}]},"24":{"branches":[{"from":4300,"to":4349}]},"25":{"algorithm":"F","branches":[{"from":2500,"to":2599}]},"26":{"algorithm":"G","branches":[{"from":2600,"to":2699}]},"27":{"branches":[{"from":3800,"to":3849}]},"28":{"algorithm":"G","branches":[{"from":2100,"to":2149}]},"29":{"algorithm":"G","branches":[{"from":2150,"to":2299}]},"30":{"branches":[{"from":2900,"to":2949}]},"31":{"algorithm":"X","branches":[{"from":2800,"to":2849}]},"33":{"algorithm":"F","branches":[{"from":6700,"to":6799}]},"35":{"branches":[{"from":2400,"to":2499}]},"38":{"branches":[{"from":9e3,"to":9499}]},"88":{"algorithm":"X","branches":[{"from":8800,"to":8803},{"from":8805,"to":8805}]}};inz.forms.validators.NZ_BANK_ACCOUNT_NUMBER_ALGORITHMS={"A":{"modulo":11,"weights":[0,0,6,3,7,9,0,0,10,5,8,4,2,1,0,0,0,0]},"B":{"modulo":11,"weights":[0,0,0,0,0,0,0,0,10,5,8,4,2,1,0,0,0,0]},"C":{"modulo":11,"weights":[3,7,0,0,0,0,9,1,10,5,3,4,2,1,0,0,0,0]},"D":{"modulo":11,"weights":[0,0,0,0,0,0,0,7,6,5,4,3,2,1,0,0,0,0]},"E":{"modulo":11,"weights":[0,0,0,0,0,0,0,0,0,0,5,4,3,2,0,0,0,1]},"F":{"modulo":10,"weights":[0,0,0,0,0,0,0,1,7,3,1,7,3,1,0,0,0,0]},"G":{"modulo":10,"weights":[0,0,0,0,0,0,0,1,3,7,1,3,7,1,0,3,7,1]},"X":{"modulo":1,"weights":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}};


var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a,_b,_c,_d,_e,_f;inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.validations.BankCodeIBAN=(_a=class{static create(cfg_str,vp){if(!cfg_str.startsWith(this.prefix))return null;let m=cfg_str.match(this.format);if(m===null){console.log("ERROR: validation config");return null}let len=Number(m[1]);let sections=m[2].match(this.bban_re);if(sections===null){console.log("ERROR: invalid sub config: "+cfg_str);return null}return new inz.forms.validations.BankCodeIBAN(len,sections,vp)}constructor(len,secs,vp){this.length=len;this.sections=[];let re_str;let definitions=null;if(vp!==void 0){this.mask="XY99";let lwr=vp.toLowerCase();definitions={"X":{"validator":`[${vp[0]}${lwr[0]}]`,"casing":"upper","placeholder":`${vp[0]}`},"Y":{"validator":`[${vp[1]}${lwr[1]}]`,"casing":"upper","placeholder":`${vp[1]}`}};re_str=`^${vp}[0-9]{2}`}else{this.mask="AA99";re_str="^[A-Z]{2}[0-9]{2}"}for(let s of secs){if(s.length===0)break;let a={"l":parseInt(s),"c":s[s.length-1]};this.sections.push(a);this.mask+=inz.forms.validations.BankCodeIBAN.mask_map[a.c].repeat(a.l);re_str+=`${inz.forms.validations.BankCodeIBAN.re_map[a.c]}{${a.l}}`}this.mask=this.mask.replace(/(.{4})/g,"$1-");if(this.mask[this.mask.length-1]==="-")this.mask=this.mask.slice(0,-1);re_str+="$";this.re=new RegExp(re_str);if(definitions!==null){this.mask={"mask":this.mask,"definitions":definitions}}}getInputMask(){return this.mask}getValidationMessage(){return`a valid IBAN code of ${this.length} characters`}setup(field){let $f=$(field);$f.inputmask(this.mask);$f.attr("data-parsley-error-message",`a valid IBAN code of ${this.length} characters`)}validate(input){let i=input.replaceAll("-","");if(!this.re.test(i))return false;return this.validateIBAN(i)}validateIBAN(input){let iban=(input.substr(4)+input.substr(0,4)).toUpperCase();iban=iban.replace(/[A-Z]/g,function(m){return m.charCodeAt(0)-55});let block;let iter=0;while(iban.length>2&&iter<100){block=iban.slice(0,9);iban=parseInt(block,10)%97+iban.slice(block.length);iter+=1}let checkcode=parseInt(iban,10)%97;return checkcode===1}inputTransforms(field){}},__publicField(_a,"nam","IBAN"),__publicField(_a,"prefix","I"),__publicField(_a,"format",/I(\d+)-?(.*)/),__publicField(_a,"bban_re",/(\d+[n|c|a])?/g),__publicField(_a,"B_DIGITS","n"),__publicField(_a,"B_UPPER","a"),__publicField(_a,"B_ALPHA","c"),__publicField(_a,"B_BLANK","e"),__publicField(_a,"mask_map",{"n":"9","a":"A","c":"+","e":" "}),__publicField(_a,"re_map",{"n":"[0-9]","a":"[A-Z]","c":"[A-z0-9]","e":" "}),_a);inz.forms.validations.BankCodeSWIFT=(_b=class{static create(cfg_str,vp){if(!cfg_str.startsWith(this.prefix))return null;return new inz.forms.validations.BankCodeSWIFT}constructor(){this.re=inz.forms.validations.BankCodeSWIFT.def_re}getInputMask(){return inz.forms.validations.BankCodeSWIFT.def_mask}getValidationMessage(){return"a valid 8 or 11 character SWIFT code"}setup(field){let $f=$(field);$f.inputmask(inz.forms.validations.BankCodeSWIFT.def_mask);$f.attr("data-parsley-error-message",`Please enter a valid 8 or 11 character SWIFT code`)}validate(input){return this.re.test(input)}inputTransforms(field){}},__publicField(_b,"nam","SWIFT"),__publicField(_b,"prefix","S"),__publicField(_b,"def_re",/^[A-Z]{4}-[A-Z]{2}-[A-Z0-9]{2}(?:-[A-Z0-9]{3})?$/),__publicField(_b,"def_mask",{"mask":"AAAA-AA-++[-+{3}]","greedy":false}),_b);inz.forms.validations.BankCodeAlpha=(_c=class{static create(cfg_str,vp){if(!cfg_str.startsWith(this.prefix))return null;let m=cfg_str.match(this.format);if(m===null){console.log("ERROR: validation config");return null}if(m[2]===void 0){return new inz.forms.validations.BankCodeAlpha(Number(m[1]))}else{return new inz.forms.validations.BankCodeAlpha(Number(m[1]),Number(m[2]))}}constructor(len,max_length){this.length=len;this.max_length=max_length;if(this.max_length===void 0){this.range=false;this.re=new RegExp(`^[0-9A-z]{${this.length}}$`);this.mask=`*{${this.length}}`}else{this.range=true;this.re=new RegExp(`^[0-9A-z]{${this.length},${this.max_length}}$`);this.mask={"mask":`*{${this.length}}[*{${this.max_length-this.length}}]`,"greedy":false}}}setup(field){let $f=$(field);$f.inputmask(this.mask);if(this.range){$f.attr("data-parsley-error-message",`Please enter ${this.length} to ${this.max_length} characters`)}else{$f.attr("data-parsley-error-message",`Please enter ${this.length} digits`)}}getInputMask(){return this.mask}getValidationMessage(){if(this.range){return`${this.length} to ${this.max_length} characters`}else{return"data-parsley-error-message",`${this.length} characters`}}validate(input){let unmasked=Inputmask.unmask(input,{mask:this.mask});return this.re.test(input)}inputTransforms(field){}},__publicField(_c,"nam","Alpha"),__publicField(_c,"prefix","A"),__publicField(_c,"format",/A(\d+)(?:-(\d+))?/),_c);inz.forms.validations.BankCodeDigit=(_d=class{static create(cfg_str,vp){if(!cfg_str.startsWith(this.prefix))return null;let m=cfg_str.match(this.format);if(m===null){console.log("ERROR: validation config");return null}if(m[2]===void 0){return new inz.forms.validations.BankCodeDigit(Number(m[1]))}else{return new inz.forms.validations.BankCodeDigit(Number(m[1]),Number(m[2]))}}constructor(len,max_length){this.length=len;this.max_length=max_length;if(this.max_length===void 0){this.range=false;this.re=new RegExp(`^\\d{${this.length}}$`);this.mask=`9{${this.length}}`}else{this.range=true;this.re=new RegExp(`^\\d{${this.length},${this.max_length}}$`);this.mask={"mask":`9{${this.length}}[9{${this.max_length-this.length}}]`,"greedy":false}}}getInputMask(){return this.mask}getValidationMessage(){if(this.range){return`${this.length} to ${this.max_length} digits`}else{return"data-parsley-error-message",`${this.length} digits`}}setup(field){let $f=$(field);$f.inputmask(this.mask);if(this.range){$f.attr("data-parsley-error-message",`Please enter ${this.length} to ${this.max_length} digits`)}else{$f.attr("data-parsley-error-message",`Please enter ${this.length} digits`)}}validate(input){let unmasked=Inputmask.unmask(input,{mask:this.mask});return this.re.test(unmasked)}inputTransforms(field){}},__publicField(_d,"nam","Digit"),__publicField(_d,"prefix","D"),__publicField(_d,"format",/D(\d+)(?:-(\d+))?/),_d);inz.forms.validations.BankCodeMask=(_e=class{static create(cfg_str,vp){if(!cfg_str.startsWith(this.prefix))return null;let m=cfg_str.match(this.format);if(m===null){console.log("ERROR: validation config");return null}let mask;try{mask=JSON.parse(m[1])}catch(e){console.log("ERROR: mask invalid syntax");return null}return new inz.forms.validations.BankCodeMask(mask,m[2])}constructor(mask,message){this.mask=mask;this.message=message}getInputMask(){return this.mask}getValidationMessage(){return this.message}validate(input){let unmasked=Inputmask.unmask(input,{mask:this.mask});return true}inputTransforms(field){}},__publicField(_e,"nam","Mask"),__publicField(_e,"prefix","M"),__publicField(_e,"format",/^M(.*)\|(.*)$/),_e);inz.forms.fields.BankCode=(_f=class extends inz.forms.fields.Field{static setupFieldType(parsley){window.Parsley.addValidator("bankCode",{validateString:function(value,requirement,instance){return instance.$element.data("field").validateInput(value)}});Inputmask.extendDefinitions({"+":{validator:"[0-9A-z]",casing:"upper"}})}useGetOnSubmit(){return true}init(form,$ctx,config){super.init(form,$ctx,config);this.validation=null;this.prefix=null;this.inputMask=""}setPrefix(prefix){if(prefix===null){this.prefix=null;return}this.prefix=prefix}reset(){super.reset()}setup(initial){let _this=this;this.$el.on("input",function(){_this.inputTransforms(this)});this.defaultDisplay()}setupField(f){this.inputMask={mask:"",definitions:{}};let message="";if("pv"in f){this.prefix={t:"static",v:f.pv}}else if("pu"in f){this.prefix={t:"user",v:f.pu};this.prefix.validation=this.createValidation(f.pu);if(this.prefix.validation!==null){this.combineMasks(this.inputMask,this.prefix.validation.getInputMask());this.combineMasks(this.inputMask,"-");message=this.prefix.validation.getValidationMessage()}else{console.log("Validation not found: "+f.pu)}}else{this.prefix=null}if("v"in f){this.validation=this.createValidation(f.v,f.vp);if(this.validation!==null){this.combineMasks(this.inputMask,this.validation.getInputMask());if(message!=="")message+=" followed by ";message+=this.validation.getValidationMessage()}else{console.log("Validation not found: "+f.v)}}this.$el.inputmask(this.inputMask);this.$el.attr("data-parsley-error-message","Please enter "+message)}createValidation(vstr,vp){for(let validation of inz.forms.fields.BankCode.validation_classes){let v=validation.create(vstr,vp);if(v===null)continue;return v}return null}combineMasks(dst,src){if(typeof src==="object"){if(Array.isArray(dst.mask)||Array.isArray(src.mask)){let dm=dst.mask;if(!Array.isArray(dm)){dm=[dm]}let sm=src.mask;if(!Array.isArray(sm)){sm=[sm]}for(let i in sm){if(dm[i]===void 0)dm.push("")}for(let i in dm){dm[i]+=sm[i]}dst.mask=dm}else{dst.mask+=src.mask}if("definitions"in src){Object.assign(dst.definitions,src.definitions)}if("greedy"in src){dst.greedy=src.greedy}}else{dst.mask+=src}}setLabel(label){this.$container.find("label").contents().first().replaceWith(label)}inputTransforms(field){if(this.validation===null||this.validation===void 0)return;this.validation.inputTransforms(field)}validateInput(str){if(this.inputMask&&!this.$el.inputmask("isComplete"))return false;if(this.validation===null||this.validation===void 0)return true;if(!this.validation.validate(str))return false;return true}getValue(){if(this.prefix!==null&&this.prefix.t==="static"){return this.prefix.v+this.$el.val()}return this.$el.val()}},__publicField(_f,"validation_classes",[inz.forms.validations.BankCodeIBAN,inz.forms.validations.BankCodeSWIFT,inz.forms.validations.BankCodeAlpha,inz.forms.validations.BankCodeDigit,inz.forms.validations.BankCodeMask]),_f);


inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.ContentImage=class extends inz.forms.fields.Field{static setupFieldType(parsley){}init(form,$ctx,config){super.init(form,$ctx,config);this.validation=null;this.prefix=""}reset(){super.reset()}setup(initial){let _this=this;this.$el.on("input",function(){_this.inputTransforms(this)});this.defaultDisplay()}hasValue(){return false}};


inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.ContentVideo=class extends inz.forms.fields.Field{static setupFieldType(parsley){}init(form,$ctx,config){super.init(form,$ctx,config);this.validation=null;this.prefix=""}reset(){super.reset()}setup(initial){let transcript=this.$el.find(".video_guide_transcript");this.$el.find(".video_guide_transcript_title").unbind().on("click",function(e){$(this).toggleClass("active");transcript.toggle();e.preventDefault();e.stopPropagation()});this.defaultDisplay()}hasValue(){return false}};


var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a;inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.DMYField=(_a=class extends inz.forms.fields.Field{init(form,$ctx,config){inz.forms.fields.Field.prototype.init.call(this,form,$ctx,config);this.reName=new RegExp("([a-zA-Z0-9]{7,})_(day|month|year)$");this.reId=new RegExp("f_([a-zA-Z0-9]{7,})_(day|month|year)$");this.$day=this.$el.find("select#f_"+this.id+"_day");this.$month=this.$el.find("select#f_"+this.id+"_month");this.$year=this.$el.find("select#f_"+this.id+"_year")}initialError(){if("error"in this.config){window.ParsleyUI.addError(this.$day.parsley(),"custom-error-message",this.config["error_day"]);window.ParsleyUI.addError(this.$month.parsley(),"custom-error-message",this.config["error_month"]);window.ParsleyUI.addError(this.$year.parsley(),"custom-error-message",this.config["error_year"])}}createCopy($ctx,id,name){let copy=inz.forms.fields.Field.prototype.createCopy.call(this,$ctx,id,name);copy.$container.find("span.select2").remove();return copy}getValue(){let value=this.$day.val()+" "+this.$month.val()+" "+this.$year.val();return value}setValue(value){if(value===void 0){this.reset();return}let values=value.split(" ");if(values.length!=3)return;this.$day.val(values[0]).change();this.$month.val(values[1]).change();this.$year.val(values[2]).change()}getISOValue(){return this.$year.val()+"-"+inz.forms.fields.DMYField.months[this.$month.val()]+"-"+this.$day.val()}validate(){let year=this.$year.val();let month=Number(inz.forms.fields.DMYField.months[this.$month.val()]);let day=this.$day.val();if(year<1e3||year>3e3||month===0||month>12)return false;let monthLength=[31,28,31,30,31,30,31,31,30,31,30,31];if(year%400==0||year%100!=0&&year%4==0)monthLength[1]=29;return day>0&&day<=monthLength[month-1]}reset(){this.$container.find("select").val("").trigger("change")}setup(initial){let dmyFieldSelects=this.$container.find("select");dmyFieldSelects.select2();this.defaultDisplay();let field=this;dmyFieldSelects.on("change",function(){if(field.form.settingValues)return;if(field.$container.find(".disable_val").length!==0)return;if(!field.$year.val()&&!field.$month.val()&&!field.$day.val())return;if(field.$container.find(".dmy_container").parsley().validate()==true)field.form.changeEvent({data:field})})}getErrorContainer(el){if(el.$element.hasClass("dob_day"))return this.$el.find(".err_container_day");else if(el.$element.hasClass("dob_month"))return this.$el.find(".err_container_month");else if(el.$element.hasClass("dob_year"))return this.$el.find(".err_container_year")}setName(name){let df=this;this.name=name;this.$el.find("select").each(function(idx){let oldName=$(this).attr("name");let suffix=oldName.match(df.reName);if(suffix!==null)$(this).attr("name",name+"_"+suffix[2]);else $(this).attr("name",name)})}setId(id){let df=this;inz.forms.fields.Field.prototype.setId.call(this,id);this.$el.find("select").each(function(idx){let oldId=$(this).attr("id");let suffix=oldId.match(df.reId);if(suffix!==null)$(this).attr("id","f_"+id+"_"+suffix[2])});this.$day=this.$el.find("select#f_"+this.id+"_day");this.$month=this.$el.find("select#f_"+this.id+"_month");this.$year=this.$el.find("select#f_"+this.id+"_year")}enableValidation(){this.validation=true;this.$el.removeClass("disable_val");this.$el.find("select").removeClass("disable_val");this.$el.find("select").removeAttr("disabled","disabled");this.$container.find(".dmy_container").removeClass("disable_val")}disableValidation(){this.validation=false;this.$el.addClass("disable_val");this.$el.find("select").addClass("disable_val");this.$el.find("select").attr("disabled","disabled");this.$container.find(".dmy_container").addClass("disable_val")}},__publicField(_a,"months",{"January":"01","February":"02","March":"03","April":"04","May":"05","June":"06","July":"07","August":"08","September":"09","October":"10","November":"11","December":"12"}),_a);


inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.HiddenField=class extends inz.forms.fields.Field{init(form,$ctx,config){super.init(form,$ctx,config);this.dependField=null}setup(initial){super.setup(initial);if(this.config["src"]){this.dependField=this.form.getField(this.config.src);if(this.dependField===null){console.debug(`Hidden field ${this.id} Source field not found: ${this.config.src}`);return}if(this.dependField.inGroup()){if(this.dependField.inGroupTmpl&&this.inGroupTmpl){this.dependField.addDependant(this)}else if(!this.inGroup()){console.error(`Field ${this.id} NOT in group, source ${this.dependField.id} is. Can't connect`);return false}else{this.dependField=this.form.fields[this.config.src+this.id.substr(this.id.indexOf("_"))];if(this.dependField===void 0){console.error(`Field ${this.id} in group, can't find source field in same group ${this.config.src+this.id.substr(this.id.indexOf("_"))}`)}else{this.dependField.addDependant(this)}}}else{this.dependField.addDependant(this)}}}isDisabled(){if(this.dependField!==null){return this.dependField.isDisabled()}return false}depChanged(field,value){if(field instanceof inz.forms.fields.SMCSelectionField){let new_value=field.getValueSA(this.config["sa"]);this.setValue(new_value)}}};


var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a;inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.fields.InternationalPayment=(_a=class extends inz.forms.fields.Field{static setupFieldType(parsley){}init(form,$ctx,config){super.init(form,$ctx,config);this.fieldMap={};this.defaultLabels={};this.currentCountry=void 0;this.processHide={}}addChild(child){super.addChild(child);let fid=this.config.fields[child.name];if(fid!==void 0&&fid!==null)this.fieldMap[fid]=child}reset(){for(const child of this.children){child.clearValidation();if(child!==this.fieldMap[inz.forms.fields.InternationalPayment.fids.UNSUP]&&child!==this.fieldMap[inz.forms.fields.InternationalPayment.fids.COUNTRY]){child.hide()}else if(child===this.fieldMap[inz.forms.fields.InternationalPayment.fids.COUNTRY]){child.show()}}this.fieldMap[inz.forms.fields.InternationalPayment.fids.UNSUP].hide()}setup(initial){this.defaultDisplay();this.defaultLabels[inz.forms.fields.InternationalPayment.fids.OTHER]=this.getLabel(inz.forms.fields.InternationalPayment.fids.OTHER);let f=this;this.fieldMap[inz.forms.fields.InternationalPayment.fids.COUNTRY].$el.change(function(evt){f.countrySelected(evt)});this.fieldMap[inz.forms.fields.InternationalPayment.fids.ACCOUNT_TYPE].$el.change(function(evt){f.accountTypeSelected(evt)})}getLabel(fid){let f=this.fieldMap[fid];if(f===void 0)return null;return f.$container.find("label").contents().first()}setLabel(fid,label){let f=this.fieldMap[fid];if(f===void 0)return null;f.$container.find("label").contents().first().replaceWith(label)}resetCodes(){for(const f of inz.forms.fields.InternationalPayment.reset_fields){this.fieldMap[f].clearValidation();this.fieldMap[f].hide()}}accountTypeSelected(evt){let account_type=this.fieldMap[inz.forms.fields.InternationalPayment.fids.ACCOUNT_TYPE].getValue();if(this.currentCountry===void 0)return;this.processHide={};for(const f of this.currentCountry["f"]){if("c"in f){this.processField(this.currentCountry,f,account_type)}}this.hideRemaining(this.processHide)}countrySelected(evt){this.currentCountry=void 0;let country=this.fieldMap[inz.forms.fields.InternationalPayment.fids.COUNTRY];if(country.getValue()==="")return;let c=this.config.countries[country.getValue()];if(c===void 0){this.countrySupported(false);return}if(!("f"in c)){console.log("No fields defined");this.countrySupported(false);return}this.currentCountry=c;this.countrySupported(true);this.resetCodes();let account_type=this.fieldMap[inz.forms.fields.InternationalPayment.fids.ACCOUNT_TYPE].getValue();this.processHide={};for(const f of c["f"]){this.processField(c,f,account_type)}this.hideRemaining(this.processHide);if(c["c"]!==void 0&&c["c"].length>1){let data=[];for(const cur of c["c"]){data.push({id:cur,text:cur})}this.fieldMap[inz.forms.fields.InternationalPayment.fids.CURRENCY].$container.find("select").empty().select2({data}).trigger("change");this.fieldMap[inz.forms.fields.InternationalPayment.fids.CURRENCY].show(false)}else{this.fieldMap[inz.forms.fields.InternationalPayment.fids.CURRENCY].hide(false)}}hideRemaining(fields){for(const f of Object.keys(fields)){if(fields[f]){let field=this.fieldMap[f];field.hide(false)}}}processField(c,f,account_type){let field=this.fieldMap[f.i];if("c"in f){if(f.c==="IND"&&account_type==="Business"||f.c==="BUS"&&(account_type===void 0||account_type==="Individual")){if(!(f.i in this.processHide)){this.processHide[f.i]=true}return}}this.processHide[f.i]=false;if("l"in f){this.setLabel(f.i,f.l)}else if(f.i in this.defaultLabels){this.setLabel(f.i,this.defaultLabels[f.i])}if("e"in f&&field.setContent!==void 0){if("t"in f){field.setContent(inz.forms.unescapeHTML(f.t),inz.forms.unescapeHTML(f.e))}else{field.setContent(null,inz.forms.unescapeHTML(f.e))}}if("o"in f){field.setRequired(f.o)}else{field.setRequired(true)}if(field.setupField!==void 0)field.setupField(f);field.show(true)}countrySupported(supported){for(const child of this.children){if(child!==this.fieldMap[inz.forms.fields.InternationalPayment.fids.UNSUP]&&child!==this.fieldMap[inz.forms.fields.InternationalPayment.fids.COUNTRY]){child.clearValidation();if(supported)child.show();else child.hide()}}if(supported){this.fieldMap[inz.forms.fields.InternationalPayment.fids.UNSUP].hide()}else{this.fieldMap[inz.forms.fields.InternationalPayment.fids.UNSUP].show()}}},__publicField(_a,"fids",{COUNTRY:0,UNSUP:1,CURRENCY:2,ACCOUNT_TYPE:7,SWIFT:9,IBAN:10,OTHER:11,ACC:12,ROUTING:13,TAX_ID:14,OTHER_BANNER:15}),__publicField(_a,"reset_fields",[2,9,10,12,11,13,14,15]),__publicField(_a,"account_type_field","bank_account_type"),_a);


inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.InternationalPhoneNumberField=class extends inz.forms.fields.Field{init(form,$ctx,config){super.init(form,$ctx,config);this.iti=null}reset(){if(this.iti!=null){this.iti.setNumber("")}}setup(initial){let args={dropdownContainer:document.body,preferredCountries:["nz"],utilsScript:this.config["iti_utils_url"],placeholderNumberType:this.$el.data("placeholderNumberType")};let cc=Cookies.get("geoip_user_cc");if(this.$el.data("geoip")!==void 0&&typeof cc=="string"&&cc!=="null"){args["initialCountry"]="auto";args["geoIpLookup"]=(success,failure)=>{success(cc)}}else{args["initialCountry"]="NZ"}this.iti=window.intlTelInput(this.$el[0],args);this.$el.data("iti",this.iti);this.$el.keyup(this,this.form.changeEvent);this.defaultDisplay()}useGetOnSubmit(){return true}getValue(){return this.iti.getNumber()}setValue(value){this.iti.setNumber(value)}static setupFieldType(parsley){window.Parsley.addValidator("internationalPhoneNumber",{validateString:function(value,requirement,instance){let iti=instance.$element.data("iti");let isValid=iti.isValidNumber();if(!isValid){window.Parsley.addMessage("en","internationalPhoneNumber",["Invalid number","Invalid country code","Too short","Too long","Invalid number"][iti.getValidationError()])}return isValid}})}};


inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.Number=class extends inz.forms.fields.Field{static setupFieldType(parsley){window.Parsley.addValidator("numberField",{validateString:function(value,requirement,instance){let field=instance.$element.data("field");let isValid=field.isValid();return isValid}})}useGetOnSubmit(){return true}init(form,$ctx,config){super.init(form,$ctx,config);this.inputMask={"alias":"decimal","digits":this.config.cfg.dp,"digitsOptional":false};if("plh"in this.config.cfg){this.inputMask.placeholder=this.config.cfg.plh}if(this.config.cfg.sep===true){this.inputMask.groupSeparator=",";this.inputMask.autoGroup=true}this.restrictInput=this.config.cfg.res;if("pfx"in this.config.cfg){this.inputMask.prefix=this.config.cfg.pfx}if("sfx"in this.config.cfg){this.inputMask.suffix=" "+this.config.cfg.sfx}if("max"in this.config.cfg&&this.restrictInput){this.inputMask.max=this.config.cfg.max}}reset(){super.reset()}enableValidation(){this.$el.removeClass("disable_val");this.$el.removeAttr("disabled","disabled")}setup(initial){let _this=this;this.$el.inputmask(this.inputMask);this.$el.on("focusout",this.form.focusOut);this.$el.keyup(this,this.form.changeEvent);this.defaultDisplay()}setLabel(label){this.$container.find("label").contents().first().replaceWith(label)}inputTransforms(field){if(this.validation===null||this.validation===void 0)return;this.validation.inputTransforms(field)}validateInput(str){if(this.inputMask&&!this.$el.inputmask("isComplete"))return false;if(this.validation===null||this.validation===void 0)return true;if(!this.validation.validate(str))return false;return true}getValue(){return this.$el.val()}getNumberValue(){let v=this.$el.inputmask("unmaskedvalue");return v}isValid(){let n=this.getNumberValue();if(isNaN(n)){return false}if("max"in this.config.cfg){if(n>this.config.cfg.max){console.log(`Over: value: ${n} is over max: ${this.config.cfg.max}`);return false}}if("min"in this.config.cfg){if(n<this.config.cfg.min){console.log(`Under: value: ${n} is under min: ${this.config.cfg.min}`);return false}}return true}};


inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.RadioButtonsField=class extends inz.forms.fields.Field{useGetOnSubmit(){return true}stateChange(state){if(state===inz.forms.fields.Field.STATE_READ_ONLY){this.disableValidation();this.$container.attr("data-st","ro")}else{this.enableValidation();this.$container.attr("data-st","rw")}}getValue(real){if(real===void 0)real=false;let $opt=this.$container.find("input:checked");if(real){return $opt.val()}let oid=$opt.attr("data-ouid");return oid}setValue(value){this.$container.find("input:checked").removeAttr("checked");if(value===null||value===void 0){this.$container.find("input:checked").removeAttr("checked")}else{if(value.startsWith("__oid_")){this.$container.find("input[data-ouid='"+value+"']").prop("checked",true)}else{this.$container.find('input[type=radio][value="'+inz.forms.escapeHTML(value)+'"]').prop("checked",true)}}this.$el.find("input[type='radio']").first().change()}reset(){this.$container.find("input:checked").removeAttr("checked");this.$el.find("input[type='radio']").first().change()}setup(initial){this.$el.find("input[type='radio']").change(this,this.form.changeEvent);this.$el.find("input[type='radio']").on("focusout",this.form.focusOut);this.defaultDisplay()}setName(name){this.name=name;this.$el.find("input").each(function(idx){$(this).attr("name",name)})}setId(id){inz.forms.fields.Field.prototype.setId.call(this,id);let rb=this;this.$el.find("input").each(function(idx){let $e=$(this);let oldId=$e.attr("id");let oid=oldId.substring(oldId.lastIndexOf("_"));let newId="opt_"+id+oid;$e.attr("id",newId);$e.attr("data-parsley-multiple",id);rb.$el.find("label[for='"+oldId+"']").attr("for",newId)})}enableValidation(){this.$el.removeClass("disable_val");this.$el.find("input").removeClass("disable_val");this.$el.find("input").removeAttr("disabled","disabled")}disableValidation(){this.$el.addClass("disable_val");this.$el.find("input").addClass("disable_val");this.$el.find("input").attr("disabled","disabled")}};


inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.SelectionField=class extends inz.forms.fields.Field{init(form,$ctx,config){super.init(form,$ctx,config);this.reId=new RegExp("f_([a-zA-Z0-9]{7,})__(\\d+)")}useGetOnSubmit(){return true}reset(){let def="";if("default"in this.config)def=this.config["default"];this.$el.val(def).trigger("change")}createCopy($ctx,id,name){let copy=super.createCopy($ctx,id,name);copy.$container.find("span.select2").remove();return copy}setup(initial){this.$el.change(this,this.form.changeEvent);this.$el.on("focusout",this.form.focusOut);this.$container.find("select").select2({theme:"classic"});this.defaultDisplay()}getValue(real){if(real===void 0)real=false;let value=this.$el.val();if(real){return value}let sel_idx=this.$el[0].selectedIndex;if(sel_idx===-1){return""}let oid=this.$el[0].selectedOptions[0].getAttribute("data-vuid");if(oid!==null&&oid.startsWith("__oid_")){return oid}return value}setValue(value){if(value===null||value===void 0){this.$el[0].selectedIndex=-1}else{if($.type(value)==="string"){let opts=this.$el[0].options;let attr;if(value.startsWith("__oid_")){attr="data-vuid"}else{attr="value"}for(let i=0;i<opts.length;i++){let attr_value=opts[i].getAttribute(attr);if(attr_value!==null&&attr_value===value){this.$el[0].selectedIndex=i}}}}this.$el.change()}};


var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a;inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.fields.matchCustom=function(params,data){if($.trim(params.term)===""){return data}if(typeof data.text==="undefined"||data.text===""){return null}if(data.text.toLowerCase().indexOf(params.term.toLowerCase())>-1){return data}let alias=data.element.getAttribute("data-al");if(alias!==null&&alias!==""&&alias.indexOf(params.term.toLowerCase())>-1){return data}return null};inz.forms.fields.SMCSelectionField=(_a=class extends inz.forms.fields.Field{init(form,$ctx,config){inz.forms.fields.Field.prototype.init.call(this,form,$ctx,config);this.reId=new RegExp("f_([a-zA-Z0-9]{7,})__(\\d+)")}useGetOnSubmit(){return true}reset(){let def="";if("default"in this.config)def=this.config["default"];this.$el.val(def).trigger("change")}createCopy($ctx,id,name){let copy=super.createCopy($ctx,id,name);copy.$container.find("span.select2").remove();return copy}setup(initial){this.$el.change(this,this.form.changeEvent);this.$el.on("focusout",this.form.focusOut);this.$container.find("select").select2({theme:"classic",matcher:inz.forms.fields.matchCustom});this.defaultDisplay()}getValueData(){let sel_idx=this.$el[0].selectedIndex;if(sel_idx===-1){return""}return this.$el[0].selectedOptions[0].getAttribute("data-dt")}getValueName(){let sel_idx=this.$el[0].selectedIndex;if(sel_idx===-1){return""}return this.$el[0].selectedOptions[0].text}getValueSA(attr){switch(attr){case inz.forms.fields.SMCSelectionField.SA_ANZSCO_NAME:return this.getValueName();case inz.forms.fields.SMCSelectionField.SA_ANZSCO_CODE:return this.getValue();case inz.forms.fields.SMCSelectionField.SA_ANZSCO_SKILL:return this.getValueData();case inz.forms.fields.SMCSelectionField.SA_REG_NAME:return this.getValue();case inz.forms.fields.SMCSelectionField.SA_REG_POINTS:return this.getValueFromDataIdx(0);case inz.forms.fields.SMCSelectionField.SA_REG_GROUP:return this.getValueFromDataIdx(1);case inz.forms.fields.SMCSelectionField.SA_REG_TIER:return this.getValueFromDataIdx(2)}}getValueFromDataIdx(idx){let dt=this.getValueData();if(dt===null)return"";return dt.split("|")[idx]}getValue(real){return this.$el.val()}setValue(value){if(value===null||value===void 0){this.$el[0].selectedIndex=-1}else{if($.type(value)==="string"){let opts=this.$el[0].options;let attr="value";for(let i=0;i<opts.length;i++){let attr_value=opts[i].getAttribute(attr);if(attr_value!==null&&attr_value===value){this.$el[0].selectedIndex=i}}}}this.$el.change()}},__publicField(_a,"SA_NAME","name"),__publicField(_a,"SA_VALUE","value"),__publicField(_a,"SA_ANZSCO_NAME","anz_name"),__publicField(_a,"SA_ANZSCO_CODE","anz_code"),__publicField(_a,"SA_ANZSCO_SKILL","anz_skill"),__publicField(_a,"SA_REG_NAME","reg_name"),__publicField(_a,"SA_REG_POINTS","reg_points"),__publicField(_a,"SA_REG_GROUP","reg_group"),__publicField(_a,"SA_REG_TIER","reg_tier"),_a);


var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a;inz.forms=inz.forms||{};inz.forms.fields=inz.forms.fields||{};inz.forms.validations=inz.forms.validations||{};inz.forms.modals=inz.forms.modals||{};inz.forms.fields.Upload=(_a=class extends inz.forms.fields.Field{static setupFieldType(parsley){}init(form,$ctx,config){super.init(form,$ctx,config);this.modal=form.getModal("Upload");this.$list=this.$el.find("ul").first();this.fileInfos=[];if(config.settings.size===null)config.settings.size=inz.forms.fields.Upload.MAX_UPLOAD_SIZE;config.settings.max=Math.min(config.settings.max,inz.forms.fields.Upload.MAX_UPLOADS);if(config.settings.accept){this.acceptList=[];for(let acc of config.settings.accept.split(",")){this.acceptList.push(acc.toLowerCase().trim())}}}show(initial,no_reset){super.show(initial,no_reset)}hide(initial,no_reset){super.hide(initial,no_reset)}setup(initial){this.$el.find(".ae_supporting_documents_link").on("click",this,function(e){e.preventDefault();let field=e.data;return field.modal.linkHandler(this,field.modal)});super.setup(initial)}useGetOnSubmit(){return false}getMessage(key){if(!(key in this.config.settings.msgs)){return""}return this.config.settings.msgs[key]}getLabel(key){if(!(key in this.config.settings.lbs)){return""}return this.config.settings.lbs[key]}getValue(){return JSON.stringify(this.fileInfos)}setValue(value){this.clear();if(value===null)return;let infos=JSON.parse(value);for(const info of infos){this.addFile(info)}this.form.changeEvent({data:this})}validate(){console.log("Upload validate");if(this.$el!==void 0&&this.$el.hasClass("upload_required")){let numberFiles=this.$el.find("li").length;if(numberFiles===0)return false}return true}clear(){this.fileInfos=[];this.$list.empty()}reset(){this.form.changeEvent({data:this})}addSavedFile(fileInfo){this.addFile(fileInfo)}static isFileTransient(fileInfo){return fileInfo.unique_identifier!==void 0}static getFileId(fileInfo){if(fileInfo.unique_identifier!==void 0){return fileInfo.unique_identifier}return fileInfo.unique_id}addFile(fileInfo){let html;let fuid=inz.forms.fields.Upload.getFileId(fileInfo);if(!inz.forms.fields.Upload.isFileTransient(fileInfo)){html=`<li data-fuid="${fuid}"><span>${fileInfo.filename}</span> <span>(${fileInfo.size})</span><input type="hidden" class="retain_file_marker" id="file_${fuid}" name="__retain_files:list" value="${fuid}" /><input class="uploadField" type="hidden" name="${this.getName()}:list" value='{"unique_id": "${fuid}"}' /></li>`}else{html=`<li data-fuid="${fuid}"><span>${fileInfo.filename}</span> <span>(${fileInfo.size})</span><input class="uploadField" type="hidden" name="${this.getName()}:list" value='{"unique_identifier": "${fuid}"}' /></li>`}this.$list.append($(html));this.fileInfos.push(fileInfo);if(this.fileInfos.length===1){this.$el.find(".ae_doc_list_container").show();this.$el.find(".ae_supporting_documents_link").first().hide()}if(this.form.isInAccordian)this.form.adjustHeight();this.$el.parsley().validate(true);this.form.changeEvent({data:this});return html}removeFile(fileUid){let entry=this.$list.find(`li[data-fuid='${fileUid}']`);if(entry.length===0){console.log(`Remove file: ${fileUid}, but not in list`)}else{entry.remove()}for(const idx in this.fileInfos){if(String(inz.forms.fields.Upload.getFileId(this.fileInfos[idx]))===String(fileUid)){this.fileInfos.splice(idx,1);break}}if(this.fileInfos.length===0){this.$el.find(".ae_doc_list_container").hide();this.$el.find(".ae_supporting_documents_link").first().show()}this.$el.parsley().validate(true);this.form.changeEvent({data:this})}},__publicField(_a,"MAX_UPLOAD_SIZE",1024*1024*20.1),__publicField(_a,"MAX_UPLOADS",30),__publicField(_a,"MSG_FAIL","fail"),__publicField(_a,"MSG_FAIL_DELETE","del"),__publicField(_a,"MSG_FAIL_VIRUS","vr"),__publicField(_a,"LABEL_MODAL_UPLOAD","up"),__publicField(_a,"LABEL_MODAL_FINISHED","fin"),_a);inz.forms.modals.Upload=class{init(form){this.form=form;this.$modal=$("#upload-file");let _this=this;let $ctx=this.form.$form;this.$modal.find("#upload_link").on("click",this,function(e){e.preventDefault();let modal=e.data;let maximumUploadNumber=modal.field.config.settings.max;let files=$(modal.container).find("tr");if(files.length>=maximumUploadNumber){modal.showUploadProgress(0);modal.showErrorMessage("The maximum number of files ("+maximumUploadNumber+") has already been uploaded. Delete an uploaded file first if you want to replace it.");return false}modal.$modal.find("label[for='upload']").trigger("click")})}linkHandler(link,modal){modal.field=$(link).closest(".obj_form_field").data("field");modal.container=$(link).parents("div.ae_supporting_documents");modal.setupForField(modal.field);modal.hideErrorMessage();modal.showUploadProgress(2);modal.setUploadProgress("Preparing for uploads...","",void 0,true);modal.showUploadProgress(0);$(link).modal();window.setTimeout(function(){modal.setTabHandlers()},250);modal.$modal.find(".close-modal").text("");modal.$modal.find(".close-modal").on("keydown",function(e){if(e.which===9&&!e.shiftKey){e.preventDefault();let d=modal.$modal.find(".upload-delete:first");if(d.length!==0)$(d).focus();else modal.$modal.find("#upload_link").focus()}});modal.$modal.on("keydown",function(e){if(e.which===9){e.preventDefault();let d=modal.$modal.find(".upload-delete:first");if(d.length!==0)$(d).focus();else modal.$modal.find("#upload_link").focus();modal.$modal.off("keydown")}});return false}removeLinkTabHandler(e){let modal=e.data;if(e.which===9){e.preventDefault();let $parent=$($(this).parent("tr"));if(e.shiftKey){let prev=$parent.prev("tr");if(prev.length!==0)$(prev).find(".upload-delete").focus();else modal.$modal.find(".close-modal").focus()}else{let next=$parent.next("tr");if(next.length!==0)$(next).find(".upload-delete").focus();else modal.$modal.find("#upload_link").focus()}}}uploadLinkTabHandler(e){let modal=e.data;if(e.which===9&&e.shiftKey){e.preventDefault();let lastFile=$("#upload-file .upload-delete:last");if(lastFile.length!==0)$(lastFile).focus();else $("#upload-file .close-modal").focus()}}setTabHandlers(){this.$modal.find(".upload-delete").off("keydown");this.$modal.find(".upload-delete").on("keydown",this,this.removeLinkTabHandler)}fileFieldClickHandler(e){let modal=$(this).data("modal");let fileObj=modal.$modal.find("#upload").get(0).files[0];if(fileObj===void 0)return;modal.doUpload(fileObj)}updateFileField(field){let accept_attribute=field.config.settings.accept?` accept="${field.config.settings.accept}"`:"";$("#upload-file #upload").replaceWith(`<input id="upload" type="file" style="display: none" ${accept_attribute}/>`);$("#upload-file #upload").data("modal",this);$("#upload-file #upload").on("change",this.fileFieldClickHandler)}setupForField(field){this.setFileList(field);this.$modal.find("#uploaded-files h4").text(`${field.config.settings.label}`);this.$modal.find("#upload_link").text(field.getLabel(inz.forms.fields.Upload.LABEL_MODAL_UPLOAD));this.$modal.find("#upload_finished").text(field.getLabel(inz.forms.fields.Upload.LABEL_MODAL_FINISHED));this.updateFileField(field)}setFileList(field){let src=field.$el.find("ul").first();let dst=this.$modal.find("#uploaded-files tbody");dst.empty();for(let info of field.fileInfos){let html=this.addFileHtml(info);dst.append($(html))}dst.find("a").on("click",this,this.deleteFileHandler);this.setTabHandlers(dst)}getNumberFiles(context){let docList=$(context).find(".ae_supporting_documents_list");if(docList.length===0)return 0;return docList.find("li").length}addFile(fileInfo){let entry_html=this.field.addFile(fileInfo);let dst=this.$modal.find("#uploaded-files table tbody");let html=this.addFileHtml(fileInfo);dst.append($(html));dst.find("a").off("click");dst.find("a").on("click",this,this.deleteFileHandler);this.setTabHandlers(dst)}addFileHtml(fileInfo){let fuid=inz.forms.fields.Upload.getFileId(fileInfo);let html=`<tr data-fuid="${fuid}"><td><span>${fileInfo.filename}</span> <span>(${fileInfo.size})</span></td><td class="btn_action"><a class="upload-delete btn btn__small btn__secondary" href="#">delete</a></td></tr>`;return html}removeFile(fuid){this.field.removeFile(fuid);let dst=this.$modal.find(`#uploaded-files table tr[data-fuid='${fuid}']`).remove();this.setTabHandlers(dst)}deleteFileHandler(e){e.preventDefault();let modal=e.data;let form=modal.$modal;let fileName=$(this).parent().find("span").first().text();let fuid=$(this).closest("tr").data("fuid");modal.showUploadProgress(2);modal.setUploadProgress("Deleting file - '"+fileName+"'","");if(!String(fuid).match(/_/)){modal.removeFile(fuid);if(modal.field.validate!==void 0)modal.field.$el.parsley().validate(true);modal.showUploadProgress(0);return}let params={"fileName":fileName,"field":modal.field.getName(),"unique_identifier":fuid};let jqxhr=$.ajax({url:"/@@acc_sf_remove_temp/"+window.form.action.substring(window.form.action.lastIndexOf("/")+1),type:"POST",data:params}).done(function(data){modal.removeFile(fuid);if(modal.field.validate!==void 0)modal.field.$el.parsley().validate(true);modal.showUploadProgress(0)}).fail(function(jqXHR,textStatus,errorThrown){console.log("Failed Status: "+jqXHR.status);console.log("StatusText: "+jqXHR.statusText);modal.showUploadProgress(0);modal.showErrorMessage(modal.field.getMessage(inz.forms.fields.Upload.MSG_FAIL_DELETE))})}validateFile(fileObj){const maximumUploadNumber=this.field.config.settings.max;let files=this.field.$el.find("li");if(files.length>=maximumUploadNumber){this.showUploadProgress(0);this.showErrorMessage("The maximum number of files ("+maximumUploadNumber+") has already been uploaded. Delete an uploaded file first if you want to replace it.");return false}const maximumUploadSize=this.field.config.settings.size*1024*1024;if(fileObj.size>maximumUploadSize){this.showUploadProgress(0);this.showErrorMessage("The selected file ("+fileObj.name+") was too large ("+this.formatBytes(fileObj.size)+") to be uploaded. Maximum upload size accepted is "+this.formatBytes(maximumUploadSize)+".");return false}if(this.field.acceptList!==void 0){let ext="."+fileObj.name.split(".").pop().trim().toLowerCase();if(!this.field.acceptList.includes(ext)){this.showUploadProgress(0);let msg;if(this.field.acceptList.length===1){msg=`The file must have an extension of ${this.field.config.settings.accept}`}else{msg=`The file must have an extension of any one of the following: ${this.field.config.settings.accept}`}this.showErrorMessage(`The selected file (${fileObj.name}) does not have a valid extension. ${msg}`);return false}}return true}formatBytes(a,b){if(0===a)return"0 Bytes";let c=1e3,d=b||2,e=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],f=Math.floor(Math.log(a)/Math.log(c));return parseInt((a/Math.pow(c,f)).toFixed(d))+" "+e[f]}doUpload(fileObj){let form=$("#upload-file");let modal=this;if(this.field===void 0){console.log("Unknown field, can't do upload");$.modal.close();return}let fileInfo={filename:fileObj.name,fieldname:this.field.getName(),fieldhash:this.field.getName(),unique_identifier:null,type:fileObj.type,size:modal.formatBytes(fileObj.size)};let fileName=fileObj.name;if(this.validateFile(fileObj)===false){modal.updateFileField(modal.field);return}this.showUploadProgress(1);this.setUploadProgress("Uploading file - '"+inz.forms.escapeHTML(fileName)+"'","",0);let formData=new FormData;formData.append("field",fileInfo.fieldname);formData.append("fileName",fileInfo.filename);formData.append("file",fileObj);if(this.index!==void 0)formData.append("index",inz.accreditedemployers.upload.index);let jqxhr=$.ajax({url:"/@@acc_sf_save_temp/"+window.form.action.substring(window.form.action.lastIndexOf("/")+1),type:"POST",data:formData,processData:false,contentType:false}).done(function(data){console.log("Upload result: "+data.result);fileInfo.unique_identifier=data.unique_identifier;fileInfo.filename=inz.forms.escapeHTML(fileName);modal.addFile(fileInfo);if(modal.field.validate!==void 0)modal.field.$el.parsley().validate(true);modal.updateFileField(modal.field);modal.showUploadProgress(0)}).fail(function(jqXHR,textStatus,errorThrown){console.log("Failed Status: "+jqXHR.status);console.log("StatusText: "+jqXHR.statusText);modal.updateFileField(modal.field);modal.showUploadProgress(0);if(jqXHR.status===422){modal.showErrorMessage(modal.field.getMessage(inz.forms.fields.Upload.MSG_FAIL))}else if(jqXHR.status===406){modal.showErrorMessage(modal.field.getMessage(inz.forms.fields.Upload.MSG_FAIL_VIRUS))}else if(jqXHR.status===413){modal.showErrorMessage(modal.field.getMessage(inz.forms.fields.Upload.MSG_FAIL))}else if(jqXHR.status===412){modal.showErrorMessage(modal.field.getMessage(inz.forms.fields.Upload.MSG_FAIL))}else if(jqXHR.status===415){modal.showErrorMessage(modal.field.getMessage(inz.forms.fields.Upload.MSG_FAIL))}else{modal.showErrorMessage(modal.field.getMessage(inz.forms.fields.Upload.MSG_FAIL))}}).uploadProgress(function(evt){if(evt.lengthComputable){let percentComplete=evt.loaded/evt.total*100;let msg="Uploaded "+modal.formatBytes(evt.loaded)+" of "+modal.formatBytes(evt.total);modal.setUploadProgress(void 0,msg,percentComplete);if(percentComplete>=100)modal.setUploadProgress(void 0,"File uploaded. Processing...",void 0,true,false)}})}setUploadProgress(heading,message,progress,showSpinner,showProgress){let form=$("#upload-file");if(heading!==void 0)form.find(".upload_heading").text(heading);if(message!==void 0)form.find(".upload_message").text(message);if(progress!==void 0)form.find(".ae_progress_meter span").width(progress.toFixed(0)+"%");if(showSpinner!==void 0)showSpinner?form.find(".ae_upload_spinner").show():form.find(".ae_upload_spinner").hide();if(showProgress!==void 0)showProgress?form.find(".ae_progress_meter").show():form.find(".ae_progress_meter").hide()}showUploadProgress(show){if(show===0){$("#uploaded-files").show();$("#upload-actions").show();$("#upload-file-progress").hide();this.$modal.find(".close-modal").show();return}if(show===1){this.$modal.find(".ae_progress_meter span").width("0%");this.$modal.find(".ae_progress_meter").show();this.$modal.find(".ae_upload_spinner").hide()}else if(show===2){this.$modal.find(".ae_progress_meter").hide();this.$modal.find(".ae_upload_spinner").show()}else if(show===3){this.$modal.find(".ae_progress_meter").hide();this.$modal.find(".ae_upload_spinner").hide();$("#uploaded-files").hide();$("#upload-actions").hide();$("#upload-file-progress").show();this.$modal.find(".close-modal").show();return}else{this.$modal.find(".ae_progress_meter").hide();this.$modal.find(".ae_upload_spinner").hide()}this.hideErrorMessage();this.$modal.find("#uploaded-files").hide();this.$modal.find("#upload-actions").hide();this.$modal.find("#upload-file-progress").show();this.$modal.find(".close-modal").hide()}showErrorMessage(msg){this.$modal.find(".banner_textcopy").text(msg);this.$modal.find(".banner").show()}hideErrorMessage(){this.$modal.find(".banner").hide()}};


var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _a;inz.forms=inz.forms||{};inz.forms.resv=inz.forms.resv||{};inz.forms.resv.isResCondition=function(config){return config.test==="NATIONAL_SECURITY"||config.test==="ADDITIONAL_INFORMATION"};inz.forms.resv.isResField=function(form,field){let id=field.id;for(let f of form.resvFieldIds){if(id.startsWith(f))return true}return false};inz.forms.resv.reId=new RegExp("f_([a-zA-Z0-9]{7,})__(\\d)+");inz.forms.resv.Condition=(_a=class extends inz.forms.Condition{init(form,field,config){this.form=form;this.field=field;this.testType=config.test;this.testValue=config.tvalue;this.op=config.op;this.resFields={};this.dependField=null;let src_in_group=false;if(this.form instanceof inz.forms.SMCAppForm){this.dependField=form.getField(config.depends);src_in_group=this.dependField.$container.closest(".form_group").length!==0}let ret=true;let in_group=this.field.$container.closest(".form_group").length!==0;if(src_in_group){let map=form.fieldMap[this.dependField.group.id];let idx=inz.forms.resv.reId.exec(field.getId())[2];if(map===void 0)return false;this.mapFields(map,"__"+idx)}else if(in_group){let map=form.fieldMap[field.group.id];let idx=inz.forms.resv.reId.exec(field.getId())[2];if(map===void 0)return false;this.mapFields(map,"__"+idx)}else{if(form.fieldMap["__"]===void 0||Object.keys(form.fieldMap["__"]).length===0)return false;this.mapFields(form.fieldMap["__"],"")}return ret}mapFields(map,postfix){for(let field_name of Object.keys(map)){for(let field_id of map[field_name]){let field=this.form.getField(field_id+postfix);if(this.resFields[field_name]!==void 0){this.resFields[field_name].push(field);field.addDependant(this.field)}else{this.resFields[field_name]=[field];field.addDependant(this.field)}}}}remove(){for(let name of Object.keys(this.resFields)){for(let f of this.resFields[name]){f.removeDependant(this.field)}}}shouldTest(src){return true}test(value){if(this.testType==="NATIONAL_SECURITY"){if(this.testNational())return true}else if(this.testAdditional())return true;return false}calcAge(dob){if(!(dob instanceof Date))dob=new Date(dob);let dt=new Date(Date.now()-dob);let age=Math.abs(dt.getUTCFullYear()-1970);return age}getFieldValue(name){if(name in this.resFields){for(let field of this.resFields[name]){if(field.isHidden===false){return field.getValue(true)}}}return void 0}testNational(grp,postfix){let citizenship=this.getFieldValue("citizenship");let birth=this.getFieldValue("country_of_birth");if(!inz.forms.resv.Condition.NATIONAL_COUNTRIES.includes(citizenship)&&!inz.forms.resv.Condition.NATIONAL_COUNTRIES.includes(birth)){return false}let dob=new Date(this.getFieldValue("date_of_birth"));let age=this.calcAge(dob);if(age>=17)return true;return false}testAdditional(grp,postfix){let citizenship=this.getFieldValue("citizenship");let birth=this.getFieldValue("country_of_birth");if(inz.forms.resv.Condition.ADD_COUNTRIES_1.includes(citizenship)||inz.forms.resv.Condition.ADD_COUNTRIES_1.includes(birth)){return true}let dob=new Date(this.getFieldValue("date_of_birth"));let age=this.calcAge(dob);if(inz.forms.resv.Condition.ADD_COUNTRIES_2.includes(citizenship)||inz.forms.resv.Condition.ADD_COUNTRIES_2.includes(birth)){if(age>=17)return true}let gender=this.getFieldValue("gender");if(inz.forms.resv.Condition.ADD_COUNTRIES_3.includes(citizenship)||inz.forms.resv.Condition.ADD_COUNTRIES_3.includes(birth)){if(gender==="M"&&age>=17)return true}if(inz.forms.resv.Condition.ADD_COUNTRIES_4.includes(citizenship)||inz.forms.resv.Condition.ADD_COUNTRIES_4.includes(birth)){if(gender==="M"&&dob<new Date("01-01-1981"))return true}return false}},__publicField(_a,"FIELDS",["country_of_birth","citizenship","date_of_birth","gender"]),__publicField(_a,"NATIONAL_COUNTRIES",["CHN","CUB","EGY","HKG","ISR","KEN","LBN","MAC","NGA","PAK","PSE","SOM","TUR"]),__publicField(_a,"ADD_COUNTRIES_1",["PRK"]),__publicField(_a,"ADD_COUNTRIES_2",["IRN","IRQ","SSD","SDN","SYR","DZA","AGO","BLR","BDI","CIV","COG","ETH","HTI","LBR","LBY","MMR","RUS","RWA","SLE","LKA","ZWE"]),__publicField(_a,"ADD_COUNTRIES_3",["AFG","SOM","YEM"]),__publicField(_a,"ADD_COUNTRIES_4",["KHM"]),_a);
