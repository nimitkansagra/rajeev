var inz=inz||{};inz.resourceSearch={};inz.resourceSearch.init=function(limit,presetReset,presets,sol,showCounts,default_sort_by){inz.resourceSearch.suppressHashChangeSearch=null;window.addEventListener("hashchange",inz.resourceSearch.hashChanged,false);inz.resourceSearch.showCounts=showCounts;inz.resourceSearch.limit=limit;inz.resourceSearch.preset_reset=presetReset;inz.resourceSearch.presets=presets;inz.resourceSearch.search_on_load=sol;inz.resourceSearch.last_index=null;$(".sort_bys").hide();$("#results_load_button").hide();$("#resource_search").on("submit",inz.resourceSearch.triggerSearch);$("#results_load_button").click(inz.resourceSearch.triggerLoadMore);$("#reset").click(inz.resourceSearch.resetSearch);$("div.sort_by_filter").click(inz.resourceSearch.sortByClick);inz.resourceSearch.setSortBy(default_sort_by);if(inz.resourceSearch.search_on_load&&!window.location.hash)inz.resourceSearch.triggerSearch(null);else if(window.location.hash)inz.resourceSearch.hashChanged(null)};inz.resourceSearch.render_results=function(data,append){if(!append)$("#search_results").empty();inz.resourceSearch.setToSearchParameters(data.searchParameters);if(inz.resourceSearch.last_index<data.last)inz.resourceSearch.last_index=data.last;var params2=inz.resourceSearch.serializeForm()+"&l="+inz.resourceSearch.last_index;var hash=inz.resourceSearch.encodeHash(params2);inz.resourceSearch.last_index=data.last;if(window.location.hash!="#"+hash){inz.resourceSearch.suppressHashChangeSearch="#"+hash;var url=window.location.origin+window.location.pathname+"#"+hash;history.pushState({},"",url)}if("errorMessage"in data){$(".sort_bys").hide();$(".results_summary").hide();$("#results_load_button").hide();$("#search_no_results").show();return}$("#search_no_results").hide();$("#search_error").hide();var count=data.totalResults;var results=data.results;var default_thumb=data.static+"/images/document.png";if(count==1){$(".results_summary").text("Result 1 of 1")}else{var last=data.first-1+results.length;$(".results_summary").text("Results 1-"+last.toString()+" of "+count.toString())}$(".sort_bys").show();$(".results_summary").show();for(var i2=0;i2<results.length;i2++){var result=results[i2];var html='<article class="listing_item md-px3 md-py3 lg-py5 xs-py2 rs_search_result"><div class="row"><div class="col-pgxl-5 col-pgmd-5">';html+='<a href="'+result.link+'">';if(result.thumb_name)html+='<img class="folder_overview_thumbnail" src="'+result.thumb_name+'" alt="'+result.thumb_label+'">';else html+='<img class="folder_overview_thumbnail" src="'+default_thumb+'" alt="Resource">';html+="</a></div>";html+='<div class="col-pgxl-21 col-pgmd-15"><h2 class="h4 medium"><a href="'+result.url+'">'+result.title+"</a></h2>";if(result.date)html+="<div class='hgroup'><p class='hgroup_date'>"+result.date+"</p></div>";html+='<p class="result_desc">'+result.desc+"</p>";if(result.type=="external")html+="<a target='_blank' class='link link__"+result.type+"' href='"+result.link+"'><span class='link__title'>"+result.title+"</span></a>";else if(result.type!="no_link"){if(result.file_info!=null){var info=result.file_info.split("|");html+="<a class='link link__"+result.type+"' href='"+result.link+"'><span class='link__title'>"+result.title+"</span><span class='file_info'><span class='file_type'> "+info[0]+"</span><span class='file_size'> "+info[1]+"</span></span></a>"}else html+="<a class='link link__"+result.type+"' href='"+result.link+"'><span class='link__title'>"+result.title+"</span></a>"}html+="</div>";html+="</div></article>";$("#search_results").append(html)}if(data.moreResultsAvailable)$("#results_load_button").removeClass("results_loadbtn__loading").show();else $("#results_load_button").hide()};inz.resourceSearch.doSearch=function(data,append,last_index){if(last_index)data+="&l="+last_index;else if(inz.resourceSearch.last_index)data+="&f="+(inz.resourceSearch.last_index+1);$.ajax({type:"GET",url:location.protocol+"//"+location.host+location.pathname+"/@@resource_search",data:data,cache:true,success:function(data2){inz.resourceSearch.render_results(data2,append)},error:function(){$("#results_load_button").hide()}})};inz.resourceSearch.triggerSearch=function(e){if(e){e.preventDefault();e.stopPropagation()}$("#results_load_button").addClass("results_loadbtn__loading");$("#results_load_button").show();var data=inz.resourceSearch.serializeForm();inz.resourceSearch.last_index=null;inz.resourceSearch.doSearch(data,false,null)};inz.resourceSearch.triggerLoadMore=function(e){$("#results_load_button").addClass("results_loadbtn__loading");$("#results_load_button").show();var data=inz.resourceSearch.serializeForm();inz.resourceSearch.doSearch(data,true,null)};inz.resourceSearch.resetSearch=function(e){e.preventDefault();e.stopPropagation();if(inz.resourceSearch.preset_reset&&inz.resourceSearch.presets["type"]!=null)$("#filter-type").val(inz.resourceSearch.presets["type"]).trigger("change");else $("#filter-type").val(null).trigger("change");if(inz.resourceSearch.preset_reset&&inz.resourceSearch.presets["category"]!=null)$("#filter-category").val(inz.resourceSearch.presets["category"]).trigger("change");else $("#filter-category").val(null).trigger("change");if(inz.resourceSearch.preset_reset&&inz.resourceSearch.presets["audience"]!=null)$("#filter-audience").val(inz.resourceSearch.presets["audience"]).trigger("change");else $("#filter-audience").val(null).trigger("change");if(inz.resourceSearch.preset_reset&&inz.resourceSearch.presets["search"]!=null){$("#filter-search").val(inz.resourceSearch.presets["search"]).trigger("change")}else{$("#filter-search").val(null).trigger("change")}$("#search_no_results").hide();$("#search_error").hide();$(".sort_bys").hide();$(".results_summary").hide();$("#results_load_button").hide();$("#search_results").empty();inz.resourceSearch.suppressHashChangeSearch="";history.pushState("",document.Title,window.location.pathname)};inz.resourceSearch.setToSearchParameters=function(parms){$("#filter-type").val(parms.t).trigger("change");$("#filter-category").val(parms.c).trigger("change");$("#filter-audience").val(parms.a).trigger("change");$("#filter-search").val(parms.q).trigger("change");inz.resourceSearch.setSortBy(parms.s);inz.resourceSearch.last_index=parms.l};inz.resourceSearch.differentSearchParameters=function(parms){if(inz.resourceSearch.last_index!=parms.l)return true;if($("#filter-type").val()!=parms.t)return true;if($("#filter-category").val()!=parms.c)return true;if($("#filter-audience").val()!=parms.a)return true;if($("#filter-search").val()!=parms.q)return true;if(inz.resourceSearch.getSortBy()!=parms.s)return true;return false};inz.resourceSearch.getSortBy=function(){var ret="";var id=$(".sort_by_filter.active").attr("id");if(id=="sort_relevance")ret+="r";else if(id=="sort_date")ret+="d";else if(id=="sort_alpha")ret+="a";if($(".sort_by_filter.active").hasClass("ascending"))ret+="a";else ret+="d";return ret};inz.resourceSearch.setSortBy=function(parm){var id;if(parm[0]=="r")id="sort_relevance";else if(parm[0]=="d")id="sort_date";else if(parm[0]=="a")id="sort_alpha";if($(".sort_by_filter.active").attr("id")!=id){$(".sort_by_filter.active").removeClass("active");$("#"+id).addClass("active")}if(parm[1]=="a")$("#"+id).addClass("ascending");else $("#"+id).removeClass("ascending")};inz.resourceSearch.hashChanged=function(e){if(window.location.hash!=inz.resourceSearch.suppressHashChangeSearch){params=inz.resourceSearch.getSearchParametersFromHash(inz.resourceSearch.decodeHash(window.location.hash.substr(1)));if(inz.resourceSearch.differentSearchParameters(params)){inz.resourceSearch.setToSearchParameters(params);$("#results_load_button").addClass("results_loadbtn__loading");$("#results_load_button").show();var data=inz.resourceSearch.serializeForm();inz.resourceSearch.doSearch(data,false,params.l)}}};inz.resourceSearch.getSearchParametersFromHash=function(hash){params=hash.split("&");searchParams={};for(i=0;i<params.length;i++){searchParams[params[i][0]]=decodeURIComponent(params[i].substr(2).replace(/\+/g,"%20"))}if(!searchParams.hasOwnProperty("l")||!searchParams.hasOwnProperty("a")||!searchParams.hasOwnProperty("c")||!searchParams.hasOwnProperty("a")||!searchParams.hasOwnProperty("q")||!searchParams.hasOwnProperty("t")||!searchParams.hasOwnProperty("s"))return null;return searchParams};inz.resourceSearch.encodeHash=function(str){return encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function toSolidBytes(match,p1){return String.fromCharCode("0x"+p1)})};inz.resourceSearch.decodeHash=function(str){return decodeURIComponent(str.split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))};inz.resourceSearch.cleanQuery=function(query){return query.replace(/[^0-9a-z "'-]/gi,"")};inz.resourceSearch.serializeForm=function(){var data=$("#resource_search").serialize();data+="&s="+inz.resourceSearch.getSortBy();return data};inz.resourceSearch.s2OptionClasses=function(data){if(!data.element)return data.text;var $element=$(data.element);var $wrapper=$("<span></span>");$wrapper.addClass($element[0].className);$wrapper.text(data.text);return $wrapper};inz.resourceSearch.initResourceFooter=function(url){$(document).on("keydown","input.resourcefooter_input",function(e){if(e.which===13){var q=inz.resourceSearch.cleanQuery($(this).val());var u=url.replace("<q>",encodeURIComponent(q));window.location=u;return false}})};inz.resourceSearch.sortByClick=function(e){if($(".sort_by_filter.active").attr("id")==$(this).attr("id")){if(!$(this).hasClass("sort_by_order"))return;$(this).toggleClass("ascending")}else{var id="#"+$(".sort_by_filter.active").attr("id");$(id).removeClass("active");$(this).addClass("active")}inz.resourceSearch.triggerSearch(null)};
